(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();const yn=!1,wn=(e,t)=>e===t,he=Symbol("solid-proxy"),it=Symbol("solid-track"),Ne={equals:wn};let Wt=Yt;const fe=1,qe=2,Xt={owned:null,cleanups:null,context:null,owner:null};var j=null;let Ce=null,$n=null,V=null,G=null,ae=null,Ke=0;function De(e,t){const n=V,r=j,o=e.length===0,s=t===void 0?r:t,l=o?Xt:{owned:null,cleanups:null,context:s?s.context:null,owner:s},i=o?e:()=>e(()=>re(()=>Ee(l)));j=l,V=null;try{return ye(i,!0)}finally{V=n,j=r}}function q(e,t){t=t?Object.assign({},Ne,t):Ne;const n={value:e,observers:null,observerSlots:null,comparator:t.equals||void 0},r=o=>(typeof o=="function"&&(o=o(n.value)),Gt(n,o));return[Zt.bind(n),r]}function Y(e,t,n){const r=vt(e,t,!1,fe);Re(r)}function _e(e,t,n){Wt=An;const r=vt(e,t,!1,fe);r.user=!0,ae?ae.push(r):Re(r)}function B(e,t,n){n=n?Object.assign({},Ne,n):Ne;const r=vt(e,t,!0,0);return r.observers=null,r.observerSlots=null,r.comparator=n.equals||void 0,Re(r),Zt.bind(r)}function xe(e){return ye(e,!1)}function re(e){if(V===null)return e();const t=V;V=null;try{return e()}finally{V=t}}function Ze(e){_e(()=>re(e))}function Ge(e){return j===null||(j.cleanups===null?j.cleanups=[e]:j.cleanups.push(e)),e}function at(){return V}function Ye(e,t){const n=Symbol("context");return{id:n,Provider:En(n),defaultValue:e}}function N(e){let t;return j&&j.context&&(t=j.context[e.id])!==void 0?t:e.defaultValue}function Kt(e){const t=B(e),n=B(()=>ct(t()));return n.toArray=()=>{const r=n();return Array.isArray(r)?r:r!=null?[r]:[]},n}function Zt(){if(this.sources&&this.state)if(this.state===fe)Re(this);else{const e=G;G=null,ye(()=>He(this),!1),G=e}if(V){const e=this.observers?this.observers.length:0;V.sources?(V.sources.push(this),V.sourceSlots.push(e)):(V.sources=[this],V.sourceSlots=[e]),this.observers?(this.observers.push(V),this.observerSlots.push(V.sources.length-1)):(this.observers=[V],this.observerSlots=[V.sources.length-1])}return this.value}function Gt(e,t,n){let r=e.value;return(!e.comparator||!e.comparator(r,t))&&(e.value=t,e.observers&&e.observers.length&&ye(()=>{for(let o=0;o<e.observers.length;o+=1){const s=e.observers[o],l=Ce&&Ce.running;l&&Ce.disposed.has(s),(l?!s.tState:!s.state)&&(s.pure?G.push(s):ae.push(s),s.observers&&Jt(s)),l||(s.state=fe)}if(G.length>1e6)throw G=[],new Error},!1)),t}function Re(e){if(!e.fn)return;Ee(e);const t=Ke;Sn(e,e.value,t)}function Sn(e,t,n){let r;const o=j,s=V;V=j=e;try{r=e.fn(t)}catch(l){return e.pure&&(e.state=fe,e.owned&&e.owned.forEach(Ee),e.owned=null),e.updatedAt=n+1,Qt(l)}finally{V=s,j=o}(!e.updatedAt||e.updatedAt<=n)&&(e.updatedAt!=null&&"observers"in e?Gt(e,r):e.value=r,e.updatedAt=n)}function vt(e,t,n,r=fe,o){const s={fn:e,state:r,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:j,context:j?j.context:null,pure:n};return j===null||j!==Xt&&(j.owned?j.owned.push(s):j.owned=[s]),s}function Fe(e){if(e.state===0)return;if(e.state===qe)return He(e);if(e.suspense&&re(e.suspense.inFallback))return e.suspense.effects.push(e);const t=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<Ke);)e.state&&t.push(e);for(let n=t.length-1;n>=0;n--)if(e=t[n],e.state===fe)Re(e);else if(e.state===qe){const r=G;G=null,ye(()=>He(e,t[0]),!1),G=r}}function ye(e,t){if(G)return e();let n=!1;t||(G=[]),ae?n=!0:ae=[],Ke++;try{const r=e();return kn(n),r}catch(r){n||(ae=null),G=null,Qt(r)}}function kn(e){if(G&&(Yt(G),G=null),e)return;const t=ae;ae=null,t.length&&ye(()=>Wt(t),!1)}function Yt(e){for(let t=0;t<e.length;t++)Fe(e[t])}function An(e){let t,n=0;for(t=0;t<e.length;t++){const r=e[t];r.user?e[n++]=r:Fe(r)}for(t=0;t<n;t++)Fe(e[t])}function He(e,t){e.state=0;for(let n=0;n<e.sources.length;n+=1){const r=e.sources[n];if(r.sources){const o=r.state;o===fe?r!==t&&(!r.updatedAt||r.updatedAt<Ke)&&Fe(r):o===qe&&He(r,t)}}}function Jt(e){for(let t=0;t<e.observers.length;t+=1){const n=e.observers[t];n.state||(n.state=qe,n.pure?G.push(n):ae.push(n),n.observers&&Jt(n))}}function Ee(e){let t;if(e.sources)for(;e.sources.length;){const n=e.sources.pop(),r=e.sourceSlots.pop(),o=n.observers;if(o&&o.length){const s=o.pop(),l=n.observerSlots.pop();r<o.length&&(s.sourceSlots[l]=r,o[r]=s,n.observerSlots[r]=l)}}if(e.tOwned){for(t=e.tOwned.length-1;t>=0;t--)Ee(e.tOwned[t]);delete e.tOwned}if(e.owned){for(t=e.owned.length-1;t>=0;t--)Ee(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}e.state=0}function xn(e){return e instanceof Error?e:new Error(typeof e=="string"?e:"Unknown error",{cause:e})}function Qt(e,t=j){throw xn(e)}function ct(e){if(typeof e=="function"&&!e.length)return ct(e());if(Array.isArray(e)){const t=[];for(let n=0;n<e.length;n++){const r=ct(e[n]);Array.isArray(r)?t.push.apply(t,r):t.push(r)}return t}return e}function En(e,t){return function(r){let o;return Y(()=>o=re(()=>(j.context={...j.context,[e]:r.value},Kt(()=>r.children))),void 0),o}}const In=Symbol("fallback");function wt(e){for(let t=0;t<e.length;t++)e[t]()}function Tn(e,t,n={}){let r=[],o=[],s=[],l=0,i=t.length>1?[]:null;return Ge(()=>wt(s)),()=>{let f=e()||[],c=f.length,d,a;return f[it],re(()=>{let b,u,g,h,p,A,M,S,E;if(c===0)l!==0&&(wt(s),s=[],r=[],o=[],l=0,i&&(i=[])),n.fallback&&(r=[In],o[0]=De(O=>(s[0]=O,n.fallback())),l=1);else if(l===0){for(o=new Array(c),a=0;a<c;a++)r[a]=f[a],o[a]=De(m);l=c}else{for(g=new Array(c),h=new Array(c),i&&(p=new Array(c)),A=0,M=Math.min(l,c);A<M&&r[A]===f[A];A++);for(M=l-1,S=c-1;M>=A&&S>=A&&r[M]===f[S];M--,S--)g[S]=o[M],h[S]=s[M],i&&(p[S]=i[M]);for(b=new Map,u=new Array(S+1),a=S;a>=A;a--)E=f[a],d=b.get(E),u[a]=d===void 0?-1:d,b.set(E,a);for(d=A;d<=M;d++)E=r[d],a=b.get(E),a!==void 0&&a!==-1?(g[a]=o[d],h[a]=s[d],i&&(p[a]=i[d]),a=u[a],b.set(E,a)):s[d]();for(a=A;a<c;a++)a in g?(o[a]=g[a],s[a]=h[a],i&&(i[a]=p[a],i[a](a))):o[a]=De(m);o=o.slice(0,l=c),r=f.slice(0)}return o});function m(b){if(s[a]=b,i){const[u,g]=q(a);return i[a]=g,t(f[a],u)}return t(f[a])}}}function _(e,t){return re(()=>e(t||{}))}const Ct=e=>`Stale read from <${e}>.`;function ne(e){const t="fallback"in e&&{fallback:()=>e.fallback};return B(Tn(()=>e.each,e.children,t||void 0))}function H(e){const t=e.keyed,n=B(()=>e.when,void 0,void 0),r=t?n:B(n,void 0,{equals:(o,s)=>!o==!s});return B(()=>{const o=r();if(o){const s=e.children;return typeof s=="function"&&s.length>0?re(()=>s(t?o:()=>{if(!re(r))throw Ct("Show");return n()})):s}return e.fallback},void 0,void 0)}function Me(e){const t=Kt(()=>e.children),n=B(()=>{const r=t(),o=Array.isArray(r)?r:[r];let s=()=>{};for(let l=0;l<o.length;l++){const i=l,f=o[l],c=s,d=B(()=>c()?void 0:f.when,void 0,void 0),a=f.keyed?d:B(d,void 0,{equals:(m,b)=>!m==!b});s=()=>c()||(a()?[i,d,f]:void 0)}return s});return B(()=>{const r=n()();if(!r)return e.fallback;const[o,s,l]=r,i=l.children;return typeof i=="function"&&i.length>0?re(()=>i(l.keyed?s():()=>{var c;if(((c=re(n)())==null?void 0:c[0])!==o)throw Ct("Match");return s()})):i},void 0,void 0)}function Z(e){return e}const Ln=void 0,ie=e=>B(()=>e());function Rn(e,t,n){let r=n.length,o=t.length,s=r,l=0,i=0,f=t[o-1].nextSibling,c=null;for(;l<o||i<s;){if(t[l]===n[i]){l++,i++;continue}for(;t[o-1]===n[s-1];)o--,s--;if(o===l){const d=s<r?i?n[i-1].nextSibling:n[s-i]:f;for(;i<s;)e.insertBefore(n[i++],d)}else if(s===i)for(;l<o;)(!c||!c.has(t[l]))&&t[l].remove(),l++;else if(t[l]===n[s-1]&&n[i]===t[o-1]){const d=t[--o].nextSibling;e.insertBefore(n[i++],t[l++].nextSibling),e.insertBefore(n[--s],d),t[o]=n[s]}else{if(!c){c=new Map;let a=i;for(;a<s;)c.set(n[a],a++)}const d=c.get(t[l]);if(d!=null)if(i<d&&d<s){let a=l,m=1,b;for(;++a<o&&a<s&&!((b=c.get(t[a]))==null||b!==d+m);)m++;if(m>d-i){const u=t[l];for(;i<d;)e.insertBefore(n[i++],u)}else e.replaceChild(n[i++],t[l++])}else l++;else t[l++].remove()}}}const $t="_$DX_DELEGATE";function Mn(e,t,n,r={}){let o;return De(s=>{o=s,t===document?e():y(t,e(),t.firstChild?null:void 0,n)},r.owner),()=>{o(),t.textContent=""}}function x(e,t,n,r){let o;const s=()=>{const i=document.createElement("template");return i.innerHTML=e,i.content.firstChild},l=()=>(o||(o=s())).cloneNode(!0);return l.cloneNode=l,l}function ce(e,t=window.document){const n=t[$t]||(t[$t]=new Set);for(let r=0,o=e.length;r<o;r++){const s=e[r];n.has(s)||(n.add(s),t.addEventListener(s,Bn))}}function Pn(e,t){t==null?e.removeAttribute("class"):e.className=t}function Je(e,t,n,r){Array.isArray(n)?(e[`$$${t}`]=n[0],e[`$$${t}Data`]=n[1]):e[`$$${t}`]=n}function en(e,t,n={}){const r=Object.keys(t||{}),o=Object.keys(n);let s,l;for(s=0,l=o.length;s<l;s++){const i=o[s];!i||i==="undefined"||t[i]||(St(e,i,!1),delete n[i])}for(s=0,l=r.length;s<l;s++){const i=r[s],f=!!t[i];!i||i==="undefined"||n[i]===f||!f||(St(e,i,!0),n[i]=f)}return n}function On(e,t,n){n!=null?e.style.setProperty(t,n):e.style.removeProperty(t)}function Dn(e,t,n){return re(()=>e(t,n))}function y(e,t,n,r){if(n!==void 0&&!r&&(r=[]),typeof t!="function")return je(e,t,r,n);Y(o=>je(e,t(),o,n),r)}function St(e,t,n){const r=t.trim().split(/\s+/);for(let o=0,s=r.length;o<s;o++)e.classList.toggle(r[o],n)}function Bn(e){let t=e.target;const n=`$$${e.type}`,r=e.target,o=e.currentTarget,s=f=>Object.defineProperty(e,"target",{configurable:!0,value:f}),l=()=>{const f=t[n];if(f&&!t.disabled){const c=t[`${n}Data`];if(c!==void 0?f.call(t,c,e):f.call(t,e),e.cancelBubble)return}return t.host&&typeof t.host!="string"&&!t.host._$host&&t.contains(e.target)&&s(t.host),!0},i=()=>{for(;l()&&(t=t._$host||t.parentNode||t.host););};if(Object.defineProperty(e,"currentTarget",{configurable:!0,get(){return t||document}}),e.composedPath){const f=e.composedPath();s(f[0]);for(let c=0;c<f.length-2&&(t=f[c],!!l());c++){if(t._$host){t=t._$host,i();break}if(t.parentNode===o)break}}else i();s(r)}function je(e,t,n,r,o){for(;typeof n=="function";)n=n();if(t===n)return n;const s=typeof t,l=r!==void 0;if(e=l&&n[0]&&n[0].parentNode||e,s==="string"||s==="number"){if(s==="number"&&(t=t.toString(),t===n))return n;if(l){let i=n[0];i&&i.nodeType===3?i.data!==t&&(i.data=t):i=document.createTextNode(t),n=me(e,n,r,i)}else n!==""&&typeof n=="string"?n=e.firstChild.data=t:n=e.textContent=t}else if(t==null||s==="boolean")n=me(e,n,r);else{if(s==="function")return Y(()=>{let i=t();for(;typeof i=="function";)i=i();n=je(e,i,n,r)}),()=>n;if(Array.isArray(t)){const i=[],f=n&&Array.isArray(n);if(ut(i,t,n,o))return Y(()=>n=je(e,i,n,r,!0)),()=>n;if(i.length===0){if(n=me(e,n,r),l)return n}else f?n.length===0?kt(e,i,r):Rn(e,n,i):(n&&me(e),kt(e,i));n=i}else if(t.nodeType){if(Array.isArray(n)){if(l)return n=me(e,n,r,t);me(e,n,null,t)}else n==null||n===""||!e.firstChild?e.appendChild(t):e.replaceChild(t,e.firstChild);n=t}}return n}function ut(e,t,n,r){let o=!1;for(let s=0,l=t.length;s<l;s++){let i=t[s],f=n&&n[e.length],c;if(!(i==null||i===!0||i===!1))if((c=typeof i)=="object"&&i.nodeType)e.push(i);else if(Array.isArray(i))o=ut(e,i,f)||o;else if(c==="function")if(r){for(;typeof i=="function";)i=i();o=ut(e,Array.isArray(i)?i:[i],Array.isArray(f)?f:[f])||o}else e.push(i),o=!0;else{const d=String(i);f&&f.nodeType===3&&f.data===d?e.push(f):e.push(document.createTextNode(d))}}return o}function kt(e,t,n=null){for(let r=0,o=t.length;r<o;r++)e.insertBefore(t[r],n)}function me(e,t,n,r){if(n===void 0)return e.textContent="";const o=r||document.createTextNode("");if(t.length){let s=!1;for(let l=t.length-1;l>=0;l--){const i=t[l];if(o!==i){const f=i.parentNode===e;!s&&!l?f?e.replaceChild(o,i):e.insertBefore(o,n):f&&i.remove()}else s=!0}}else e.insertBefore(o,n);return[o]}const ft=Symbol("store-raw"),pe=Symbol("store-node"),le=Symbol("store-has"),tn=Symbol("store-self");function nn(e){let t=e[he];if(!t&&(Object.defineProperty(e,he,{value:t=new Proxy(e,qn)}),!Array.isArray(e))){const n=Object.keys(e),r=Object.getOwnPropertyDescriptors(e);for(let o=0,s=n.length;o<s;o++){const l=n[o];r[l].get&&Object.defineProperty(e,l,{enumerable:r[l].enumerable,get:r[l].get.bind(t)})}}return t}function ze(e){let t;return e!=null&&typeof e=="object"&&(e[he]||!(t=Object.getPrototypeOf(e))||t===Object.prototype||Array.isArray(e))}function be(e,t=new Set){let n,r,o,s;if(n=e!=null&&e[ft])return n;if(!ze(e)||t.has(e))return e;if(Array.isArray(e)){Object.isFrozen(e)?e=e.slice(0):t.add(e);for(let l=0,i=e.length;l<i;l++)o=e[l],(r=be(o,t))!==o&&(e[l]=r)}else{Object.isFrozen(e)?e=Object.assign({},e):t.add(e);const l=Object.keys(e),i=Object.getOwnPropertyDescriptors(e);for(let f=0,c=l.length;f<c;f++)s=l[f],!i[s].get&&(o=e[s],(r=be(o,t))!==o&&(e[s]=r))}return e}function Ve(e,t){let n=e[t];return n||Object.defineProperty(e,t,{value:n=Object.create(null)}),n}function Ie(e,t,n){if(e[t])return e[t];const[r,o]=q(n,{equals:!1,internal:!0});return r.$=o,e[t]=r}function Un(e,t){const n=Reflect.getOwnPropertyDescriptor(e,t);return!n||n.get||!n.configurable||t===he||t===pe||(delete n.value,delete n.writable,n.get=()=>e[he][t]),n}function rn(e){at()&&Ie(Ve(e,pe),tn)()}function Nn(e){return rn(e),Reflect.ownKeys(e)}const qn={get(e,t,n){if(t===ft)return e;if(t===he)return n;if(t===it)return rn(e),n;const r=Ve(e,pe),o=r[t];let s=o?o():e[t];if(t===pe||t===le||t==="__proto__")return s;if(!o){const l=Object.getOwnPropertyDescriptor(e,t);at()&&(typeof s!="function"||e.hasOwnProperty(t))&&!(l&&l.get)&&(s=Ie(r,t,s)())}return ze(s)?nn(s):s},has(e,t){return t===ft||t===he||t===it||t===pe||t===le||t==="__proto__"?!0:(at()&&Ie(Ve(e,le),t)(),t in e)},set(){return!0},deleteProperty(){return!0},ownKeys:Nn,getOwnPropertyDescriptor:Un};function We(e,t,n,r=!1){if(!r&&e[t]===n)return;const o=e[t],s=e.length;n===void 0?(delete e[t],e[le]&&e[le][t]&&o!==void 0&&e[le][t].$()):(e[t]=n,e[le]&&e[le][t]&&o===void 0&&e[le][t].$());let l=Ve(e,pe),i;if((i=Ie(l,t,o))&&i.$(()=>n),Array.isArray(e)&&e.length!==s){for(let f=e.length;f<s;f++)(i=l[f])&&i.$();(i=Ie(l,"length",s))&&i.$(e.length)}(i=l[tn])&&i.$()}function on(e,t){const n=Object.keys(t);for(let r=0;r<n.length;r+=1){const o=n[r];We(e,o,t[o])}}function Fn(e,t){if(typeof t=="function"&&(t=t(e)),t=be(t),Array.isArray(t)){if(e===t)return;let n=0,r=t.length;for(;n<r;n++){const o=t[n];e[n]!==o&&We(e,n,o)}We(e,"length",r)}else on(e,t)}function Se(e,t,n=[]){let r,o=e;if(t.length>1){r=t.shift();const l=typeof r,i=Array.isArray(e);if(Array.isArray(r)){for(let f=0;f<r.length;f++)Se(e,[r[f]].concat(t),n);return}else if(i&&l==="function"){for(let f=0;f<e.length;f++)r(e[f],f)&&Se(e,[f].concat(t),n);return}else if(i&&l==="object"){const{from:f=0,to:c=e.length-1,by:d=1}=r;for(let a=f;a<=c;a+=d)Se(e,[a].concat(t),n);return}else if(t.length>1){Se(e[r],t,[r].concat(n));return}o=e[r],n=[r].concat(n)}let s=t[0];typeof s=="function"&&(s=s(o,n),s===o)||r===void 0&&s==null||(s=be(s),r===void 0||ze(o)&&ze(s)&&!Array.isArray(s)?on(o,s):We(e,r,s))}function dt(...[e,t]){const n=be(e||{}),r=Array.isArray(n),o=nn(n);function s(...l){xe(()=>{r&&l.length===1?Fn(n,l[0]):Se(n,l)})}return[o,s]}const Hn=80,jn=20,sn=1.7,ln=20,ve=20,Be=100,an=500,At=720*60*1e3,xt=3600*24*10/85,te="story_town_1",cn=new Array(495).fill(1).map((e,t)=>Math.floor(Hn*Math.pow(t+1,sn))),ke=new Array(500).fill(1).map((e,t)=>Math.floor(jn*Math.pow(t+1,sn))),un=(e,t=cn)=>{if(!e)return 0;const n=t.findIndex(s=>s>e);if(n<0&&e>0)return 1;const r=e-(t[n-1]??0),o=t[n]-(t[n-1]??0);return r/o},Te=(e,t=cn)=>{const n=t.findIndex(r=>r>e);return n<0&&e>0?t.length:n},zn=[{name:"hay_hand_1",label:"Hay hand wraps",equipSlot:"hand",craftComplexity:1,craftType:"basic",craftLevel:1,ingredients:[{name:"hay_1",count:25}],stats:{attMin:1,attMax:3}},{name:"hay_head_1",label:"Hay bandana",equipSlot:"head",craftComplexity:1,craftType:"basic",craftLevel:1,ingredients:[{name:"hay_1",count:25}],stats:{maxHealth:5}},{name:"hay_chest_1",label:"Hay vest",equipSlot:"chest",craftComplexity:1,craftType:"basic",craftLevel:1,ingredients:[{name:"hay_1",count:50}],stats:{physRes:1}},{name:"utility_axe_1",label:"Rusty axe",equipSlot:"weapon",utilityType:"axe",stats:{}}],Vn=[{name:"recipe_hay_hand_1",label:"Recipe: Hay hand wraps",craftableItem:"hay_hand_1"},{name:"recipe_bench_basic_1",label:"Recipe: Basic crafting table",craftableFurniture:"furniture_bench_basic_1"},{name:"recipe_hay_head_1",label:"Recipe: Hay bandana",craftableItem:"hay_head_1"},{name:"recipe_hay_chest_1",label:"Recipe: Hay vest",craftableItem:"hay_chest_1"},{name:"recipe_worm_kabab_1",label:"Recipe: Worm kabab",craftableItem:"food_worm_kabab_1"},{name:"recipe_camp_fire_1",label:"Recipe: Camp fire",craftableFurniture:"furniture_cook_basic_1"}].map(e=>({...e,useVerb:"Read",category:"book",exclusive:!0,use:(t,n,r,o)=>(o==null||o.onTask({noRepeat:!0,label:"Learning",description:e.label,duration:100,onComplete:()=>{var s;return(s=r==null?void 0:r.recipes())!=null&&s.find(l=>l.craftableItem===e.craftableItem)||(r==null||r.onAddRecipe(e.name),t==null||t.setState("prohibitedItems",[...(t==null?void 0:t.state.prohibitedItems)??[],e.name])),n==null||n.removeInventory(e.name,1),t==null||t.onNavigate("_back"),!0}}),!1)})),Wn=[{name:"hay_1",label:"Hay",category:"resource",maxStack:100},{name:"wood_log_1",label:"Wooden log",category:"resource",maxStack:100}],Xn=[{name:"wood_club_1",label:"Wooden Club",equipSlot:"weapon",craftType:"weapon",craftComplexity:1,craftLevel:1,ingredients:[{name:"wood_log_1",count:15}],masteryType:"mace",stats:{attMin:2,attMax:5,attSpeed:-.1}},{name:"wood_shield_1",label:"Wooden Shield",equipSlot:"offhand",craftType:"armour",craftComplexity:1,craftLevel:1,ingredients:[{name:"wood_log_1",count:20}],stats:{physRes:2,maxHealth:10}},{name:"wood_chest_1",label:"Wooden Plank Vest",equipSlot:"chest",craftType:"armour",craftComplexity:2,craftLevel:1,ingredients:[{name:"wood_log_1",count:40}],stats:{physRes:3,agility:-1}},{name:"stone_axe_1",label:"Stone Axe",equipSlot:"weapon",craftType:"weapon",craftComplexity:2,craftLevel:2,ingredients:[{name:"wood_log_1",count:10},{name:"stone_1",count:10}],masteryType:"axe",stats:{attMin:3,attMax:8,attSpeed:-.05,strength:1}},{name:"stone_helm_1",label:"Stone Helm",equipSlot:"head",craftType:"armour",craftComplexity:2,craftLevel:2,ingredients:[{name:"stone_1",count:20},{name:"hay_1",count:10}],stats:{physRes:4,maxHealth:10,intelligence:-1}},{name:"copper_sword_1",label:"Copper Shortsword",equipSlot:"weapon",craftType:"weapon",craftComplexity:3,craftLevel:2,ingredients:[{name:"copper_ingot_1",count:8},{name:"wood_log_1",count:5}],masteryType:"sword",stats:{attMin:4,attMax:10,attSpeed:.1,dexterity:1}},{name:"copper_chest_1",label:"Copper Breastplate",equipSlot:"chest",craftType:"armour",craftComplexity:3,craftLevel:2,ingredients:[{name:"copper_ingot_1",count:15}],stats:{physRes:5,magRes:1,strength:1}},{name:"iron_spear_1",label:"Iron Spear",equipSlot:"weapon",craftType:"weapon",craftComplexity:4,craftLevel:3,ingredients:[{name:"iron_ingot_1",count:12},{name:"wood_log_1",count:8}],masteryType:"spear",stats:{attMin:6,attMax:14,attSpeed:0,dexterity:2}},{name:"iron_helm_1",label:"Iron Helmet",equipSlot:"head",craftType:"armour",craftComplexity:4,craftLevel:3,ingredients:[{name:"iron_ingot_1",count:8}],stats:{physRes:6,maxHealth:15,charisma:-1}},{name:"iron_boots_1",label:"Iron Greaves",equipSlot:"foot",craftType:"armour",craftComplexity:4,craftLevel:3,ingredients:[{name:"iron_ingot_1",count:6}],stats:{physRes:3,agility:-1}}],Kn=[{name:"food_acorn_1",label:"Raw acorn (+2hp)",useVerb:"Eat",maxStack:10,hp:2},{name:"food_worm_1",label:"Raw worm (+1hp)",useVerb:"Eat",maxStack:10,hp:1},{name:"food_worm_kabab_1",label:"Worm... kabab (+4hp)",useVerb:"Eat",maxStack:10,craftType:"food",hp:4,craftComplexity:1,ingredients:[{name:"food_worm_1",count:10}]}].map(e=>({...e,category:"food",use:(t,n,r)=>{const o=r.player.stats.health,s=r.player.stats.maxHealth??10,l=Math.min(e.hp,s-o);return o<s?(r.onAddStat("health",l),n.removeInventory(e.name,1),!0):!1}})),Zn=[{name:"demonic_essense_1",label:"Demonic Essense",category:"unique"}],W=[zn,Vn,Wn,Xn,Kn,Zn].flat().reduce((e,t)=>(e[t.name]=t,e),{}),Gn=[{name:"unarmed",label:"Unarmed",bonus:new Array(an+1).fill(null).map((e,t)=>{if(!(!t||t%5!==0))return{level:t,stats:{attMin:t%10===0?1:0,attMax:1,attSpeed:t%50===0?.1:0}}}).filter(Boolean)}],Yn=[{name:"woodcutting",label:"Woodcutting",bonus:new Array(an+1).fill(null).map((e,t)=>{if(!(!t||t%5!==0))return{level:t,stats:{durationModifier:t%10===0?10:0},dropModifiers:[{name:"wood_log_1",chance:t%50===0?1:0}]}}).filter(Boolean)}],Ae=[Gn,Yn].flat().reduce((e,t)=>(e[t.name]=t,e),{}),fn=(e,t)=>{const n=Ae[e];if(!n)return{};const r=Te(t,ke),o=n.bonus.filter(s=>s.level<=r);return(o==null?void 0:o.reduce((s,l)=>(Object.entries(l.stats).forEach(([i,f])=>{s[i]=(s[i]??0)+f}),s),{}))??{}},Jn=(e,t,n)=>{const r=Ae[t];if(!r)return 0;const o=Te(n,ke),s=r.bonus.filter(l=>l.level<=o);return s==null?void 0:s.reduce((l,i)=>{var f,c;return l+(((c=(f=i.dropModifiers)==null?void 0:f.find(d=>d.name===e))==null?void 0:c.chance)??0)},0)};var Qn=x('<div class="font-bold m-2">'),Cn=x("<div>");const Xe=e=>(()=>{var t=Qn();return y(t,_(ne,{get each(){return e.lines},children:(n,r)=>(()=>{var o=Cn();return y(o,_(H,{get when(){return r()===0},children:'" .. '}),null),y(o,n,null),y(o,_(H,{get when(){return r()===e.lines.length-1},children:' .. "'}),null),o})()})),t})();var er=x("<span class=text-red-500>Fight scarecrows"),tr=x('<span class="font-bold ml-1">'),nr=x('<span class="font-bold text-blue-500 mr-1">Hay'),rr=x("<span class=font-bold>"),or=x('<span class="font-bold m-1">, ');const sr=[{name:"story_town_1",label:"Town",description:"You are in town",type:"dialogue",options:[{label:"Visit Farm",goto:"story_farmer_1"},{label:"Leave the town",goto:"story_forest_1"},{label:"Merchants",goto:"story_town_merchants_1"},{label:"Home",goto:"story_home_1"}]},{name:"story_farmer_1",label:"Farm",description:"A vacant expressionless farmer. Hasn't washed in days.",type:"dialogue",options:[{label:"Approach the farmer",goto:"story_farmer_2"},{label:er(),goto:"story_scarecrows_1"},{label:"Sell Hay",action:(e,t,n)=>{if(!t)return;const o=t.inventory().filter(s=>(s==null?void 0:s.name)==="hay_1").reduce((s,l)=>s+((l==null?void 0:l.count)??0),0);o&&(t.removeInventory("hay_1",o),n==null||n.onAddStat("gold",o),e==null||e.onLog(["You sell",(()=>{var s=tr();return y(s,o),s})()," ",nr(),"For ",(()=>{var s=rr();return y(s,o),s})()," gold"],"meta"))}}]},{name:"story_farmer_2",label:"Farmer",description:["You approach, he holds your wrist loosely like an exhausted child.",_(Xe,{lines:["Loathsome shadowed cloaks","Golden light shimmering, blind eyes","Fear, is Death knocking?"]}),"He sits and cries."],type:"dialogue",options:[{label:"Console",goto:"story_farmer_3"},{label:"Leave",goto:"_back"}]},{name:"story_farmer_3",label:"Farmer",description:_(Xe,{lines:["Am *I* the keeper of the wheat?","... or is it the keeper of me?"]}),type:"dialogue",options:(e,t)=>{const r=!e.state.markers.includes("story_farmer_gift_1"),o=t.inventory().reduce((l,i)=>(i==null?void 0:i.name)==="hay_1"?l+(i==null?void 0:i.count):l,0)<200;return[...r?[{label:"A gift... (200 Hay)",action:()=>{const[l,i]=["recipe_worm_kabab_1","recipe_camp_fire_1"].map(f=>W[f]);t.removeInventory("hay_1",200)===200&&(t.addInventory("recipe_worm_kabab_1",1),t.addInventory("recipe_camp_fire_1"),e.setState("markers",[...e.state.markers,"story_farmer_gift_1"]),e.onLog(["The farmer reciprocates:",(()=>{var f=or(),c=f.firstChild;return y(f,l==null?void 0:l.label,c),y(f,i==null?void 0:i.label,null),f})()],"drop"))},isDisabled:o}]:[],{label:"Silently leave",goto:"_back.2"}]}},{name:"story_scarecrows_1",label:"Scarecrows",description:"Fighting scarecrows",type:"encounter",cooldown:20,encounters:[{name:"enc_scarecrow_1",label:"Scarecrow",health:10,chance:1,experience:10,drops:[{name:"hay_1",chance:.5},{name:"food_worm_1",chance:1},{name:"recipe_hay_hand_1",chance:.05},{name:"recipe_hay_head_1",chance:.05},{name:"recipe_hay_chest_1",chance:.05}]}]}],lr=[{name:"furniture_bench_basic_1",label:"Basic bench",type:"craft",craftingComplexity:1,cratingType:"basic",ingredients:[{name:"wood_log_1",count:50}]},{name:"furniture_stash_1",label:"Basic stash",type:"stash",storageSize:5,ingredients:[{name:"wood_log_1",count:20},{name:"hay_1",count:50}]},{name:"furniture_cook_basic_1",label:"Camp fire",type:"craft",cratingType:"food",craftingComplexity:1,ingredients:[{name:"wood_log_1",count:50},{name:"hay_1",count:50}]}],ht=[lr].flat().reduce((e,t)=>(e[t.name]=t,e),{});var ir=x("<div class=font-bold>Stash"),ar=x("<div>Retrieve items from stash here, place in stash from your invent");const cr=[{name:"story_home_1",label:"Home",description:"Home sweet home",type:"dialogue",options:[{label:"Build",goto:"story_home_2"},{label:"Stash",goto:"story_stash_1"},{label:"Craft",goto:"story_home_4"}]},{name:"story_stash_1",label:"Stash",type:"dialogue",description:[ir(),ar()]},{name:"story_home_2",label:"Building",description:"Build new appliances",type:"dialogue",options:(e,t,n,r)=>{var s;return!n||!t?[]:((s=n==null?void 0:n.recipes())==null?void 0:s.filter(l=>!!l.craftableFurniture).map(l=>ht[l.craftableFurniture])).map(l=>{var i;return{label:l.label,action:()=>{r==null||r.onTask({noRepeat:!0,label:"Building",description:l.label,duration:100,onComplete:()=>ur(e,t,l)})},isDisabled:!et(t,l),subtext:(i=l.ingredients)==null?void 0:i.map(f=>`${W[f.name].label} (${f.count})`).join(" - ")}})??[]}},{name:"story_home_4",label:"Crafting",description:"A workshop",type:"dialogue",options:e=>{var t;return((t=e==null?void 0:e.state.furniture)==null?void 0:t.map(n=>ht[n]).filter(n=>n.type==="craft").map(n=>({label:n.label,goto:`story_craft_${n.cratingType}_1`})))??[]}},{name:"story_craft_basic_1",label:"Basic crafting",description:"A very simple crafting table",type:"dialogue",options:(e,t,n,r)=>{var s;return!n||!t?[]:((s=n==null?void 0:n.recipes())==null?void 0:s.filter(l=>!!l.craftableItem).map(l=>W[l.craftableItem]).filter(l=>l.craftType==="basic"&&l.craftComplexity===1)).map(l=>{var i;return{label:l.label,action:()=>{r==null||r.onTask({noRepeat:!0,label:"Crafting",description:l.label,duration:100,onComplete:()=>Et(t,l)})},isDisabled:!et(t,l),subtext:(i=l.ingredients)==null?void 0:i.map(f=>`${W[f==null?void 0:f.name].label} (${f==null?void 0:f.count})`).join(" - ")}})??[]}},{name:"story_craft_food_1",label:"Baic cooking",description:"A very simple cooking station",type:"dialogue",options:(e,t,n,r)=>{var s;return!n||!t?[]:((s=n==null?void 0:n.recipes())==null?void 0:s.filter(l=>!!l.craftableItem).map(l=>W[l.craftableItem]).filter(l=>l.craftType==="food"&&l.craftComplexity===1)).map(l=>{var i;return{label:l.label,action:()=>{r==null||r.onTask({noRepeat:!0,label:"Cooking",description:l.label,duration:100,onComplete:()=>Et(t,l)})},isDisabled:!et(t,l),subtext:(i=l.ingredients)==null?void 0:i.map(f=>`${W[f==null?void 0:f.name].label} (${f==null?void 0:f.count})`).join(" - ")}})??[]}}],Et=(e,t)=>{var n;e.addInventory(t.name,1),(n=t.ingredients)==null||n.forEach(r=>e.removeInventory(r.name,r.count))},ur=(e,t,n)=>{var r;e.setState("furniture",[...e.state.furniture,n.name]),(r=n.ingredients)==null||r.forEach(o=>t.removeInventory(o.name,o.count))},et=(e,t)=>{var n;return(n=t.ingredients)!=null&&n.length?t.ingredients.every(r=>((e==null?void 0:e.inventory().reduce((s,l)=>((l==null?void 0:l.name)===r.name&&(s=s+(l.count??1)),s),0))??0)>=r.count):!0};var fr=x("<span class=text-red-500>Venture deeper");const It=[{name:"enc_rabbit_1",label:"Little rabbit",chance:.4,experience:20,drops:[],health:5,stats:{attMin:0,attMax:1,attSpeed:10}},{name:"enc_deer_1",label:"Frightened deer",chance:.2,experience:40,drops:[],health:10,stats:{attMin:0,attMax:4,attSpeed:45}},{name:"enc_dead_tree_1",label:"Dead tree",chance:1,experience:10,health:10,drops:[{name:"food_acorn_1",chance:.5}]},{name:"enc_demonic_tree_1",label:"Demonic tree",chance:.001,experience:2e3,health:400,drops:[{name:"demonic_essense_1",chance:1}]}],dr=[{type:"dialogue",name:"story_forest_1",label:"Forest border",description:"The canopy casts a shadow. Sounds, eyes ... movement",options:(e,t,n)=>[{label:"Chop wood",goto:"task_chop_wood_1",isDisabled:!!!(n!=null&&n.equipment().find(o=>o.equipSlot==="weapon"&&o.utilityType==="axe"))},{label:fr(),goto:"story_forest_2"}]},{type:"task",name:"task_chop_wood_1",label:"Surrounded by trees",description:"Chopping wood",duration:100,masteryType:"woodcutting",cooldown:10,experience:1,utilityType:"axe",items:[{name:"wood_log_1",chance:1},{name:"food_acorn_1",chance:.1}]},{name:"story_forest_2",label:"Deep forest",description:"Creatures block your path...",type:"encounter",limit:5,onComplete:e=>{e==null||e.onNavigate("story_forest_3")},cooldown:20,encounters:It},{name:"story_forest_4",label:"Deep forest hunt",description:"You aren't scared of a few forest creatures",type:"encounter",onComplete:e=>{e==null||e.onNavigate("story_forest_3")},cooldown:20,encounters:It},{name:"story_forest_3",label:"welcome to the deep forest",type:"dialogue",description:"You made it!"}],Tt=e=>(t,n,r)=>{const o=r==null?void 0:r.player.stats.gold;return e.map(s=>{const l=W[s.name];return{label:`${(l==null?void 0:l.label)??"UNKNOWN"} - ${s.cost}g`,action:()=>{n==null||n.addInventory(l.name,1),r==null||r.onAddStat("gold",0-s.cost),t==null||t.onLog(`You purchase the ${l.label} for ${s.cost}g`,"meta")},isDisabled:s.cost>(o??0)}})},hr=[{type:"dialogue",name:"story_town_merchants_1",label:"Town Bazaar",description:"Souks, stalls, spices, hands... hands... hands...",options:[{label:"Tool merchant",goto:"story_town_merchant_tool_1"},{label:"Building merchant",goto:"story_town_merchant_building_1"}]},{type:"dialogue",name:"story_town_merchant_tool_1",label:"Tool Merchant",description:["A burly man, skin of leather ",_(Xe,{lines:["The very finest tools"]})],options:Tt([{name:"utility_axe_1",cost:50}])},{type:"dialogue",name:"story_town_merchant_building_1",label:"Building Merchant",description:["Beard down to his bare nipples ",_(Xe,{lines:["DIY... home improvements","Sweat...","Muscles..."]})],options:Tt([{name:"recipe_bench_basic_1",cost:100}])}],bt=[sr,cr,dr,hr].flat().reduce((e,t)=>(e[t.name]=t,e),{}),ue=Ye(),br=e=>{const t=B(()=>{var b;return((b=e.player.recipes)==null?void 0:b.map(u=>W[u]))??[]}),n=b=>{e.setPlayer("recipes",[...e.player.recipes??[],b].filter((u,g,h)=>h.indexOf(u)===g))},r=B(()=>{var b;return((b=e.player.equipment)==null?void 0:b.map(u=>W[u]))??[]}),o=B(()=>{var b;return((b=r().find(u=>u.equipSlot==="weapon"))==null?void 0:b.masteryType)??"unarmed"}),s=b=>{var u;return fn(b,((u=e.player.mastery)==null?void 0:u[b])??0)},l=B(()=>{var E;const b=r();let u=b.reduce((O,P)=>{var v;return O+(((v=P.stats)==null?void 0:v.attMin)??0)},1),g=b.reduce((O,P)=>{var v;return O+(((v=P.stats)==null?void 0:v.attMax)??0)},1);const h=o(),p=s(h);u+=(p==null?void 0:p.attMin)??0,g+=(p==null?void 0:p.attMax)??0;const A=1+Math.pow((((E=e.player.stats)==null?void 0:E.strength)??0)/100,.7),M=Math.round(u*A),S=Math.round(g*A);return[M,S]}),i=B(()=>{var z;const b=r(),u=100,g=Math.min(u,Math.max(1,((z=e.player.stats)==null?void 0:z.agility)??0)),h=1,p=ve/5,A=Math.sqrt(g/u),M=p*A,S=ve/5,E=Math.min(b.reduce((L,D)=>{var F;return L+(((F=D.stats)==null?void 0:F.attSpeed)??0)},0),1),O=E*S,P=ve/5,v=o(),k=s(v),$=(k.attSpeed??0)*P,I=(ve/2.5-1)*((A+E+(k.attSpeed??0))/3);return Math.max(ve-M-O-I-$,h)}),f=(b,u=1)=>{const g=(e.player.stats[b]??0)+u;e.setPlayer("stats",b,g)},c=(b,u=1)=>{const g=(e.player.mastery[b]??0)+u;e.setPlayer("mastery",b,g)},d=b=>r().find(u=>u.equipSlot===b.equipSlot)?!1:(e.setPlayer("equipment",[...e.player.equipment,b.name]),Object.entries(b.stats??{}).forEach(([u,g])=>f(u,g)),!0),a=b=>!e.player.equipment.includes(b.name)?!1:(e.setPlayer("equipment",[...e.player.equipment.filter(g=>g!==b.name)]),Object.entries(b.stats??{}).forEach(([g,h])=>f(g,0-h)),!0),m={attackRate:i,attackDamage:l,player:e.player,equipment:r,onAddStat:f,onAddMastery:c,onEquip:d,onUnequip:a,recipes:t,getMasteryPerk:s,weaponMastery:o,onAddRecipe:n};return _(ue.Provider,{value:m,get children(){return e.children}})},Lt=(e,t)=>(typeof t=="object"&&(t=JSON.stringify(t)),window.localStorage.setItem(e,`${t}`)),tt=e=>{const t=window.localStorage.getItem(e);if(!t)return t??void 0;try{return JSON.parse(t)}catch{return t}},de=Ye(),gr=e=>{const t=(d,a=1)=>{const[m,b]=i(e.state.inventory,d,a);return b>0&&e.setState("inventory",m),b},n=B(()=>e.state.inventory),r=B(()=>e.state.stash);_e(d=>{const a=e.state.furniture.map(b=>ht[b]).filter(b=>b.type==="stash").reduce((b,u)=>b+(u.storageSize??0),0);if(a===d)return a;const m=e.state.stash.filter(Boolean);if(a<m.length)throw new Error("Invalid stash, size too small for contents");return e.setState("stash",[...m,...new Array(a-m.length).fill(null)]),a},0);const o=(d,a=1)=>{const[m,b]=f(e.state.inventory,d,a);return b>0&&e.setState("inventory",m),b},s=(d,a=1)=>{const[m,b]=i(e.state.stash,d,a),[u,g]=f(e.state.inventory,d,a);return g!==b?(console.error(`Unable to move ${d} from invent to stash`),0):(b>0&&xe(()=>{e.setState("inventory",u),e.setState("stash",m)}),b)},l=(d,a=1)=>{const[m,b]=f(e.state.stash,d,a),[u,g]=i(e.state.inventory,d,a);return b!==g?(console.error(`Unable to move ${d} from stash to invent`),0):(b>0&&xe(()=>{e.setState("inventory",u),e.setState("stash",m)}),b)},i=(d,a,m)=>{if(!W[a])return console.warn("Invalid or not found item",a),[d,0];const b=W[a];if(!m)return[d,0];if(m===1/0)return console.error("Cannot add infinite items to invent"),[d,0];let u=[...d];if(b.exclusive&&u.find(h=>(h==null?void 0:h.name)===b.name))return[u,0];let g=m;return b.maxStack&&(u=u.map(h=>{if(!(h!=null&&h.name)||!g)return h;if(h.name===b.name&&h.count<b.maxStack){let p=Math.min(h.count+g,b.maxStack);return g-=p-h.count,{...h,count:p}}return h})),g&&(u=u.map(h=>{if(!g)return h;if(h===null){const p=Math.min(g,b.maxStack??1);return g-=p,{name:b.name,count:p}}return h})),[u,m-g]},f=(d,a,m=1)=>{if(!m)return[d,0];if(!W[a])return console.warn("Invalid or not found name",a),[d,0];const b=W[a];if(d.findLastIndex(p=>(p==null?void 0:p.name)===b.name)<0)return[d,0];let g=m;const h=[...d.toReversed().map(p=>{if(!g||(p==null?void 0:p.name)!==b.name)return p;if(p.count<=g)return g-=p.count,null;const A=p.count-g;return g=0,{...p,count:A}}).reverse()].filter(Boolean);return h.push(...new Array(ln-h.length).fill(null)),[h,m-g]},c={inventory:n,stash:r,addInventory:t,removeInventory:o,addStash:s,removeStash:l};return _(de.Provider,{value:c,get children(){return e.children}})},Rt={stats:{health:10,maxHealth:10,gold:0,experience:0},equipment:[],mastery:{},recipes:[]},Mt={prohibitedItems:[],stash:new Array(2).fill(null),furniture:[],inventory:new Array(ln).fill(null),blockedEncounters:[],markers:[]},ee=Ye(),Oe="freeze_time",Pt="state",mr=e=>{const[t,n]=q([]),[r,o]=q(te),[s,l]=dt(Rt),[i,f]=dt(Mt),[c,d]=q([te]),[a,m]=q(0),[b,u]=q(!0),[g,h]=q(xt),[p,A]=q(15),[M,S]=q([]);Ze(()=>{setInterval(()=>{b()||(E(),M().forEach(([L,D])=>D()))},Be)});const E=()=>{M().length&&(m(a()+1),a()>g()&&(h(g()+xt),A(p()+1)),M().forEach(([L,D])=>D()))};setInterval(()=>{$()},1e4);const O=(L,D)=>{M().find(([F])=>F===L)||S([...M(),[L,D]])},P=L=>{S([...M().filter(([D])=>D!==L)])};document.addEventListener("visibilitychange",()=>{if(document.visibilityState==="hidden")$(),Lt(Oe,Date.now());else{const L=tt(Oe);if(L){const D=Math.min(Date.now()-L,At);let F=Math.floor(D/Be);T(F)}else u(!1)}});const v=()=>{const L=tt(Pt);L&&(L.state.blockedEncounters=L.state.blockedEncounters??[],L.state.markers=L.state.markers??[],xe(()=>{o(L.story),l(L.player),f(L.state),d(L.nav),m(L.ticks)}));const D=tt(Oe);if(D){const F=Math.min(Date.now()-D,At);let X=Math.floor(F/Be);T(X)}else u(!1)},k=()=>{xe(()=>{l(Rt),f(Mt),m(0),I(te)}),$()};window.cs=k;const $=()=>{console.log("Saving...");const L={player:be(s),state:be(i),ticks:a(),story:r(),nav:c()};Lt(Pt,L)},T=L=>{L>0?requestIdleCallback(()=>{let D=1e3;for(;L>0&&D>0;)E(),L--,D--;T(L)}):u(!1)};window.addEventListener("load",v),window.addEventListener("beforeunload",()=>{$(),window.localStorage.setItem(Oe,`${Date.now()}`)});const I=L=>{if(L==="_start"&&(L=te),L===te){d([te]),o(te);return}const D=/^_back/.test(L);if(!D&&!bt[L]){console.error(`Unknown story ${L}`);return}if(D){const[F,X]=L.split("."),J=Math.min(parseInt(X??"1"),c().length+1);L=c().at(-1-J)??te,c().length>1&&d(c().slice(0,-J))}else c().at(-1)!==L&&d([...c(),L]);o(L)},z={state:i,setState:f,year:p,startActivity:O,endActivity:P,onNavigate:I,nav:c,onLog:(L,D="basic")=>{var J;const F=new Date,X={msg:L,time:[F.getHours(),F.getMinutes(),F.getSeconds()].join(":"),type:D};n([...t().slice(Math.min(((J=t())==null?void 0:J.length)-999,0)),X])},log:t,pause:b,setNav:d,onClearState:k};return _(ee.Provider,{value:z,get children(){return _(gr,{state:i,setState:f,get children(){return _(br,{player:s,setPlayer:l,get children(){return _(vr,{story:r,setStory:o,get children(){return e.children}})}})}})}})},ge=Ye(),vr=e=>{const t=N(ee),n=N(ue),[r,o]=q();_e(()=>{const a=e.story()??te;a!=="task"&&o(bt[a]??bt[te])});const s=()=>{var b;const a=r();if(!a)return;if(a.type==="task")return{name:"task",label:a.label,health:a.duration??0,chance:1,drops:a.items};const m=Math.random();if(!(a.type!=="encounter"||!((b=a.encounters)!=null&&b.length)))return a.encounters.filter(u=>!(t!=null&&t.state.blockedEncounters.includes(u.name))).sort((u,g)=>u.chance-g.chance).find(u=>m<=u.chance)},l=a=>{const{attMin:m,attMax:b}=a.stats??{};if(!(!m||!b))return m+Math.round(Math.random()*(m-b))},i=a=>f(a==null?void 0:a.drops),f=a=>{const m=r();if(!m)return;a=a??m.items??[];let b=[];const u=m.masteryType?(n==null?void 0:n.player.mastery[m.masteryType])??0:0;for(let g of a){let h=g.chance;for(u&&(h=h+Jn(g.name,m.masteryType,u));h>0;)Math.random()<=h&&b.push(g),h--}return b==null?void 0:b.map(g=>{const h=W[g.name];if(!h){console.error(`Unable to find drop ${g.name}`);return}return h.name}).filter(Boolean)},d={story:r,getEncounter:s,getDamage:l,getDrops:i,getItems:f,onTask:a=>{t==null||t.setNav([...(t==null?void 0:t.nav())??[],"task"]),e.setStory("task"),o({name:"task",type:"task",...a,onComplete:a.noRepeat?a.onComplete??(()=>t==null?void 0:t.onNavigate("_back")):void 0})}};return _(ge.Provider,{value:d,get children(){return e.children}})};var pr=x('<div class="flex flex-row mt-auto gap-2"><div class="w-full border content-center cursor-pointer h-12 text-lg font-bold mt-auto">Go back</div><div class="w-full border content-center cursor-pointer h-12 text-lg font-bold mt-auto">Town'),_r=x('<div class="flex flex-col gap-5 p-2 h-full overflow-y-auto">'),yr=x("<div class=text-gray-500>Nothing here..."),wr=x('<span class="text-xs text-gray-400">'),$r=x('<div class="w-full border content-center h-12 text-lg font-bold flex flex-col justify-center">');const Sr=()=>{const e=N(ee),t=N(de),n=N(ue),r=N(ge),o=l=>{if(l.goto)return e==null?void 0:e.onNavigate(l.goto);if(l.action&&e&&t&&n&&r)return l.action(e,t,n,r)},s=B(()=>{var i;const l=(i=r==null?void 0:r.story())==null?void 0:i.options;return Array.isArray(l)?l:e&&t&&n&&r?(l==null?void 0:l(e,t,n,r))??[]:[]});return(()=>{var l=_r();return y(l,_(H,{get when(){var i;return((i=r==null?void 0:r.story())==null?void 0:i.type)!=="encounter"},get children(){return _(H,{get when(){return s().length},get fallback(){return yr()},get children(){return _(ne,{get each(){return s()},children:i=>(()=>{var f=$r();return f.$$click=()=>!i.isDisabled&&o(i),y(f,()=>i.label,null),y(f,_(H,{get when(){return i.subtext},get children(){var c=wr();return y(c,()=>i.subtext),c}}),null),Y(c=>{var d=!!i.isDisabled,a=!i.isDisabled;return d!==c.e&&f.classList.toggle("text-gray-500",c.e=d),a!==c.t&&f.classList.toggle("cursor-pointer",c.t=a),c},{e:void 0,t:void 0}),f})()})}})}}),null),y(l,_(H,{get when(){var i;return((i=r==null?void 0:r.story())==null?void 0:i.name)!==te},get children(){var i=pr(),f=i.firstChild,c=f.nextSibling;return f.$$click=()=>o({label:"Go back",goto:"_back"}),c.$$click=()=>o({label:"Back to town",goto:"_start"}),i}}),null),l})()};ce(["click"]);var kr=x("<div>");const C=e=>(()=>{var t=kr();return Je(t,"click",e.onClick),y(t,()=>e.children),Y(()=>Pn(t,`${e.class??""} bg-black rounded py-1 px-2 cursor-pointer hover:outline hover:outline-blue-500 font-bold text-xs h-full`)),t})();ce(["click"]);var Ar=x("<div class=text-sm>"),xr=x("<button class=m-auto> "),Er=x("<button class=m-auto>equip"),Ir=x('<div class="px-2 py-1 bg-blue-900 border border-blue-500 rounded w-full flex flex-row justify-between items-center mb-2"><span class="font-bold text-xl text-black">Stash</span><div class="flex flex-row gap-4">'),Tr=x('<div class="px-2 py-1 bg-red-900 border border-red-500 w-full flex flex-row justify-between items-center rounded"><span class="font-bold text-xl text-black">Drop</span><div class="flex flex-row gap-4">'),Lr=x('<div class="absolute bottom-0 left-0 w-full border-t content-center p-2 bg-slate-500"><div class="flex flex-col gap-2"><div class="flex flex-row justify-center relative"><span class="absolute left-0 top-0 font-bold cursor-pointer border-2 rounded-xl px-2 hover:bg-white hover:text-black">X</span><div class=font-bold> (<!>)</div></div><div class="flex flex-col gap-1 justify-between"><div class="w-full flex flex-row justify-between gp-2 mb-2">'),Rr=x('<div class="h-full relative"><div class="flex flex-col gap-2 h-7/8 overflow-auto p-2">'),Mr=x('<div class="border p-1 cursor-pointer flex flex-col"><div class="flex flex-row justify-between"><div></div><div class="flex flex-row gap-2 items-center"><div class=text-sm>[<!>]</div>(<!>)'),Pr=x('<div class="border p-1 flex flex-row justify-between border-gray-700 text-gray-700">Empty');const Or=()=>{const e=N(ee),t=N(de),n=N(ue),r=N(ge),[o,s]=q(),l=u=>{u<0||!(t!=null&&t.inventory().at(u))||s(u)},i=B(()=>{const u=o()??-1;if(u<0)return;const g=t==null?void 0:t.inventory().at(u);return g?{item:W[g.name],count:g.count}:null}),f=()=>{var h,p;const u=i();if(!u||!e||!t||!n||!r)return;const g=u.count;(p=(h=u.item).use)!=null&&p.call(h,e,t,n,r)&&g<=1&&s(void 0)},c=()=>{const u=i(),g=u?u.item:null;g!=null&&g.equipSlot&&n!=null&&n.onEquip(g)&&(t==null||t.removeInventory(g.name,1),s(void 0))},d=u=>{const g=i();g&&(t==null||t.removeInventory(g.item.name,u),u>=(g.count??1)&&s(void 0))},a=B(()=>{var u;return!(!i()||((u=i())==null?void 0:u.item.category)==="unique")}),m=u=>{const g=i();g&&(u=u===1/0?(t==null?void 0:t.inventory().reduce((h,p)=>(p==null?void 0:p.name)===g.item.name?h+(p.count??0):h,0))??0:u,g&&(t==null||t.addStash(g.item.name,u)))},b=B(()=>e==null?void 0:e.nav().includes("story_home_1"));return(()=>{var u=Rr(),g=u.firstChild;return g.$$click=()=>s(void 0),y(g,_(ne,{get each(){return(t==null?void 0:t.inventory())??[]},children:(h,p)=>_(dn,{item:h,onSelect:()=>l(p())})})),y(u,_(H,{get when(){return i()},get children(){var h=Lr(),p=h.firstChild,A=p.firstChild,M=A.firstChild,S=M.nextSibling,E=S.firstChild,O=E.nextSibling;O.nextSibling;var P=A.nextSibling,v=P.firstChild;return M.$$click=()=>s(void 0),y(S,()=>{var k;return(k=i())==null?void 0:k.item.label},E),y(S,()=>{var k;return(k=i())==null?void 0:k.count},O),y(p,_(H,{get when(){return i().item.stats},get children(){var k=Ar();return y(k,()=>Object.entries(i().item.stats??{}).filter(([$,T])=>!!T).map(([$,T])=>`[${$}: ${T}]`).join("")),k}}),P),y(v,_(H,{get when(){var k;return(k=i())==null?void 0:k.item.use},get children(){var k=xr(),$=k.firstChild;return k.$$click=f,y(k,()=>{var T;return((T=i())==null?void 0:T.item.useVerb)??"Use"},$),k}}),null),y(v,_(H,{get when(){var k;return((k=i())==null?void 0:k.item).equipSlot},get children(){var k=Er();return k.$$click=c,k}}),null),y(P,_(H,{get when(){return b()},get children(){var k=Ir(),$=k.firstChild,T=$.nextSibling;return y(T,_(C,{onClick:()=>m(1),children:"One"}),null),y(T,_(C,{onClick:()=>{var I;return m(((I=i())==null?void 0:I.count)??1)},children:"Stack"}),null),y(T,_(C,{onClick:()=>m(1/0),children:"All"}),null),k}}),null),y(P,_(H,{get when(){return a()},get children(){var k=Tr(),$=k.firstChild,T=$.nextSibling;return y(T,_(C,{onClick:()=>d(1),children:"One"}),null),y(T,_(C,{onClick:()=>{var I;return d(((I=i())==null?void 0:I.count)??1)},children:"Stack"}),null),y(T,_(C,{onClick:()=>d(1/0),children:"All"}),null),k}}),null),h}}),null),u})()},dn=e=>{const t=s=>{s.stopPropagation(),e.onSelect()},n=B(()=>e.item?W[e.item.name]:null),r=B(()=>{const s=n();return s?s.category??s.equipSlot??"unknown":null}),o=B(()=>{const s=n();return s?s.category??(s.equipSlot?"equip":"unknown"):null});return _(H,{get when(){return n()},get fallback(){return Pr()},get children(){var s=Mr(),l=s.firstChild,i=l.firstChild,f=i.nextSibling,c=f.firstChild,d=c.firstChild,a=d.nextSibling;a.nextSibling;var m=c.nextSibling,b=m.nextSibling;return b.nextSibling,s.$$click=t,y(i,()=>n().label),y(c,r,a),y(f,()=>{var u;return(u=e.item)==null?void 0:u.count},b),Y(u=>{var g=o()==="book",h=o()==="resource",p=o()==="food",A=o()==="equip";return g!==u.e&&c.classList.toggle("text-yellow-500",u.e=g),h!==u.t&&c.classList.toggle("text-green-500",u.t=h),p!==u.a&&c.classList.toggle("text-red-500",u.a=p),A!==u.o&&c.classList.toggle("text-blue-500",u.o=A),u},{e:void 0,t:void 0,a:void 0,o:void 0}),s}})};ce(["click"]);var Dr=x('<div class="w-full border rounded relative text-black bg-gray-500"><div class="ease-linear w-0 h-full rounded"></div><div class="absolute left-1/2 top-1/2 -translate-1/2 whitespace-nowrap">');const gt=e=>{const t=N(ee),[n,r]=q(e.ticks),o=()=>{let s=n();s<=0&&(e.onFinish(),s=e.ticks+1),r(s-1)};return Ze(()=>t==null?void 0:t.startActivity(e.name,o)),Ge(()=>t==null?void 0:t.endActivity(e.name)),_(Le,{get max(){return e.ticks},get value(){return e.ticks-n()},get type(){return e.type},get showPc(){return e.showPc},get showNumber(){return e.showNumber},get label(){return e.label}})},Le=e=>{const t=B(()=>Math.min(e.value/e.max*100,100));return(()=>{var n=Dr(),r=n.firstChild,o=r.nextSibling;return y(o,_(Me,{get children(){return[_(Z,{get when(){return e.showPc},get children(){return[ie(()=>e.label)," (",ie(()=>t().toFixed(0)),"%)"]}}),_(Z,{get when(){return e.showNumber},get children(){return[ie(()=>e.label)," ",ie(()=>e.value)]}})]}})),Y(s=>{var l=!e.isSmall,i=t()+"%",f=!e.type,c=e.type==="green",d=e.type==="yellow",a=e.type==="blue",m=e.type==="red";return l!==s.e&&n.classList.toggle("h-full",s.e=l),i!==s.t&&On(r,"width",s.t=i),f!==s.a&&r.classList.toggle("bg-white",s.a=f),c!==s.o&&r.classList.toggle("bg-green-500",s.o=c),d!==s.i&&r.classList.toggle("bg-yellow-500",s.i=d),a!==s.n&&r.classList.toggle("bg-blue-500",s.n=a),m!==s.s&&r.classList.toggle("bg-red-500",s.s=m),s},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0}),n})()};var Br=x('<div class="flex flex-col justify-between items-center cursor-pointer"><div class="text-xl font-bold"></div><div class="h-4 w-32">'),Ur=x('<div class="flex flex-row justify-between items-center font-bold mb-2"><div>Level</div><div>Stats'),Nr=x('<div class="flex flex-col h-full"><div class="h-7/8 p-2"></div><div class="h-1/8 flex flex-row justify-between gap-2 p-2"><button>Skills</button><button>Mastery</button><button>Recipes'),qr=x('<div class="flex flex-row justify-between items-center cursor-pointer"><div></div><div class="h-4 w-32">'),Fr=x('<div class="flex flex-row justify-between items-center border-b border-gray-700"><div></div><div class=text-xs>'),Hr=x('<div class="flex flex-row justify-between items-center"><div>');const jr=()=>{const[e,t]=q("mastery"),n=N(ue),[r,o]=q(),s=B(()=>Object.entries((n==null?void 0:n.player.mastery)??{}).map(([f,c])=>{const d=Ae[f];return{label:(d==null?void 0:d.label)??"",progress:un(c,ke)*100,level:Te(c,ke),name:f}})??[]),l=f=>{o(void 0),t(f)},i=B(()=>{var a,m,b;const f=(a=r())==null?void 0:a.name;if(f===void 0)return;const c=Te((n==null?void 0:n.player.mastery[f])??0,ke),d=(m=Ae[f])==null?void 0:m.bonus.findLastIndex(u=>u.level<=c);return(b=Ae[f])==null?void 0:b.bonus.slice(0,(d??0)+2).map((u,g,h)=>({level:u.level,stats:Object.entries(u.stats??{}).filter(([p,A])=>!!A).map(([p,A])=>`[${p}: ${A}]`).join(""),isLast:g===h.length-1}))});return(()=>{var f=Nr(),c=f.firstChild,d=c.nextSibling,a=d.firstChild,m=a.nextSibling,b=m.nextSibling;return y(c,_(Me,{get children(){return[_(Z,{get when(){return e()==="skills"},children:"TODO"}),_(Z,{get when(){return ie(()=>e()==="mastery")()&&!r()},get children(){return _(ne,{get each(){return s()},children:u=>(()=>{var g=qr(),h=g.firstChild,p=h.nextSibling;return g.$$click=()=>o(u),y(h,()=>u.label),y(p,_(Le,{get label(){return`${u.level}`},type:"yellow",max:100,get value(){return u.progress},showPc:!0})),g})()})}}),_(Z,{get when(){return ie(()=>e()==="mastery")()&&r()},get children(){return[(()=>{var u=Br(),g=u.firstChild,h=g.nextSibling;return y(g,()=>{var p;return(p=r())==null?void 0:p.label}),y(h,_(Le,{get label(){return`${r().level}`},type:"yellow",max:100,get value(){return r().progress},showPc:!0})),u})(),Ur(),_(ne,{get each(){return i()},children:u=>(()=>{var g=Fr(),h=g.firstChild,p=h.nextSibling;return y(h,()=>u.level),y(p,(()=>{var A=ie(()=>!!u.isLast);return()=>A()?"???":u.stats})()),g})()})]}}),_(Z,{get when(){return e()==="recipes"},get children(){return _(ne,{get each(){return n==null?void 0:n.recipes()},children:u=>(()=>{var g=Hr(),h=g.firstChild;return y(h,()=>u.label),g})()})}})]}})),a.$$click=()=>l("skills"),m.$$click=()=>l("mastery"),b.$$click=()=>l("recipes"),Y(u=>{var g=e()==="skills",h=e()==="mastery",p=e()==="recipes";return g!==u.e&&a.classList.toggle("selected",u.e=g),h!==u.t&&m.classList.toggle("selected",u.t=h),p!==u.a&&b.classList.toggle("selected",u.a=p),u},{e:void 0,t:void 0,a:void 0}),f})()};ce(["click"]);var zr=x('<span class="text-red-800 font-bold">'),Vr=x('<span class="text-green-800 font-bold">'),Ot=x('<span class="text-red-800 font-bold m-1">'),Wr=x('<span class="font-bold m-1">'),Xr=x("<span class=font-bold>"),Kr=x("<div class=text-red-800>"),Zr=x("<div class=h-8><div class=h-2>"),Gr=x("<div class=h-2>"),Yr=x('<div class="h-8 mt-5">'),Jr=x('<div class="flex flex-col gap-1 p-1 h-full"><div class=bg-black>Attacking (<!>)');const Qr=()=>{const e=N(ee),t=N(ge),n=N(ue),r=N(de),[o,s]=q(),[l,i]=q(25),[f,c]=q(0),[d,a]=q(0),[m,b]=q(),[u,g]=q();_e(S=>{var E,O;return(E=t==null?void 0:t.story())!=null&&E.name&&(e!=null&&e.pause())&&!S?(s((O=t==null?void 0:t.story())==null?void 0:O.name),e==null||e.startActivity(`${o()}_catchup`,h),!S):!(e!=null&&e.pause())&&S?(e==null||e.endActivity(`${o()}_catchup`),!S):S},!1);const h=()=>{l()<=0&&u()?p():i(l()-1)};Ze(()=>{var S,E;s((S=t==null?void 0:t.story())==null?void 0:S.name),i((n==null?void 0:n.attackRate())??25),g(t==null?void 0:t.getEncounter()),b((E=u())==null?void 0:E.health)});const p=()=>{var U,z,L;const S=!(e!=null&&e.pause()),[E,O]=[n,t==null?void 0:t.story()],P=u(),v=m();if(!E||!O)return;if(i((n==null?void 0:n.attackRate())??25),!P&&O.limit&&d()>=O.limit){(U=O.onComplete)==null||U.call(O,e,r,n,t);return}if(!P){g(t==null?void 0:t.getEncounter()),b((z=u())==null?void 0:z.health);return}if(!v)return;const[k,$]=(n==null?void 0:n.attackDamage())??[0,1],T=k+Math.round(Math.random()*($-k)),I=v-Math.min(T,v);if(S&&(e==null||e.onLog(["You hit the ",(()=>{var D=zr();return y(D,P.label),D})()," for ",(()=>{var D=Vr();return y(D,T),D})()," damage"],"basic")),n==null||n.onAddMastery(n==null?void 0:n.weaponMastery(),T),I<=0){S&&(e==null||e.onLog(["You killed the",(()=>{var F=Ot();return y(F,P.label),F})()],"good")),P.isUnique&&(e==null||e.setState("blockedEncounters",[...e.state.blockedEncounters,P.name])),a(d()+1),g(void 0),P.experience&&(n==null||n.onAddStat("experience",P.experience));const D=(L=t==null?void 0:t.getDrops(P))==null?void 0:L.filter(F=>{var X;return!((X=e==null?void 0:e.state.prohibitedItems)!=null&&X.includes(F))}).filter(F=>!!(r!=null&&r.addInventory(F)));if(D!=null&&D.length&&S&&(e==null||e.onLog(["It dropped:",(()=>{var F=Wr();return y(F,D==null?void 0:D.map(X=>{var J;return(J=W[X])==null?void 0:J.label}).join(", ")),F})()],"drop")),O.noRepeat)return;c(O.cooldown??0),e==null||e.startActivity(`${o()}_wait`,M)}b(Math.max(I,0))},A=()=>{var $;const S=!(e!=null&&e.pause()),[E,O]=[n==null?void 0:n.player,t==null?void 0:t.story()];if(!E||!O)return;const{attMin:P,attMax:v}=(($=u())==null?void 0:$.stats)??{};if(P===void 0||v===void 0)return;const k=P+Math.round(Math.random()*(v-P));if(S&&(e==null||e.onLog([(()=>{var T=Ot();return y(T,u().label),T})()," hits you for ",(()=>{var T=Xr();return y(T,k),T})()," damage!"],"bad")),E.stats.health<=k){e==null||e.onNavigate("_start");return}n==null||n.onAddStat("health",-k)},M=()=>{if(f()<=0)return e==null||e.endActivity(`${o()}_wait`),p();c(f()-1)};return Ge(()=>{e==null||e.endActivity(`${o()}_wait`)}),_(H,{get when(){return!(e!=null&&e.pause())},get children(){var S=Jr(),E=S.firstChild,O=E.firstChild,P=O.nextSibling;return P.nextSibling,y(E,d,P),y(E,_(H,{get when(){var v;return(v=t==null?void 0:t.story())==null?void 0:v.limit},get children(){return[" / ",ie(()=>{var v;return(v=t==null?void 0:t.story())==null?void 0:v.limit})]}}),P),y(S,_(H,{get when(){var v;return ie(()=>{var k;return!!(!u()&&((k=t==null?void 0:t.story())!=null&&k.limit))})()&&d()>=(((v=t==null?void 0:t.story())==null?void 0:v.limit)??0)},children:"There is nothing left here to destroy"}),null),y(S,_(H,{get when(){return u()},fallback:"Waiting.. Searching.. Wondering..",get children(){return[(()=>{var v=Kr();return y(v,()=>{var k;return(k=u())==null?void 0:k.label}),v})(),(()=>{var v=Zr(),k=v.firstChild;return y(v,_(Le,{type:"red",get max(){return(n==null?void 0:n.player.stats.maxHealth)??10},get value(){return(n==null?void 0:n.player.stats.health)??0},label:"You",showNumber:!0}),k),y(k,_(gt,{get name(){return`${o()}_att`},get ticks(){return l()},onFinish:p,type:"yellow",isSmall:!0})),v})(),(()=>{var v=Yr();return y(v,_(Le,{type:"red",get max(){return u().health},get value(){return m()},get label(){var k;return(k=u())==null?void 0:k.label},showNumber:!0}),null),y(v,_(H,{get when(){var k,$;return($=(k=u())==null?void 0:k.stats)==null?void 0:$.attSpeed},get children(){var k=Gr();return y(k,_(gt,{get name(){return`${o()}_enc`},get ticks(){return u().stats.attSpeed},onFinish:A,type:"yellow",isSmall:!0})),k}}),null),v})()]}}),null),S}})};var Cr=x('<span class="text-red-800 font-bold m-1">'),eo=x('<span class="font-bold m-1">'),to=x("<div class=text-red-800>"),no=x("<div class=h-8>"),ro=x('<div class="flex flex-col gap-1 p-1 h-full"><div class=bg-black>');const oo=()=>{const e=N(ee),t=N(de),n=N(ue),r=N(ge),[o,s]=q(),[l,i]=q(!1),[f,c]=q(0),[d,a]=q(0),m=B(()=>{var p,A,M;const h=(p=r==null?void 0:r.story())==null?void 0:p.masteryType;if(h){const S=fn(h,(n==null?void 0:n.player.mastery[h])??0);return Math.max(1,(((A=r==null?void 0:r.story())==null?void 0:A.duration)??100)-(S.durationModifier??0))}return((M=r==null?void 0:r.story())==null?void 0:M.duration)??100});_e(()=>{var h;(h=r==null?void 0:r.story())!=null&&h.utilityType&&(n!=null&&n.equipment().find(p=>{var A;return p.utilityType===((A=r==null?void 0:r.story())==null?void 0:A.utilityType)})||e==null||e.onNavigate("_back"))}),_e(h=>{var p,A;return m()?(p=r==null?void 0:r.story())!=null&&p.name&&(e!=null&&e.pause())&&!h?(s((A=r==null?void 0:r.story())==null?void 0:A.name),a(d()??m()),e==null||e.startActivity(`${o()}_catchup`,b),!h):!(e!=null&&e.pause())&&h?(e==null||e.endActivity(`${o()}_catchup`),!h):h:h},!1);const b=()=>{d()<=0&&l()?u():a(d()-1)};Ze(()=>{var h;s((h=r==null?void 0:r.story())==null?void 0:h.name),i(!0)});const u=()=>{var A,M;const h=r==null?void 0:r.story();if(!n||!r||!h)return;if(!l()){a(m()),i(!0);return}i(!1),e==null||e.onLog(["You finished",(()=>{var S=Cr();return y(S,h.description),S})()],"good"),h.masteryType&&(n==null||n.onAddMastery(h.masteryType,h.experience??0));const p=(A=r.getItems())==null?void 0:A.filter(S=>{var E;return!((E=e==null?void 0:e.state.prohibitedItems)!=null&&E.includes(S))}).filter(S=>!!(t!=null&&t.addInventory(S)));if(p!=null&&p.length){const S=p.map(E=>{var O;return((O=W[E])==null?void 0:O.label)??"Unknown"});e==null||e.onLog(["You gained:",(()=>{var E=eo();return y(E,S==null?void 0:S.join(", ")),E})()],"drop")}if(h.noRepeat)return((M=h.onComplete)==null?void 0:M.call(h,e,t,n,r))??(e==null?void 0:e.onNavigate("_back"));c(h.cooldown??0),e==null||e.startActivity(`${o()}_wait`,g)},g=()=>{if(f()<=0)return e==null||e.endActivity(`${o()}_wait`),u();c(f()-1)};return Ge(()=>{e==null||e.endActivity(`${o()}_wait`),e==null||e.endActivity(`${o()}_catchup`)}),_(H,{get when(){return!(e!=null&&e.pause())},get children(){var h=ro(),p=h.firstChild;return y(p,()=>{var A;return(A=r==null?void 0:r.story())==null?void 0:A.label}),y(h,_(H,{get when(){return l()},fallback:"Waiting.. Searching.. Wondering..",get children(){return[(()=>{var A=to();return y(A,()=>{var M;return(M=r==null?void 0:r.story())==null?void 0:M.description}),A})(),(()=>{var A=no();return y(A,_(gt,{get name(){return`${o()}_task`},get ticks(){return m()},onFinish:u,label:"Task",showPc:!0})),A})()]}}),null),h}})};var so=x('<div class="text-lg font-bold mt-5">Weapon'),lo=x('<div class="text-lg font-bold mt-5">Armour'),io=x('<div class="flex flex-col h-full"><div class="h-7/8 p-2"></div><div class="h-1/8 flex flex-row justify-between gap-2 p-2"><button>Equip</button><button>Stats'),ao=x('<div class="flex flex-row justify-between border-gray-700"><div></div><div>'),co=x('<div class="flex flex-row justify-between items-center border-gray-700"><div></div><div class="text-xs text-gray-500">');const uo=()=>{const[e,t]=q("stats"),n=N(ue),r=N(de),o=B(()=>{const i=n==null?void 0:n.attackDamage(),f=1e3/Be,c=1/(((n==null?void 0:n.attackRate())??ve)/f);return[{label:"Health",value:(n==null?void 0:n.player.stats.health)??0},{label:"Max health",value:(n==null?void 0:n.player.stats.maxHealth)??0},{label:"",value:""},{label:"Att. min",value:(i==null?void 0:i.at(0))??0},{label:"Att. max",value:(i==null?void 0:i.at(1))??0},{label:"Att. rate",value:`${(c==null?void 0:c.toFixed(2))??0} p/s`},{label:"",value:""},{label:"Phys. res",value:(n==null?void 0:n.player.stats.physRes)??0},{label:"Mag. res",value:(n==null?void 0:n.player.stats.magRes)??0}]}),s=i=>{r!=null&&r.addInventory(i.name,1)&&(n==null||n.onUnequip(i))},l=B(()=>{const i=["weapon","offhand"],f=["head","shoulder","chest","hand","leg","foot"];return[{label:so(),isDisabled:!1,isEmpty:!0},...i.map(c=>{const d=c&&(n==null?void 0:n.equipment().find(a=>a.equipSlot===c));return{label:(d==null?void 0:d.label)??c,isDisabled:!d,subtext:Object.entries((d==null?void 0:d.stats)??{}).map(([a,m])=>`[${a}: ${m}]`).join(""),onClick:d?()=>s(d):void 0}}),{label:lo(),isDisabled:!1,isEmpty:!0},...f.map(c=>{const d=c&&(n==null?void 0:n.equipment().find(a=>a.equipSlot===c));return{label:(d==null?void 0:d.label)??c,isDisabled:!d,subtext:Object.entries((d==null?void 0:d.stats)??{}).map(([a,m])=>`[${a}: ${m}]`).join(""),onClick:d?()=>s(d):void 0}})]});return(()=>{var i=io(),f=i.firstChild,c=f.nextSibling,d=c.firstChild,a=d.nextSibling;return y(f,_(Me,{get children(){return[_(Z,{get when(){return e()==="stats"},get children(){return _(ne,{get each(){return o()},children:m=>(()=>{var b=ao(),u=b.firstChild,g=u.nextSibling;return y(u,()=>m.label),y(g,()=>m.value),Y(()=>b.classList.toggle("border-b",!!m.label)),b})()})}}),_(Z,{get when(){return e()==="equip"},get children(){return _(ne,{get each(){return l()},children:m=>(()=>{var b=co(),u=b.firstChild,g=u.nextSibling;return Je(b,"click",m.onClick),y(u,()=>m.label),y(g,()=>m.subtext),Y(h=>{var p=!m.isEmpty,A=!!m.isDisabled;return p!==h.e&&b.classList.toggle("border-b",h.e=p),A!==h.t&&u.classList.toggle("text-gray-700",h.t=A),h},{e:void 0,t:void 0}),b})()})}})]}})),d.$$click=()=>t("equip"),a.$$click=()=>t("stats"),Y(m=>{var b=e()==="equip",u=e()==="stats";return b!==m.e&&d.classList.toggle("selected",m.e=b),u!==m.t&&a.classList.toggle("selected",m.t=u),m},{e:void 0,t:void 0}),i})()};ce(["click"]);var fo=x('<div class="px-2 py-1 bg-red-900 border border-red-500 rounded w-full flex flex-row justify-between items-center mb-2"><span class="font-bold text-xl text-black">Drop</span><div class="flex flex-row gap-4">'),ho=x('<div class="absolute bottom-0 left-0 w-full border-t content-center p-2 bg-slate-500"><div class="flex flex-col gap-2"><div class="flex flex-row justify-center relative mb-3"><span class="absolute left-0 top-0 font-bold cursor-pointer border-2 rounded-xl px-2 hover:bg-white hover:text-black">X</span><div class=font-bold> (<!>)</div></div><div class="flex flex-col gap-1 justify-between"><div class="px-2 py-1 bg-blue-900 border border-blue-500 rounded w-full flex flex-row justify-between items-center mb-2"><span class="font-bold text-xl text-black">Transfer</span><div class="flex flex-row gap-4">'),bo=x('<div class="h-full relative pb-2"><div class="flex flex-col gap-2 h-7/8 overflow-auto p-2"></div><div class="w-full border content-center cursor-pointer h-12 text-lg font-bold mt-auto">Leave stash');const go=()=>{const e=N(de),t=N(ee),[n,r]=q(),o=c=>{c<0||!(e!=null&&e.stash()[c])||r(c)},s=B(()=>{const c=n()??-1;if(c<0)return;const d=e==null?void 0:e.stash().at(c);return d?{item:W[d.name],count:d.count}:null}),l=c=>{const d=s();d&&(e==null||e.removeInventory(d.item.name,c),c>=(d.count??1)&&r(void 0))},i=c=>{const d=s();d&&(c=c===1/0?(e==null?void 0:e.stash().reduce((a,m)=>(m==null?void 0:m.name)===d.item.name?a+m.count:a,0))??0:c,e==null||e.removeStash(d.item.name,c))},f=B(()=>{var c;return!(!s()||((c=s())==null?void 0:c.item.category)==="unique")});return(()=>{var c=bo(),d=c.firstChild,a=d.nextSibling;return d.$$click=()=>r(void 0),y(d,_(ne,{get each(){return e==null?void 0:e.stash()},children:(m,b)=>_(dn,{item:m,onSelect:()=>o(b())})})),y(c,_(H,{get when(){return s()},get children(){var m=ho(),b=m.firstChild,u=b.firstChild,g=u.firstChild,h=g.nextSibling,p=h.firstChild,A=p.nextSibling;A.nextSibling;var M=u.nextSibling,S=M.firstChild,E=S.firstChild,O=E.nextSibling;return g.$$click=()=>r(void 0),y(h,()=>{var P;return(P=s())==null?void 0:P.item.label},p),y(h,()=>{var P;return(P=s())==null?void 0:P.count},A),y(O,_(C,{onClick:()=>i(1),children:"One"}),null),y(O,_(C,{onClick:()=>{var P;return i(((P=s())==null?void 0:P.count)??1)},children:"Stack"}),null),y(O,_(C,{onClick:()=>i(1/0),children:"All"}),null),y(M,_(H,{get when(){return f()},get children(){var P=fo(),v=P.firstChild,k=v.nextSibling;return y(k,_(C,{onClick:()=>l(1),children:"One"}),null),y(k,_(C,{onClick:()=>{var $;return l((($=s())==null?void 0:$.count)??1)},children:"Stack"}),null),y(k,_(C,{onClick:()=>l(1/0),children:"All"}),null),P}}),null),m}}),a),a.$$click=()=>t==null?void 0:t.onNavigate("_back"),c})()};ce(["click"]);var mo=x('<div class="flex flex-col p-2 gap-2 w-full"><div class="border p-2 font-bold cursor-pointer">RESET');const vo=()=>{const e=N(ee);return(()=>{var t=mo(),n=t.firstChild;return Je(n,"click",e==null?void 0:e.onClearState),t})()};ce(["click"]);var Dt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function po(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var nt,Bt;function _o(){return Bt||(Bt=1,nt={Other:0,CR:1,LF:2,Control:4,Extend:8,ZWJ:16,Regional_Indicator:32,Prepend:64,SpacingMark:128,L:256,V:512,T:1024,LV:2048,LVT:4096,Extended_Pictographic:8192,InCB_Linker:16384,InCB_Consonant:32768,InCB_Extend:65536}),nt}const yo="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",wo={data:yo},$o="AAACAAAAAACAOAAAAbYBSf7t2S1IBEEYBuDVDZ7FYrQMNsFiu3hgEYOI0SCXRIUrB8JhEZtgs5gEg1GMFk02m82oGI02m+9xezCOczv/uwv3fvAwc/PzfXOzcdqzWdaBDdiGPdiHdjE+DS3RNDuCfsn8idQ/g3OH3BdwKf0e96/gumTfYcncLdzBPTzAo+RZ+f0Cr/AG7/AJX4738x1wtz9FO5PX/50n6UXMNdfg/0lERERERERERERERETpdedHBvDRql4nq0cXtW9af98qdRby0Vvp8K4W0V+C5Xw0t4J2bfjeBp3cnEu1brnnCTYNa7eKdz91XP7WO9Lb4GqRb7cY6xbtAdqeVOsY/QGcevw/tb6OT85YhvfKYEx9CMuxKsKnrs+eJtVInVvHJ0eVYVvTZk2siFVLOCjb61PTZX3MdVWEyP7fjzpmMxdzTyq2Ebue6x61nXRGnzndWpf1an7dXmGYE4Y1ptqqKsK1nu26Ju0ty+maV2Rpvk+qnDZjKUIobUiesdAQE/jmCTmHmsskpFZsVYbtmXRcaoSGUPomunW2derQhDPFjtT1Q/eb8vnm990fq35oHVt11bU9m89c7DNI8Qs=",So={data:$o},ko="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",Ao={data:ko};var rt,Ut;function xo(){if(Ut)return rt;Ut=1;var e=0,t=-3;function n(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}function r(v,k){this.source=v,this.sourceIndex=0,this.tag=0,this.bitcount=0,this.dest=k,this.destLen=0,this.ltree=new n,this.dtree=new n}var o=new n,s=new n,l=new Uint8Array(30),i=new Uint16Array(30),f=new Uint8Array(30),c=new Uint16Array(30),d=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),a=new n,m=new Uint8Array(320);function b(v,k,$,T){var I,U;for(I=0;I<$;++I)v[I]=0;for(I=0;I<30-$;++I)v[I+$]=I/$|0;for(U=T,I=0;I<30;++I)k[I]=U,U+=1<<v[I]}function u(v,k){var $;for($=0;$<7;++$)v.table[$]=0;for(v.table[7]=24,v.table[8]=152,v.table[9]=112,$=0;$<24;++$)v.trans[$]=256+$;for($=0;$<144;++$)v.trans[24+$]=$;for($=0;$<8;++$)v.trans[168+$]=280+$;for($=0;$<112;++$)v.trans[176+$]=144+$;for($=0;$<5;++$)k.table[$]=0;for(k.table[5]=32,$=0;$<32;++$)k.trans[$]=$}var g=new Uint16Array(16);function h(v,k,$,T){var I,U;for(I=0;I<16;++I)v.table[I]=0;for(I=0;I<T;++I)v.table[k[$+I]]++;for(v.table[0]=0,U=0,I=0;I<16;++I)g[I]=U,U+=v.table[I];for(I=0;I<T;++I)k[$+I]&&(v.trans[g[k[$+I]]++]=I)}function p(v){v.bitcount--||(v.tag=v.source[v.sourceIndex++],v.bitcount=7);var k=v.tag&1;return v.tag>>>=1,k}function A(v,k,$){if(!k)return $;for(;v.bitcount<24;)v.tag|=v.source[v.sourceIndex++]<<v.bitcount,v.bitcount+=8;var T=v.tag&65535>>>16-k;return v.tag>>>=k,v.bitcount-=k,T+$}function M(v,k){for(;v.bitcount<24;)v.tag|=v.source[v.sourceIndex++]<<v.bitcount,v.bitcount+=8;var $=0,T=0,I=0,U=v.tag;do T=2*T+(U&1),U>>>=1,++I,$+=k.table[I],T-=k.table[I];while(T>=0);return v.tag=U,v.bitcount-=I,k.trans[$+T]}function S(v,k,$){var T,I,U,z,L,D;for(T=A(v,5,257),I=A(v,5,1),U=A(v,4,4),z=0;z<19;++z)m[z]=0;for(z=0;z<U;++z){var F=A(v,3,0);m[d[z]]=F}for(h(a,m,0,19),L=0;L<T+I;){var X=M(v,a);switch(X){case 16:var J=m[L-1];for(D=A(v,2,3);D;--D)m[L++]=J;break;case 17:for(D=A(v,3,3);D;--D)m[L++]=0;break;case 18:for(D=A(v,7,11);D;--D)m[L++]=0;break;default:m[L++]=X;break}}h(k,m,0,T),h($,m,T,I)}function E(v,k,$){for(;;){var T=M(v,k);if(T===256)return e;if(T<256)v.dest[v.destLen++]=T;else{var I,U,z,L;for(T-=257,I=A(v,l[T],i[T]),U=M(v,$),z=v.destLen-A(v,f[U],c[U]),L=z;L<z+I;++L)v.dest[v.destLen++]=v.dest[L]}}}function O(v){for(var k,$,T;v.bitcount>8;)v.sourceIndex--,v.bitcount-=8;if(k=v.source[v.sourceIndex+1],k=256*k+v.source[v.sourceIndex],$=v.source[v.sourceIndex+3],$=256*$+v.source[v.sourceIndex+2],k!==(~$&65535))return t;for(v.sourceIndex+=4,T=k;T;--T)v.dest[v.destLen++]=v.source[v.sourceIndex++];return v.bitcount=0,e}function P(v,k){var $=new r(v,k),T,I,U;do{switch(T=p($),I=A($,2,0),I){case 0:U=O($);break;case 1:U=E($,o,s);break;case 2:S($,$.ltree,$.dtree),U=E($,$.ltree,$.dtree);break;default:U=t}if(U!==e)throw new Error("Data error")}while(!T);return $.destLen<$.dest.length?typeof $.dest.slice=="function"?$.dest.slice(0,$.destLen):$.dest.subarray(0,$.destLen):$.dest}return u(o,s),b(l,i,4,3),b(f,c,2,1),l[28]=0,i[28]=258,rt=P,rt}var ot,Nt;function Eo(){if(Nt)return ot;Nt=1;const e=new Uint8Array(new Uint32Array([305419896]).buffer)[0]===18,t=(o,s,l)=>{let i=o[s];o[s]=o[l],o[l]=i},n=o=>{const s=o.length;for(let l=0;l<s;l+=4)t(o,l,l+3),t(o,l+1,l+2)};return ot={swap32LE:o=>{e&&n(o)}},ot}var st,qt;function Io(){if(qt)return st;qt=1;const e=xo(),{swap32LE:t}=Eo(),n=11,r=5,o=n-r,s=65536>>n,i=(1<<o)-1,f=2,d=(1<<r)-1,a=65536>>r,m=1024>>r,h=a+m+32,p=1<<f;class A{constructor(S){const E=typeof S.readUInt32BE=="function"&&typeof S.slice=="function";if(E||S instanceof Uint8Array){let O;if(E)this.highStart=S.readUInt32LE(0),this.errorValue=S.readUInt32LE(4),O=S.readUInt32LE(8),S=S.slice(12);else{const P=new DataView(S.buffer);this.highStart=P.getUint32(0,!0),this.errorValue=P.getUint32(4,!0),O=P.getUint32(8,!0),S=S.subarray(12)}S=e(S,new Uint8Array(O)),S=e(S,new Uint8Array(O)),t(S),this.data=new Uint32Array(S.buffer)}else({data:this.data,highStart:this.highStart,errorValue:this.errorValue}=S)}get(S){let E;return S<0||S>1114111?this.errorValue:S<55296||S>56319&&S<=65535?(E=(this.data[S>>r]<<f)+(S&d),this.data[E]):S<=65535?(E=(this.data[a+(S-55296>>r)]<<f)+(S&d),this.data[E]):S<this.highStart?(E=this.data[h-s+(S>>n)],E=this.data[E+(S>>r&i)],E=(E<<f)+(S&d),this.data[E]):this.data[this.data.length-p]}}return st=A,st}var Ue={exports:{}},To=Ue.exports,Ft;function Lo(){return Ft||(Ft=1,(function(e,t){(function(n,r){e.exports=r()})(typeof self<"u"?self:typeof window<"u"?window:typeof Dt<"u"?Dt:To,function(){var n="3.7.8",r=n,o=typeof Buffer=="function",s=typeof TextDecoder=="function"?new TextDecoder:void 0,l=typeof TextEncoder=="function"?new TextEncoder:void 0,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",f=Array.prototype.slice.call(i),c=(function(w){var R={};return w.forEach(function(K,Q){return R[K]=Q}),R})(f),d=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,a=String.fromCharCode.bind(String),m=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):function(w){return new Uint8Array(Array.prototype.slice.call(w,0))},b=function(w){return w.replace(/=/g,"").replace(/[+\/]/g,function(R){return R=="+"?"-":"_"})},u=function(w){return w.replace(/[^A-Za-z0-9\+\/]/g,"")},g=function(w){for(var R,K,Q,oe,se="",Qe=w.length%3,Pe=0;Pe<w.length;){if((K=w.charCodeAt(Pe++))>255||(Q=w.charCodeAt(Pe++))>255||(oe=w.charCodeAt(Pe++))>255)throw new TypeError("invalid character found");R=K<<16|Q<<8|oe,se+=f[R>>18&63]+f[R>>12&63]+f[R>>6&63]+f[R&63]}return Qe?se.slice(0,Qe-3)+"===".substring(Qe):se},h=typeof btoa=="function"?function(w){return btoa(w)}:o?function(w){return Buffer.from(w,"binary").toString("base64")}:g,p=o?function(w){return Buffer.from(w).toString("base64")}:function(w){for(var R=4096,K=[],Q=0,oe=w.length;Q<oe;Q+=R)K.push(a.apply(null,w.subarray(Q,Q+R)));return h(K.join(""))},A=function(w,R){return R===void 0&&(R=!1),R?b(p(w)):p(w)},M=function(w){if(w.length<2){var R=w.charCodeAt(0);return R<128?w:R<2048?a(192|R>>>6)+a(128|R&63):a(224|R>>>12&15)+a(128|R>>>6&63)+a(128|R&63)}else{var R=65536+(w.charCodeAt(0)-55296)*1024+(w.charCodeAt(1)-56320);return a(240|R>>>18&7)+a(128|R>>>12&63)+a(128|R>>>6&63)+a(128|R&63)}},S=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,E=function(w){return w.replace(S,M)},O=o?function(w){return Buffer.from(w,"utf8").toString("base64")}:l?function(w){return p(l.encode(w))}:function(w){return h(E(w))},P=function(w,R){return R===void 0&&(R=!1),R?b(O(w)):O(w)},v=function(w){return P(w,!0)},k=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,$=function(w){switch(w.length){case 4:var R=(7&w.charCodeAt(0))<<18|(63&w.charCodeAt(1))<<12|(63&w.charCodeAt(2))<<6|63&w.charCodeAt(3),K=R-65536;return a((K>>>10)+55296)+a((K&1023)+56320);case 3:return a((15&w.charCodeAt(0))<<12|(63&w.charCodeAt(1))<<6|63&w.charCodeAt(2));default:return a((31&w.charCodeAt(0))<<6|63&w.charCodeAt(1))}},T=function(w){return w.replace(k,$)},I=function(w){if(w=w.replace(/\s+/g,""),!d.test(w))throw new TypeError("malformed base64.");w+="==".slice(2-(w.length&3));for(var R,K,Q,oe=[],se=0;se<w.length;)R=c[w.charAt(se++)]<<18|c[w.charAt(se++)]<<12|(K=c[w.charAt(se++)])<<6|(Q=c[w.charAt(se++)]),K===64?oe.push(a(R>>16&255)):Q===64?oe.push(a(R>>16&255,R>>8&255)):oe.push(a(R>>16&255,R>>8&255,R&255));return oe.join("")},U=typeof atob=="function"?function(w){return atob(u(w))}:o?function(w){return Buffer.from(w,"base64").toString("binary")}:I,z=o?function(w){return m(Buffer.from(w,"base64"))}:function(w){return m(U(w).split("").map(function(R){return R.charCodeAt(0)}))},L=function(w){return z(F(w))},D=o?function(w){return Buffer.from(w,"base64").toString("utf8")}:s?function(w){return s.decode(z(w))}:function(w){return T(U(w))},F=function(w){return u(w.replace(/[-_]/g,function(R){return R=="-"?"+":"/"}))},X=function(w){return D(F(w))},J=function(w){if(typeof w!="string")return!1;var R=w.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(R)||!/[^\s0-9a-zA-Z\-_]/.test(R)},pt=function(w){return{value:w,enumerable:!1,writable:!0,configurable:!0}},_t=function(){var w=function(R,K){return Object.defineProperty(String.prototype,R,pt(K))};w("fromBase64",function(){return X(this)}),w("toBase64",function(R){return P(this,R)}),w("toBase64URI",function(){return P(this,!0)}),w("toBase64URL",function(){return P(this,!0)}),w("toUint8Array",function(){return L(this)})},yt=function(){var w=function(R,K){return Object.defineProperty(Uint8Array.prototype,R,pt(K))};w("toBase64",function(R){return A(this,R)}),w("toBase64URI",function(){return A(this,!0)}),w("toBase64URL",function(){return A(this,!0)})},_n=function(){_t(),yt()},we={version:n,VERSION:r,atob:U,atobPolyfill:I,btoa:h,btoaPolyfill:g,fromBase64:X,toBase64:P,encode:P,encodeURI:v,encodeURL:v,utob:E,btou:T,decode:X,isValid:J,fromUint8Array:A,toUint8Array:L,extendString:_t,extendUint8Array:yt,extendBuiltins:_n};return we.Base64={},Object.keys(we).forEach(function(w){return we.Base64[w]=we[w]}),we})})(Ue)),Ue.exports}var lt,Ht;function Ro(){if(Ht)return lt;Ht=1;const e=_o(),t=wo.data,n=So.data,r=Ao.data,o=Io(),s=Lo().Base64,l=new o(s.toUint8Array(t)),i=new o(s.toUint8Array(n)),f=new o(s.toUint8Array(r));function c(a,m){return(a&m)!==0}function d(a,m,b){const u=m.length;for(let g=b;g+1<u;g++){const h=m[g+0],p=m[g+1];switch(a.gb9c){case 0:c(h,e.InCB_Consonant)&&(a.gb9c=1);break;case 1:c(h,e.InCB_Extend)?a.gb9c=1:c(h,e.InCB_Linker)?a.gb9c=2:a.gb9c=c(h,e.InCB_Consonant)?1:0;break;case 2:c(h,e.InCB_Extend|e.InCB_Linker)?a.gb9c=2:a.gb9c=c(h,e.InCB_Consonant)?1:0;break}switch(a.gb11){case 0:c(h,e.Extended_Pictographic)&&(a.gb11=1);break;case 1:c(h,e.Extend)?a.gb11=1:c(h,e.ZWJ)?a.gb11=2:a.gb11=c(h,e.Extended_Pictographic)?1:0;break;case 2:a.gb11=c(h,e.Extended_Pictographic)?1:0;break}switch(a.gb12){case 0:c(h,e.Regional_Indicator)?a.gb12=1:a.gb12=-1;break;case 1:c(h,e.Regional_Indicator)?a.gb12=0:a.gb12=-1;break}switch(a.gb13){case 0:c(h,e.Regional_Indicator)||(a.gb13=1);break;case 1:c(h,e.Regional_Indicator)?a.gb13=2:a.gb13=1;break;case 2:a.gb13=1;break}if(!(c(h,e.CR)&&c(p,e.LF))){if(c(h,e.Control|e.CR|e.LF)||c(p,e.Control|e.CR|e.LF))return g+1-b;if(!(c(h,e.L)&&c(p,e.L|e.V|e.LV|e.LVT))&&!(c(h,e.LV|e.V)&&c(p,e.V|e.T))&&!(c(h,e.LVT|e.T)&&c(p,e.T))&&!c(p,e.Extend|e.ZWJ)&&!c(p,e.SpacingMark)&&!c(h,e.Prepend)&&!(c(p,e.InCB_Consonant)&&a.gb9c===2)&&!(c(p,e.Extended_Pictographic)&&a.gb11===2)&&!(c(p,e.Regional_Indicator)&&a.gb12===1)&&!(c(p,e.Regional_Indicator)&&a.gb13===2))return g+1-b}}return u-b}return lt=function(m){const b=[],u=[0],g=[];for(let p=0;p<m.length;){const A=m.codePointAt(p);g.push(l.get(A)|i.get(A)|f.get(A)),p+=A>65535?2:1,u.push(p)}const h={gb9c:0,gb11:0,gb12:0,gb13:0};for(let p=0;p<g.length;){const A=d(h,g,p),M=u[p],S=u[p+A];b.push(m.slice(M,S)),p+=A}return b},lt}var Mo=Ro();const Po=po(Mo),Oo=e=>e.normalize("NFKD").split(""),jt=/^\s+$/,zt=/^[`~!@#$%^&*()\-=_+{}[\]\|\\;':",./<>?]+$/,mt={insertOrder:"insertOrder",bestMatch:"bestMatch"},Do={keySelector:e=>e,threshold:.6,ignoreCase:!0,ignoreSymbols:!0,normalizeWhitespace:!0,returnMatchData:!1,useDamerau:!0,useSellers:!0,useSeparatedUnicode:!1,sortBy:mt.bestMatch},Bo=()=>{},Uo=e=>e instanceof Array?e:[e];function hn(e,t){const n=t.ignoreCase?e.toLocaleLowerCase():e,r=[],o=[];let s=!0,l=0;const i=t.useSeparatedUnicode?Oo(n):Po(n);for(const f of i)jt.lastIndex=0,zt.lastIndex=0,t.normalizeWhitespace&&jt.test(f)?s||(r.push(" "),o.push(l),s=!0):t.ignoreSymbols&&zt.test(f)||(t.useSeparatedUnicode?r.push(f):r.push(f.normalize()),o.push(l),s=!1),l+=f.length;for(o.push(e.length);r[r.length-1]===" ";)r.pop(),o.pop();return{original:e,normal:r,map:o}}function No(e,t){return{index:t[e.start],length:t[e.end+1]-t[e.start]}}function bn(e,t){if(t===0)return{index:0,length:0};let n=t;for(let r=e.length-2;r>0&&n>1;r--){const o=e[r];n=o[n]<o[n-1]?n:n-1}return{start:n-1,end:t-1}}function qo(){return{start:0,end:0}}const Fo=()=>!0,Ho=(e,t)=>e<t;function jo(e,t){const n=new Array(e);for(let r=0;r<e;r++)n[r]=new Array(t),n[r][0]=r;for(let r=0;r<t;r++)n[0][r]=r;return n}function zo(e,t){const n=new Array(e);n[0]=new Array(t).fill(0);for(let r=1;r<e;r++)n[r]=new Array(t),n[r][0]=r;return n}function gn(e,t,n,r,o){const s=n[r],l=n[r+1],i=e[r]===t[o]?0:1;let f,c=l[o]+1;(f=s[o+1]+1)<c&&(c=f),(f=s[o]+i)<c&&(c=f),l[o+1]=c}function mn(e,t,n,r){for(let o=0;o<e.length;o++)gn(e,t,n,o,r)}function Vo(e,t,n,r){if(r===0){mn(e,t,n,r);return}e.length>0&&gn(e,t,n,0,r);for(let o=1;o<e.length;o++){const s=n[o-1],l=n[o],i=n[o+1],f=e[o]===t[r]?0:1;let c,d=i[r]+1;(c=l[r+1]+1)<d&&(d=c),(c=l[r]+f)<d&&(d=c),e[o]===t[r-1]&&e[o-1]===t[r]&&(c=s[r-1]+f)<d&&(d=c),i[r+1]=d}}function Wo(e,t,n){let r=e;for(let o=0;o<t.length;o++){const s=t[o];r.children[s]==null&&(r.children[s]={children:{},candidates:[],depth:0}),r.depth=Math.max(r.depth,t.length-o),r=r.children[s]}r.candidates.push(n)}function Vt(e,t,n,r){for(const o of n){const s=Uo(r.keySelector(o)).map((l,i)=>({index:t,keyIndex:i,item:o,normalized:hn(l,r)}));t++;for(const l of s)Wo(e,l.normalized.normal,l)}}function Xo(e,t){const n=t.score-e.score;if(n!==0)return n;const r=e.match.start-t.match.start;if(r!==0)return r;const o=e.keyIndex-t.keyIndex;if(o!==0)return o;const s=e.lengthDiff-t.lengthDiff;return s!==0?s:vn(e,t)}function vn(e,t){return e.index-t.index}function Ko(e){switch(e){case mt.bestMatch:return Xo;case mt.insertOrder:return vn;default:throw new Error(`unknown sortBy method ${e}`)}}function pn(e,t,n,r,o,s,l){const i={item:n.item,normalized:n.normalized,score:r,match:o,index:n.index,keyIndex:n.keyIndex,lengthDiff:s};t[n.index]==null?(t[n.index]=e.length,e.push(i)):l(i,e[t[n.index]])<0&&(e[t[n.index]]=i)}const Zo=Math.max,Go=e=>e;function Yo(e,t,n,r,o){const s=t+o,l=Math.min(n.length,t+e.depth+1),i=Math.ceil((s+l)/2);return 1-(i-l)/i>=r}function Jo(e,t,n,r,o,s){return 1-Math.min(o,s-(e.depth+1))/n.length>=r}function Qo(e,t,n,r,o,s,l){const i=[];for(const c in e.children){const d=e.children[c];i.push([d,1,c,0,t.length])}const f=new Array(e.depth);for(;i.length!==0;){const[c,d,a,m,b]=i.pop();f[d-1]=a,n.score(t,f,r,d-1);const u=d,g=r[r.length-1][u];let h=m,p=b;if(n.shouldUpdateScore(g,b)&&(h=u,p=g),c.candidates.length>0){const A=n.getLength(t.length,d),M=1-p/A;if(M>=l.threshold){const S=bn(r,h),E=Math.abs(d-t.length);for(const O of c.candidates)pn(o,s,O,M,S,E,n.compareItems)}}for(const A in c.children){const M=c.children[A];n.shouldContinue(M,d,t,l.threshold,p,g)&&i.push([M,d+1,A,h,p])}}}function Co(e,t,n){const r=n.useSellers?zo:jo,o={score:n.useDamerau?Vo:mn,getLength:n.useSellers?Go:Zo,shouldUpdateScore:n.useSellers?Ho:Fo,shouldContinue:n.useSellers?Jo:Yo,walkBack:n.useSellers?bn:qo,compareItems:Ko(n.sortBy)},s={},l=[],i=r(e.length+1,t.depth+1);if(n.threshold<=0||e.length===0)for(const c of t.candidates)pn(l,s,c,0,{index:0,length:0},e.length,o.compareItems);Qo(t,e,o,i,l,s,n);const f=l.sort(o.compareItems);if(n.returnMatchData){const c=n.useSellers?No:Bo;return f.map(d=>({item:d.item,original:d.normalized.original,key:d.normalized.normal.join(""),score:d.score,match:c(d.match,d.normalized.map)}))}return f.map(c=>c.item)}class es{constructor(t,n){this.options=Object.assign({},Do,n),this.trie={children:{},candidates:[],depth:0},Vt(this.trie,0,t,this.options),this.count=t.length}add(...t){Vt(this.trie,this.count,t,this.options),this.count+=t.length}search(t,n){return n=Object.assign({},this.options,n),Co(hn(t,this.options).normal,this.trie,n)}}var ts=x('<div class="flex flex-col gap-2 p-2"><div class="flex flex-row gap-2"><div class="border rounded cursor-pointer px-2">CLEAR INV</div><div class="border rounded cursor-pointer px-2">CLEAR MARKERS</div></div><input type=text placeholder="item search"class="border border-black">'),ns=x("<div class=cursor-pointer>BACK"),rs=x('<div class="flex flex-row gap-2 mt-5"><div class=font-bold></div> - <div class="border rounded cursor-pointer px-2">1</div><div class="border rounded cursor-pointer px-2">10</div><div class="border rounded cursor-pointer px-2">100'),os=x('<div class="w-128 h-128 absolute bg-white top-0 left-0 p-2 text-black">'),ss=x('<div class="hover:bg-blue-200 cursor-pointer">');const ls=new es(Object.keys(W)),is=()=>{const e=N(de),t=N(ee),[n,r]=q(),[o,s]=q(),l=(d=1)=>{const a=o();a&&(e==null||e.addInventory(a,d))},i=d=>{const a=ls.search(d);r(a)},f=()=>{e==null||e.inventory().filter(Boolean).forEach(d=>e.removeInventory(d.name,d.count))},c=()=>{t==null||t.setState("markers",[])};return(()=>{var d=os();return y(d,_(H,{get when(){return!o()},get children(){var a=ts(),m=a.firstChild,b=m.firstChild,u=b.nextSibling,g=m.nextSibling;return b.$$click=()=>f(),u.$$click=()=>c(),g.addEventListener("keypress",h=>i(h.target.value)),y(a,_(ne,{get each(){return n()??[]},children:h=>(()=>{var p=ss();return p.$$click=()=>s(h),y(p,h),p})()}),null),a}}),null),y(d,_(H,{get when(){return o()},get children(){return[(()=>{var a=ns();return a.$$click=()=>s(void 0),a})(),(()=>{var a=rs(),m=a.firstChild,b=m.nextSibling,u=b.nextSibling,g=u.nextSibling,h=g.nextSibling;return y(m,o),u.$$click=()=>l(1),g.$$click=()=>l(10),h.$$click=()=>l(100),a})()]}}),null),d})()};ce(["click"]);var as=x('<div class="w-dvw h-dvh lg:w-[360px] lg:h-[800px] flex flex-col justify-between relative"><div class="h-3/10 bg-gray-400"><div class=h-1/10></div><div class=h-9/10></div></div><div></div><div class=bg-gray-800>'),cs=x("<div>Unknown view"),us=x('<div class="h-1/10 w-full flex flex-row justify-between font-bold">'),fs=x('<div class="flex flex-col gap-2 p-1 h-full"><div class="bg-black text-left pl-1"></div><div class="text-black whitespace-pre-wrap text-left overflow-y-auto text-sm">'),ds=x('<div class="h-full bg-white flex flex-row"><div class="text-black bottom-0 left-0 border border-gray-100 p-1 flex flex-col gap-1 bg-white"><div class="rounded h-4 w-4 cursor-pointer"title="Show/hide bad"></div><div class="rounded h-4 w-4 cursor-pointer"title="Show/hide good"></div><div class="rounded h-4 w-4 cursor-pointer"title="Show/hide meta"></div><div class="rounded h-4 w-4 cursor-pointer"title="Show/hide drop"></div><div class="rounded h-4 w-4 cursor-pointer"title="Show/hide basic"></div></div><div class="text-black h-full overflow-y-auto flex flex-col w-full">'),hs=x('<div class="flex flex-row items-center px-1 transition-colors duration-500 border-t border-gray-200"><div class="text-xs text-blue-400 mr-1">[<!>]</div><div class="text-wrap text-xs text-left">'),bs=x('<div class="flex flex-row bg-black px-1 justify-between"><div class=text-red-500>HP <!>/</div><div class=text-yellow-500>Gold </div><div class=text-white>Age </div><div class=text-green-500>Lvl <!> (<!>%)'),gs=x('<div class="content-center w-1/4 border border-l-0 cursor-pointer last:border-r-0">');const ms=()=>_(mr,{get children(){return[_(vs,{}),_(H,{when:Ln,get children(){return _(is,{})}})]}}),vs=()=>{const[e,t]=q("story"),n=N(ge),r=B(()=>{var s;return e()==="story"&&((s=n==null?void 0:n.story())==null?void 0:s.name)==="story_stash_1"?"stash":e()}),o=B(()=>{var s;return r()==="story"&&((s=n==null?void 0:n.story())==null?void 0:s.type)==="encounter"});return(()=>{var s=as(),l=s.firstChild,i=l.firstChild,f=i.nextSibling,c=l.nextSibling,d=c.nextSibling;return y(i,_(ws,{})),y(f,_(_s,{})),y(c,_(ys,{})),y(d,_(Me,{get fallback(){return cs()},get children(){return[_(Z,{get when(){return r()==="story"},get children(){return _(Sr,{})}}),_(Z,{get when(){return r()==="stash"},get children(){return _(go,{})}}),_(Z,{get when(){return r()==="invent"},get children(){return _(Or,{})}}),_(Z,{get when(){return r()==="skills"},get children(){return _(jr,{})}}),_(Z,{get when(){return r()==="stats"},get children(){return _(uo,{})}}),_(Z,{get when(){return r()==="menu"},get children(){return _(vo,{})}})]}})),y(s,_(ps,{onChange:t,get view(){return e()}}),null),Y(a=>{var m=!o(),b=!!o(),u=!!o(),g=!o();return m!==a.e&&c.classList.toggle("h-1/10",a.e=m),b!==a.t&&c.classList.toggle("h-4/10",a.t=b),u!==a.a&&d.classList.toggle("h-2/10",a.a=u),g!==a.o&&d.classList.toggle("h-5/10",a.o=g),a},{e:void 0,t:void 0,a:void 0,o:void 0}),s})()},ps=e=>(()=>{var t=us();return y(t,_($e,{label:"Story",onClick:()=>e.onChange("story"),get view(){return e.view},type:"story"}),null),y(t,_($e,{label:"Invent",onClick:()=>e.onChange("invent"),get view(){return e.view},type:"invent"}),null),y(t,_($e,{label:"Skills",onClick:()=>e.onChange("skills"),get view(){return e.view},type:"skills"}),null),y(t,_($e,{label:"Stats",onClick:()=>e.onChange("stats"),get view(){return e.view},type:"stats"}),null),y(t,_($e,{label:"Menu",onClick:()=>e.onChange("menu"),get view(){return e.view},type:"menu"}),null),t})(),_s=()=>{const e=N(ge);return _(Me,{get children(){return[_(Z,{get when(){var t;return((t=e==null?void 0:e.story())==null?void 0:t.type)==="dialogue"},get children(){var t=fs(),n=t.firstChild,r=n.nextSibling;return y(n,()=>{var o;return((o=e==null?void 0:e.story())==null?void 0:o.label)??"Story"}),y(r,()=>{var o;return(o=e==null?void 0:e.story())==null?void 0:o.description}),t}}),_(Z,{get when(){var t;return((t=e==null?void 0:e.story())==null?void 0:t.type)==="encounter"},get children(){return _(Qr,{})}}),_(Z,{get when(){var t;return((t=e==null?void 0:e.story())==null?void 0:t.type)==="task"},get children(){return _(oo,{})}})]}})},ys=()=>{const[e,t]=q(),n=N(ee),[r,o]=dt({good:!0,bad:!0,meta:!0,drop:!0,basic:!0}),s=B(()=>{const l=e();if(!l)return;const i=l.scrollTop+l.clientHeight>l.scrollHeight-10;return setTimeout(()=>i&&l.scrollTo(0,l.scrollHeight??0)),n==null?void 0:n.log().filter(f=>r[f.type])});return(()=>{var l=ds(),i=l.firstChild,f=i.firstChild,c=f.nextSibling,d=c.nextSibling,a=d.nextSibling,m=a.nextSibling,b=i.nextSibling;return f.$$click=()=>o("bad",!r.bad),c.$$click=()=>o("good",!r.good),d.$$click=()=>o("meta",!r.meta),a.$$click=()=>o("drop",!r.drop),m.$$click=()=>o("basic",!r.basic),Dn(t,b),y(b,_(ne,{get each(){return s()},children:u=>(()=>{var g=hs(),h=g.firstChild,p=h.firstChild,A=p.nextSibling;A.nextSibling;var M=h.nextSibling;return y(h,()=>u.time,A),y(M,()=>u.msg),Y(S=>en(g,{"last:bg-red-500 last:text-white bg-red-200":u.type==="bad","last:bg-green-500 last:text-white bg-green-200":u.type==="good","last:bg-yellow-500 bg-yellow-200":u.type==="meta","last:bg-blue-500 last:text-white bg-blue-200":u.type==="drop"},S)),g})()})),Y(u=>{var g=!r.bad,h=!!r.bad,p=!r.good,A=!!r.good,M=!r.meta,S=!!r.meta,E=!r.drop,O=!!r.drop,P=!r.basic,v=!!r.basic;return g!==u.e&&f.classList.toggle("bg-red-100",u.e=g),h!==u.t&&f.classList.toggle("bg-red-500",u.t=h),p!==u.a&&c.classList.toggle("bg-green-100",u.a=p),A!==u.o&&c.classList.toggle("bg-green-500",u.o=A),M!==u.i&&d.classList.toggle("bg-yellow-100",u.i=M),S!==u.n&&d.classList.toggle("bg-yellow-500",u.n=S),E!==u.s&&a.classList.toggle("bg-blue-100",u.s=E),O!==u.h&&a.classList.toggle("bg-blue-500",u.h=O),P!==u.r&&m.classList.toggle("bg-gray-100",u.r=P),v!==u.d&&m.classList.toggle("bg-gray-500",u.d=v),u},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0}),l})()},ws=()=>{const e=N(ue),t=N(ee);return(()=>{var n=bs(),r=n.firstChild,o=r.firstChild,s=o.nextSibling;s.nextSibling;var l=r.nextSibling;l.firstChild;var i=l.nextSibling;i.firstChild;var f=i.nextSibling,c=f.firstChild,d=c.nextSibling,a=d.nextSibling,m=a.nextSibling;return m.nextSibling,y(r,()=>e==null?void 0:e.player.stats.health,s),y(r,()=>e==null?void 0:e.player.stats.maxHealth,null),y(l,()=>e==null?void 0:e.player.stats.gold,null),y(i,()=>t==null?void 0:t.year(),null),y(f,()=>Te((e==null?void 0:e.player.stats.experience)??0),d),y(f,()=>(un((e==null?void 0:e.player.stats.experience)??0)*100).toFixed(0),m),n})()},$e=e=>(()=>{var t=gs();return Je(t,"click",e.onClick),y(t,()=>e.label),Y(n=>en(t,{"border-t-0 bg-gray-800":e.view===e.type},n)),t})();ce(["click"]);const $s=document.getElementById("root");Mn(()=>_(ms,{}),$s);
