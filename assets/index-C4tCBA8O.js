(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))l(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&l(i)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function l(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();const Rt=!1,Dt=(e,t)=>e===t,oe=Symbol("solid-proxy"),We=Symbol("solid-track"),Le={equals:Dt};let ht=yt;const re=1,Ie=2,gt={owned:null,cleanups:null,context:null,owner:null};var D=null;let Ue=null,Nt=null,q=null,V=null,te=null,Be=0;function Me(e,t){const n=q,l=D,r=e.length===0,s=t===void 0?l:t,i=r?gt:{owned:null,cleanups:null,context:s?s.context:null,owner:s},o=r?e:()=>e(()=>G(()=>we(i)));D=i,q=null;try{return ge(o,!0)}finally{q=n,D=l}}function R(e,t){t=t?Object.assign({},Le,t):Le;const n={value:e,observers:null,observerSlots:null,comparator:t.equals||void 0},l=r=>(typeof r=="function"&&(r=r(n.value)),_t(n,r));return[mt.bind(n),l]}function W(e,t,n){const l=et(e,t,!1,re);ke(l)}function he(e,t,n){ht=xt;const l=et(e,t,!1,re);l.user=!0,te?te.push(l):ke(l)}function P(e,t,n){n=n?Object.assign({},Le,n):Le;const l=et(e,t,!0,0);return l.observers=null,l.observerSlots=null,l.comparator=n.equals||void 0,ke(l),mt.bind(l)}function ve(e){return ge(e,!1)}function G(e){if(q===null)return e();const t=q;q=null;try{return e()}finally{q=t}}function xe(e){he(()=>G(e))}function He(e){return D===null||(D.cleanups===null?D.cleanups=[e]:D.cleanups.push(e)),e}function Ke(){return q}function Fe(e,t){const n=Symbol("context");return{id:n,Provider:Ft(n),defaultValue:e}}function j(e){let t;return D&&D.context&&(t=D.context[e.id])!==void 0?t:e.defaultValue}function bt(e){const t=P(e),n=P(()=>Xe(t()));return n.toArray=()=>{const l=n();return Array.isArray(l)?l:l!=null?[l]:[]},n}function mt(){if(this.sources&&this.state)if(this.state===re)ke(this);else{const e=V;V=null,ge(()=>Pe(this),!1),V=e}if(q){const e=this.observers?this.observers.length:0;q.sources?(q.sources.push(this),q.sourceSlots.push(e)):(q.sources=[this],q.sourceSlots=[e]),this.observers?(this.observers.push(q),this.observerSlots.push(q.sources.length-1)):(this.observers=[q],this.observerSlots=[q.sources.length-1])}return this.value}function _t(e,t,n){let l=e.value;return(!e.comparator||!e.comparator(l,t))&&(e.value=t,e.observers&&e.observers.length&&ge(()=>{for(let r=0;r<e.observers.length;r+=1){const s=e.observers[r],i=Ue&&Ue.running;i&&Ue.disposed.has(s),(i?!s.tState:!s.state)&&(s.pure?V.push(s):te.push(s),s.observers&&vt(s)),i||(s.state=re)}if(V.length>1e6)throw V=[],new Error},!1)),t}function ke(e){if(!e.fn)return;we(e);const t=Be;qt(e,e.value,t)}function qt(e,t,n){let l;const r=D,s=q;q=D=e;try{l=e.fn(t)}catch(i){return e.pure&&(e.state=re,e.owned&&e.owned.forEach(we),e.owned=null),e.updatedAt=n+1,wt(i)}finally{q=s,D=r}(!e.updatedAt||e.updatedAt<=n)&&(e.updatedAt!=null&&"observers"in e?_t(e,l):e.value=l,e.updatedAt=n)}function et(e,t,n,l=re,r){const s={fn:e,state:l,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:D,context:D?D.context:null,pure:n};return D===null||D!==gt&&(D.owned?D.owned.push(s):D.owned=[s]),s}function Oe(e){if(e.state===0)return;if(e.state===Ie)return Pe(e);if(e.suspense&&G(e.suspense.inFallback))return e.suspense.effects.push(e);const t=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<Be);)e.state&&t.push(e);for(let n=t.length-1;n>=0;n--)if(e=t[n],e.state===re)ke(e);else if(e.state===Ie){const l=V;V=null,ge(()=>Pe(e,t[0]),!1),V=l}}function ge(e,t){if(V)return e();let n=!1;t||(V=[]),te?n=!0:te=[],Be++;try{const l=e();return Bt(n),l}catch(l){n||(te=null),V=null,wt(l)}}function Bt(e){if(V&&(yt(V),V=null),e)return;const t=te;te=null,t.length&&ge(()=>ht(t),!1)}function yt(e){for(let t=0;t<e.length;t++)Oe(e[t])}function xt(e){let t,n=0;for(t=0;t<e.length;t++){const l=e[t];l.user?e[n++]=l:Oe(l)}for(t=0;t<n;t++)Oe(e[t])}function Pe(e,t){e.state=0;for(let n=0;n<e.sources.length;n+=1){const l=e.sources[n];if(l.sources){const r=l.state;r===re?l!==t&&(!l.updatedAt||l.updatedAt<Be)&&Oe(l):r===Ie&&Pe(l,t)}}}function vt(e){for(let t=0;t<e.observers.length;t+=1){const n=e.observers[t];n.state||(n.state=Ie,n.pure?V.push(n):te.push(n),n.observers&&vt(n))}}function we(e){let t;if(e.sources)for(;e.sources.length;){const n=e.sources.pop(),l=e.sourceSlots.pop(),r=n.observers;if(r&&r.length){const s=r.pop(),i=n.observerSlots.pop();l<r.length&&(s.sourceSlots[i]=l,r[l]=s,n.observerSlots[l]=i)}}if(e.tOwned){for(t=e.tOwned.length-1;t>=0;t--)we(e.tOwned[t]);delete e.tOwned}if(e.owned){for(t=e.owned.length-1;t>=0;t--)we(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}e.state=0}function Ht(e){return e instanceof Error?e:new Error(typeof e=="string"?e:"Unknown error",{cause:e})}function wt(e,t=D){throw Ht(e)}function Xe(e){if(typeof e=="function"&&!e.length)return Xe(e());if(Array.isArray(e)){const t=[];for(let n=0;n<e.length;n++){const l=Xe(e[n]);Array.isArray(l)?t.push.apply(t,l):t.push(l)}return t}return e}function Ft(e,t){return function(l){let r;return W(()=>r=G(()=>(D.context={...D.context,[e]:l.value},bt(()=>l.children))),void 0),r}}const Vt=Symbol("fallback");function tt(e){for(let t=0;t<e.length;t++)e[t]()}function Ut(e,t,n={}){let l=[],r=[],s=[],i=0,o=t.length>1?[]:null;return He(()=>tt(s)),()=>{let a=e()||[],h=a.length,f,u;return a[We],G(()=>{let d,c,b,g,v,w,k,$,T;if(h===0)i!==0&&(tt(s),s=[],l=[],r=[],i=0,o&&(o=[])),n.fallback&&(l=[Vt],r[0]=Me(I=>(s[0]=I,n.fallback())),i=1);else if(i===0){for(r=new Array(h),u=0;u<h;u++)l[u]=a[u],r[u]=Me(y);i=h}else{for(b=new Array(h),g=new Array(h),o&&(v=new Array(h)),w=0,k=Math.min(i,h);w<k&&l[w]===a[w];w++);for(k=i-1,$=h-1;k>=w&&$>=w&&l[k]===a[$];k--,$--)b[$]=r[k],g[$]=s[k],o&&(v[$]=o[k]);for(d=new Map,c=new Array($+1),u=$;u>=w;u--)T=a[u],f=d.get(T),c[u]=f===void 0?-1:f,d.set(T,u);for(f=w;f<=k;f++)T=l[f],u=d.get(T),u!==void 0&&u!==-1?(b[u]=r[f],g[u]=s[f],o&&(v[u]=o[f]),u=c[u],d.set(T,u)):s[f]();for(u=w;u<h;u++)u in b?(r[u]=b[u],s[u]=g[u],o&&(o[u]=v[u],o[u](u))):r[u]=Me(y);r=r.slice(0,i=h),l=a.slice(0)}return r});function y(d){if(s[u]=d,o){const[c,b]=R(u);return o[u]=b,t(a[u],c)}return t(a[u])}}}function m(e,t){return G(()=>e(t||{}))}const pt=e=>`Stale read from <${e}>.`;function Z(e){const t="fallback"in e&&{fallback:()=>e.fallback};return P(Ut(()=>e.each,e.children,t||void 0))}function B(e){const t=e.keyed,n=P(()=>e.when,void 0,void 0),l=t?n:P(n,void 0,{equals:(r,s)=>!r==!s});return P(()=>{const r=l();if(r){const s=e.children;return typeof s=="function"&&s.length>0?G(()=>s(t?r:()=>{if(!G(l))throw pt("Show");return n()})):s}return e.fallback},void 0,void 0)}function Ae(e){const t=bt(()=>e.children),n=P(()=>{const l=t(),r=Array.isArray(l)?l:[l];let s=()=>{};for(let i=0;i<r.length;i++){const o=i,a=r[i],h=s,f=P(()=>h()?void 0:a.when,void 0,void 0),u=a.keyed?f:P(f,void 0,{equals:(y,d)=>!y==!d});s=()=>h()||(u()?[o,f,a]:void 0)}return s});return P(()=>{const l=n()();if(!l)return e.fallback;const[r,s,i]=l,o=i.children;return typeof o=="function"&&o.length>0?G(()=>o(i.keyed?s():()=>{var h;if(((h=G(n)())==null?void 0:h[0])!==r)throw pt("Match");return s()})):o},void 0,void 0)}function H(e){return e}const ee=e=>P(()=>e());function Yt(e,t,n){let l=n.length,r=t.length,s=l,i=0,o=0,a=t[r-1].nextSibling,h=null;for(;i<r||o<s;){if(t[i]===n[o]){i++,o++;continue}for(;t[r-1]===n[s-1];)r--,s--;if(r===i){const f=s<l?o?n[o-1].nextSibling:n[s-o]:a;for(;o<s;)e.insertBefore(n[o++],f)}else if(s===o)for(;i<r;)(!h||!h.has(t[i]))&&t[i].remove(),i++;else if(t[i]===n[s-1]&&n[o]===t[r-1]){const f=t[--r].nextSibling;e.insertBefore(n[o++],t[i++].nextSibling),e.insertBefore(n[--s],f),t[r]=n[s]}else{if(!h){h=new Map;let u=o;for(;u<s;)h.set(n[u],u++)}const f=h.get(t[i]);if(f!=null)if(o<f&&f<s){let u=i,y=1,d;for(;++u<r&&u<s&&!((d=h.get(t[u]))==null||d!==f+y);)y++;if(y>f-o){const c=t[i];for(;o<f;)e.insertBefore(n[o++],c)}else e.replaceChild(n[o++],t[i++])}else i++;else t[i++].remove()}}}const nt="_$DX_DELEGATE";function Wt(e,t,n,l={}){let r;return Me(s=>{r=s,t===document?e():_(t,e(),t.firstChild?null:void 0,n)},l.owner),()=>{r(),t.textContent=""}}function p(e,t,n,l){let r;const s=()=>{const o=document.createElement("template");return o.innerHTML=e,o.content.firstChild},i=()=>(r||(r=s())).cloneNode(!0);return i.cloneNode=i,i}function se(e,t=window.document){const n=t[nt]||(t[nt]=new Set);for(let l=0,r=e.length;l<r;l++){const s=e[l];n.has(s)||(n.add(s),t.addEventListener(s,zt))}}function Kt(e,t){t==null?e.removeAttribute("class"):e.className=t}function Ve(e,t,n,l){Array.isArray(n)?(e[`$$${t}`]=n[0],e[`$$${t}Data`]=n[1]):e[`$$${t}`]=n}function $t(e,t,n={}){const l=Object.keys(t||{}),r=Object.keys(n);let s,i;for(s=0,i=r.length;s<i;s++){const o=r[s];!o||o==="undefined"||t[o]||(lt(e,o,!1),delete n[o])}for(s=0,i=l.length;s<i;s++){const o=l[s],a=!!t[o];!o||o==="undefined"||n[o]===a||!a||(lt(e,o,!0),n[o]=a)}return n}function Xt(e,t,n){n!=null?e.style.setProperty(t,n):e.style.removeProperty(t)}function Gt(e,t,n){return G(()=>e(t,n))}function _(e,t,n,l){if(n!==void 0&&!l&&(l=[]),typeof t!="function")return je(e,t,l,n);W(r=>je(e,t(),r,n),l)}function lt(e,t,n){const l=t.trim().split(/\s+/);for(let r=0,s=l.length;r<s;r++)e.classList.toggle(l[r],n)}function zt(e){let t=e.target;const n=`$$${e.type}`,l=e.target,r=e.currentTarget,s=a=>Object.defineProperty(e,"target",{configurable:!0,value:a}),i=()=>{const a=t[n];if(a&&!t.disabled){const h=t[`${n}Data`];if(h!==void 0?a.call(t,h,e):a.call(t,e),e.cancelBubble)return}return t.host&&typeof t.host!="string"&&!t.host._$host&&t.contains(e.target)&&s(t.host),!0},o=()=>{for(;i()&&(t=t._$host||t.parentNode||t.host););};if(Object.defineProperty(e,"currentTarget",{configurable:!0,get(){return t||document}}),e.composedPath){const a=e.composedPath();s(a[0]);for(let h=0;h<a.length-2&&(t=a[h],!!i());h++){if(t._$host){t=t._$host,o();break}if(t.parentNode===r)break}}else o();s(l)}function je(e,t,n,l,r){for(;typeof n=="function";)n=n();if(t===n)return n;const s=typeof t,i=l!==void 0;if(e=i&&n[0]&&n[0].parentNode||e,s==="string"||s==="number"){if(s==="number"&&(t=t.toString(),t===n))return n;if(i){let o=n[0];o&&o.nodeType===3?o.data!==t&&(o.data=t):o=document.createTextNode(t),n=ue(e,n,l,o)}else n!==""&&typeof n=="string"?n=e.firstChild.data=t:n=e.textContent=t}else if(t==null||s==="boolean")n=ue(e,n,l);else{if(s==="function")return W(()=>{let o=t();for(;typeof o=="function";)o=o();n=je(e,o,n,l)}),()=>n;if(Array.isArray(t)){const o=[],a=n&&Array.isArray(n);if(Ge(o,t,n,r))return W(()=>n=je(e,o,n,l,!0)),()=>n;if(o.length===0){if(n=ue(e,n,l),i)return n}else a?n.length===0?rt(e,o,l):Yt(e,n,o):(n&&ue(e),rt(e,o));n=o}else if(t.nodeType){if(Array.isArray(n)){if(i)return n=ue(e,n,l,t);ue(e,n,null,t)}else n==null||n===""||!e.firstChild?e.appendChild(t):e.replaceChild(t,e.firstChild);n=t}}return n}function Ge(e,t,n,l){let r=!1;for(let s=0,i=t.length;s<i;s++){let o=t[s],a=n&&n[e.length],h;if(!(o==null||o===!0||o===!1))if((h=typeof o)=="object"&&o.nodeType)e.push(o);else if(Array.isArray(o))r=Ge(e,o,a)||r;else if(h==="function")if(l){for(;typeof o=="function";)o=o();r=Ge(e,Array.isArray(o)?o:[o],Array.isArray(a)?a:[a])||r}else e.push(o),r=!0;else{const f=String(o);a&&a.nodeType===3&&a.data===f?e.push(a):e.push(document.createTextNode(f))}}return r}function rt(e,t,n=null){for(let l=0,r=t.length;l<r;l++)e.insertBefore(t[l],n)}function ue(e,t,n,l){if(n===void 0)return e.textContent="";const r=l||document.createTextNode("");if(t.length){let s=!1;for(let i=t.length-1;i>=0;i--){const o=t[i];if(r!==o){const a=o.parentNode===e;!s&&!i?a?e.replaceChild(r,o):e.insertBefore(r,n):a&&o.remove()}else s=!0}}else e.insertBefore(r,n);return[r]}const ze=Symbol("store-raw"),fe=Symbol("store-node"),C=Symbol("store-has"),St=Symbol("store-self");function kt(e){let t=e[oe];if(!t&&(Object.defineProperty(e,oe,{value:t=new Proxy(e,Zt)}),!Array.isArray(e))){const n=Object.keys(e),l=Object.getOwnPropertyDescriptors(e);for(let r=0,s=n.length;r<s;r++){const i=n[r];l[i].get&&Object.defineProperty(e,i,{enumerable:l[i].enumerable,get:l[i].get.bind(t)})}}return t}function Re(e){let t;return e!=null&&typeof e=="object"&&(e[oe]||!(t=Object.getPrototypeOf(e))||t===Object.prototype||Array.isArray(e))}function ie(e,t=new Set){let n,l,r,s;if(n=e!=null&&e[ze])return n;if(!Re(e)||t.has(e))return e;if(Array.isArray(e)){Object.isFrozen(e)?e=e.slice(0):t.add(e);for(let i=0,o=e.length;i<o;i++)r=e[i],(l=ie(r,t))!==r&&(e[i]=l)}else{Object.isFrozen(e)?e=Object.assign({},e):t.add(e);const i=Object.keys(e),o=Object.getOwnPropertyDescriptors(e);for(let a=0,h=i.length;a<h;a++)s=i[a],!o[s].get&&(r=e[s],(l=ie(r,t))!==r&&(e[s]=l))}return e}function De(e,t){let n=e[t];return n||Object.defineProperty(e,t,{value:n=Object.create(null)}),n}function pe(e,t,n){if(e[t])return e[t];const[l,r]=R(n,{equals:!1,internal:!0});return l.$=r,e[t]=l}function Jt(e,t){const n=Reflect.getOwnPropertyDescriptor(e,t);return!n||n.get||!n.configurable||t===oe||t===fe||(delete n.value,delete n.writable,n.get=()=>e[oe][t]),n}function At(e){Ke()&&pe(De(e,fe),St)()}function Qt(e){return At(e),Reflect.ownKeys(e)}const Zt={get(e,t,n){if(t===ze)return e;if(t===oe)return n;if(t===We)return At(e),n;const l=De(e,fe),r=l[t];let s=r?r():e[t];if(t===fe||t===C||t==="__proto__")return s;if(!r){const i=Object.getOwnPropertyDescriptor(e,t);Ke()&&(typeof s!="function"||e.hasOwnProperty(t))&&!(i&&i.get)&&(s=pe(l,t,s)())}return Re(s)?kt(s):s},has(e,t){return t===ze||t===oe||t===We||t===fe||t===C||t==="__proto__"?!0:(Ke()&&pe(De(e,C),t)(),t in e)},set(){return!0},deleteProperty(){return!0},ownKeys:Qt,getOwnPropertyDescriptor:Jt};function Ne(e,t,n,l=!1){if(!l&&e[t]===n)return;const r=e[t],s=e.length;n===void 0?(delete e[t],e[C]&&e[C][t]&&r!==void 0&&e[C][t].$()):(e[t]=n,e[C]&&e[C][t]&&r===void 0&&e[C][t].$());let i=De(e,fe),o;if((o=pe(i,t,r))&&o.$(()=>n),Array.isArray(e)&&e.length!==s){for(let a=e.length;a<s;a++)(o=i[a])&&o.$();(o=pe(i,"length",s))&&o.$(e.length)}(o=i[St])&&o.$()}function Tt(e,t){const n=Object.keys(t);for(let l=0;l<n.length;l+=1){const r=n[l];Ne(e,r,t[r])}}function Ct(e,t){if(typeof t=="function"&&(t=t(e)),t=ie(t),Array.isArray(t)){if(e===t)return;let n=0,l=t.length;for(;n<l;n++){const r=t[n];e[n]!==r&&Ne(e,n,r)}Ne(e,"length",l)}else Tt(e,t)}function me(e,t,n=[]){let l,r=e;if(t.length>1){l=t.shift();const i=typeof l,o=Array.isArray(e);if(Array.isArray(l)){for(let a=0;a<l.length;a++)me(e,[l[a]].concat(t),n);return}else if(o&&i==="function"){for(let a=0;a<e.length;a++)l(e[a],a)&&me(e,[a].concat(t),n);return}else if(o&&i==="object"){const{from:a=0,to:h=e.length-1,by:f=1}=l;for(let u=a;u<=h;u+=f)me(e,[u].concat(t),n);return}else if(t.length>1){me(e[l],t,[l].concat(n));return}r=e[l],n=[l].concat(n)}let s=t[0];typeof s=="function"&&(s=s(r,n),s===r)||l===void 0&&s==null||(s=ie(s),l===void 0||Re(r)&&Re(s)&&!Array.isArray(s)?Tt(r,s):Ne(e,l,s))}function Je(...[e,t]){const n=ie(e||{}),l=Array.isArray(n),r=kt(n);function s(...i){ve(()=>{l&&i.length===1?Ct(n,i[0]):me(n,i)})}return[r,s]}const en=80,tn=20,Mt=1.7,Et=20,de=20,Ee=100,Lt=500,st=720*60*1e3,ot=3600*24*10/85,X="story_town_1",It=new Array(495).fill(1).map((e,t)=>Math.floor(en*Math.pow(t+1,Mt))),_e=new Array(500).fill(1).map((e,t)=>Math.floor(tn*Math.pow(t+1,Mt))),Ot=(e,t=It)=>{if(!e)return 0;const n=t.findIndex(s=>s>e);if(n<0&&e>0)return 1;const l=e-(t[n-1]??0),r=t[n]-(t[n-1]??0);return l/r},$e=(e,t=It)=>{const n=t.findIndex(l=>l>e);return n<0&&e>0?t.length:n},nn=[{name:"hay_hand_1",label:"Hay hand wraps",stackable:!1,equipSlot:"hand",craftComplexity:1,craftType:"basic",craftLevel:1,ingredients:[{name:"hay_1",count:25}],stats:{attMin:1,attMax:3}},{name:"hay_head_1",label:"Hay bandana",stackable:!1,equipSlot:"head",craftComplexity:1,craftType:"basic",craftLevel:1,ingredients:[{name:"hay_1",count:25}],stats:{maxHealth:5}},{name:"hay_chest_1",label:"Hay vest",stackable:!1,equipSlot:"chest",craftComplexity:1,craftType:"basic",craftLevel:1,ingredients:[{name:"hay_1",count:50}],stats:{physRes:1}},{name:"utility_axe_1",label:"Rusty axe",stackable:!1,equipSlot:"weapon",utilityType:"axe",stats:{}}],ln=[{name:"recipe_hay_hand_1",label:"Recipe: Hay hand wraps",stackable:!1,exclusive:!0,craftableItem:"hay_hand_1"},{name:"recipe_bench_basic_1",label:"Recipe: Basic crafting table",stackable:!1,exclusive:!0,craftableFurniture:"furniture_bench_basic_1"},{name:"recipe_hay_head_1",label:"Recipe: Hay bandana",stackable:!1,exclusive:!0,craftableItem:"hay_head_1"},{name:"recipe_hay_chest_1",label:"Recipe: Hay vest",stackable:!1,exclusive:!0,craftableItem:"hay_chest_1"}].map(e=>({...e,useVerb:"Read",use:(t,n,l,r)=>(r==null||r.onTask({noRepeat:!0,label:"Learning",description:e.label,duration:100,onComplete:()=>{var s;return(s=l==null?void 0:l.recipes())!=null&&s.find(i=>i.craftableItem===e.craftableItem)||(l==null||l.onAddRecipe(e.name),t==null||t.setState("prohibitedItems",[...(t==null?void 0:t.state.prohibitedItems)??[],e.name])),n==null||n.removeInventory(e.name,1),t==null||t.onNavigate("_back"),!0}}),!1)})),rn=[{name:"hay_1",label:"Hay",stackable:!0,maxStack:100},{name:"wood_log_1",label:"Wooden log",stackable:!0,maxStack:100}],sn=[{name:"wood_club_1",label:"Wooden Club",equipSlot:"weapon",craftType:"weapon",craftComplexity:1,craftLevel:1,ingredients:[{name:"wood_log_1",count:15}],masteryType:"mace",stats:{attMin:2,attMax:5,attSpeed:-.1}},{name:"wood_shield_1",label:"Wooden Shield",equipSlot:"offhand",craftType:"armour",craftComplexity:1,craftLevel:1,ingredients:[{name:"wood_log_1",count:20}],stats:{physRes:2,maxHealth:10}},{name:"wood_chest_1",label:"Wooden Plank Vest",equipSlot:"chest",craftType:"armour",craftComplexity:2,craftLevel:1,ingredients:[{name:"wood_log_1",count:40}],stats:{physRes:3,agility:-1}},{name:"stone_axe_1",label:"Stone Axe",equipSlot:"weapon",craftType:"weapon",craftComplexity:2,craftLevel:2,ingredients:[{name:"wood_log_1",count:10},{name:"stone_1",count:10}],masteryType:"axe",stats:{attMin:3,attMax:8,attSpeed:-.05,strength:1}},{name:"stone_helm_1",label:"Stone Helm",equipSlot:"head",craftType:"armour",craftComplexity:2,craftLevel:2,ingredients:[{name:"stone_1",count:20},{name:"hay_1",count:10}],stats:{physRes:4,maxHealth:10,intelligence:-1}},{name:"copper_sword_1",label:"Copper Shortsword",equipSlot:"weapon",craftType:"weapon",craftComplexity:3,craftLevel:2,ingredients:[{name:"copper_ingot_1",count:8},{name:"wood_log_1",count:5}],masteryType:"sword",stats:{attMin:4,attMax:10,attSpeed:.1,dexterity:1}},{name:"copper_chest_1",label:"Copper Breastplate",equipSlot:"chest",craftType:"armour",craftComplexity:3,craftLevel:2,ingredients:[{name:"copper_ingot_1",count:15}],stats:{physRes:5,magRes:1,strength:1}},{name:"iron_spear_1",label:"Iron Spear",equipSlot:"weapon",craftType:"weapon",craftComplexity:4,craftLevel:3,ingredients:[{name:"iron_ingot_1",count:12},{name:"wood_log_1",count:8}],masteryType:"spear",stats:{attMin:6,attMax:14,attSpeed:0,dexterity:2}},{name:"iron_helm_1",label:"Iron Helmet",equipSlot:"head",craftType:"armour",craftComplexity:4,craftLevel:3,ingredients:[{name:"iron_ingot_1",count:8}],stats:{physRes:6,maxHealth:15,charisma:-1}},{name:"iron_boots_1",label:"Iron Greaves",equipSlot:"foot",craftType:"armour",craftComplexity:4,craftLevel:3,ingredients:[{name:"iron_ingot_1",count:6}],stats:{physRes:3,agility:-1}}],F=[nn,ln,rn,sn].flat().reduce((e,t)=>(e[t.name]=t,e),{}),on=[{name:"unarmed",label:"Unarmed",bonus:new Array(Lt+1).fill(null).map((e,t)=>{if(!(!t||t%5!==0))return{level:t,stats:{attMin:t%10===0?1:0,attMax:1,attSpeed:t%50===0?.1:0}}}).filter(Boolean)}],an=[{name:"woodcutting",label:"Woodcutting",bonus:new Array(Lt+1).fill(null).map((e,t)=>{if(!(!t||t%5!==0))return{level:t,stats:{durationModifier:t%10===0?10:0},dropModifiers:[{name:"wood_log_1",chance:t%50===0?1:0}]}}).filter(Boolean)}],ye=[on,an].flat().reduce((e,t)=>(e[t.name]=t,e),{}),Pt=(e,t)=>{const n=ye[e];if(!n)return{};const l=$e(t,_e),r=n.bonus.filter(s=>s.level<=l);return(r==null?void 0:r.reduce((s,i)=>(Object.entries(i.stats).forEach(([o,a])=>{s[o]=(s[o]??0)+a}),s),{}))??{}},cn=(e,t,n)=>{const l=ye[t];if(!l)return 0;const r=$e(n,_e),s=l.bonus.filter(i=>i.level<=r);return s==null?void 0:s.reduce((i,o)=>{var a,h;return i+(((h=(a=o.dropModifiers)==null?void 0:a.find(f=>f.name===e))==null?void 0:h.chance)??0)},0)};var un=p('<div class="font-bold m-2">'),dn=p("<div>");const qe=e=>(()=>{var t=un();return _(t,m(Z,{get each(){return e.lines},children:(n,l)=>(()=>{var r=dn();return _(r,m(B,{get when(){return l()===0},children:'" .. '}),null),_(r,n,null),_(r,m(B,{get when(){return l()===e.lines.length-1},children:' .. "'}),null),r})()})),t})();var fn=p("<span class=text-red-500>Fight scarecrows"),hn=p('<span class="font-bold ml-1">'),gn=p('<span class="font-bold text-blue-500 mr-1">Hay'),bn=p("<span class=font-bold>");const mn=[{name:"story_town_1",label:"Town",description:"You are in town",type:"dialogue",options:[{label:"Visit Farm",goto:"story_farmer_1"},{label:"Leave the town",goto:"story_forest_1"},{label:"Merchants",goto:"story_town_merchants_1"},{label:"Home",goto:"story_home_1"}]},{name:"story_farmer_1",label:"Farm",description:"A vacant expressionless farmer. Hasn't washed in days.",type:"dialogue",options:[{label:"Approach the farmer",goto:"story_farmer_2"},{label:fn(),goto:"story_scarecrows_1"},{label:"Sell Hay",action:(e,t,n)=>{if(!t)return;const r=t.inventory().filter(s=>(s==null?void 0:s.name)==="hay_1").reduce((s,i)=>s+((i==null?void 0:i.count)??0),0);r&&(t.removeInventory("hay_1",r),n==null||n.onAddStat("gold",r),e==null||e.onLog(["You sell",(()=>{var s=hn();return _(s,r),s})()," ",gn(),"For ",(()=>{var s=bn();return _(s,r),s})()," gold"],"meta"))}}]},{name:"story_farmer_2",label:"Farmer",description:["You approach, he holds your wrist loosely like an exhausted child.",m(qe,{lines:["Loathsome shadowed cloaks","Golden light shimmering, blind eyes","Fear, is Death knocking?"]}),"He sits and cries."],type:"dialogue",options:[{label:"Console",goto:"story_farmer_3"},{label:"Leave",goto:"_back"}]},{name:"story_farmer_3",label:"Farmer",description:m(qe,{lines:["Am *I* the keeper of the wheat?","... or is it the keeper of me?"]}),type:"dialogue",options:[{label:"Silently leave",goto:"_back.2"}]},{name:"story_scarecrows_1",label:"Scarecrows",description:"Fighting scarecrows",type:"encounter",cooldown:20,encounters:[{name:"enc_scarecrow_1",label:"Scarecrow",health:1,chance:1,experience:50,drops:[{name:"hay_1",chance:1},{name:"recipe_hay_hand_1",chance:1},{name:"recipe_hay_head_1",chance:.05},{name:"recipe_hay_chest_1",chance:.05}]}]}],_n=[{name:"furniture_bench_basic_1",label:"Basic bench",type:"craft",craftingComplexity:1,cratingType:"basic",ingredients:[{name:"wood_log_1",count:1}]},{name:"furniture_stash_1",label:"Basic stash",type:"stash",storageSize:5,ingredients:[{name:"wood_log_1",count:20},{name:"hay_1",count:50}]}],Qe=[_n].flat().reduce((e,t)=>(e[t.name]=t,e),{});var yn=p("<div class=font-bold>Stash"),vn=p("<div>Retrieve items from stash here, place in stash from your invent");const wn=[{name:"story_home_1",label:"Home",description:"Home sweet home",type:"dialogue",options:[{label:"Build",goto:"story_home_2"},{label:"Stash",goto:"story_stash_1"},{label:"Craft",goto:"story_home_4"}]},{name:"story_stash_1",label:"Stash",type:"dialogue",description:[yn(),vn()]},{name:"story_home_2",label:"Building",description:"Build new appliances",type:"dialogue",options:(e,t,n,l)=>{var s;return!n||!t?[]:((s=n==null?void 0:n.recipes())==null?void 0:s.filter(i=>!!i.craftableFurniture).map(i=>Qe[i.craftableFurniture])).map(i=>{var o;return{label:i.label,action:()=>{l==null||l.onTask({noRepeat:!0,label:"Building",description:i.label,duration:100,onComplete:()=>$n(e,t,i)})},isDisabled:!it(t,i),subtext:(o=i.ingredients)==null?void 0:o.map(a=>`${F[a.name].label} (${a.count})`).join(" - ")}})??[]}},{name:"story_home_4",label:"Crafting",description:"A workshop",type:"dialogue",options:e=>{var t;return((t=e==null?void 0:e.state.furniture)==null?void 0:t.map(n=>Qe[n]).filter(n=>n.type==="craft").map(n=>({label:n.label,goto:`story_craft_${n.cratingType}_1`})))??[]}},{name:"story_craft_basic_1",label:"Basic crafting",description:"A very simple crafting table",type:"dialogue",options:(e,t,n,l)=>{var s;return!n||!t?[]:((s=n==null?void 0:n.recipes())==null?void 0:s.filter(i=>!!i.craftableItem).map(i=>F[i.craftableItem]).filter(i=>i.craftType==="basic"&&i.craftComplexity===1)).map(i=>{var o;return{label:i.label,action:()=>{l==null||l.onTask({noRepeat:!0,label:"Crafting",description:i.label,duration:100,onComplete:()=>pn(t,i)})},isDisabled:!it(t,i),subtext:(o=i.ingredients)==null?void 0:o.map(a=>`${F[a==null?void 0:a.name].label} (${a==null?void 0:a.count})`).join(" - ")}})??[]}}],pn=(e,t)=>{var n;e.addInventory(t.name,1),(n=t.ingredients)==null||n.forEach(l=>e.removeInventory(l.name,l.count))},$n=(e,t,n)=>{var l;e.setState("furniture",[...e.state.furniture,n.name]),(l=n.ingredients)==null||l.forEach(r=>t.removeInventory(r.name,r.count))},it=(e,t)=>{var n;return(n=t.ingredients)!=null&&n.length?t.ingredients.every(l=>((e==null?void 0:e.inventory().reduce((s,i)=>((i==null?void 0:i.name)===l.name&&(s=s+(i.count??1)),s),0))??0)>=l.count):!0};var Sn=p("<span class=text-red-500>Venture deeper");const kn=[{type:"dialogue",name:"story_forest_1",label:"Forest border",description:"The canopy casts a shadow. Sounds, eyes ... movement",options:(e,t,n)=>[{label:"Chop wood",goto:"task_chop_wood_1",isDisabled:!!!(n!=null&&n.equipment().find(r=>r.equipSlot==="weapon"&&r.utilityType==="axe"))},{label:Sn(),goto:"story_forest_2"}]},{type:"task",name:"task_chop_wood_1",label:"Surrounded by trees",description:"Chopping wood",duration:100,masteryType:"woodcutting",cooldown:10,experience:1,utilityType:"axe",items:[{name:"wood_log_1",chance:1}]},{name:"story_forest_2",label:"Deep forest",description:"Creatures block your path...",type:"encounter",limit:5,onComplete:e=>{e==null||e.onNavigate("story_forest_3")},cooldown:20,encounters:[{name:"enc_rabbit_1",label:"Little rabbit",chance:.4,experience:50,drops:[],health:5,stats:{attMin:0,attMax:1,attSpeed:10}},{name:"enc_deer_1",label:"Frightened deer",chance:1,experience:50,drops:[],health:10,stats:{attMin:0,attMax:4,attSpeed:45}},{name:"enc_dead_tree_1",label:"Dead tree",chance:1,experience:10,health:10}]},{name:"story_forest_3",label:"welcome to the deep forest",type:"dialogue",description:"You made it!"}],An=[{name:"utility_axe_1",cost:1}],Tn=[{name:"recipe_bench_basic_1",cost:1}],Mn=[{type:"dialogue",name:"story_town_merchants_1",label:"Town Bazaar",description:"Souks, stalls, spices, hands... hands... hands...",options:[{label:"Tool merchant",goto:"story_town_merchant_tool_1"},{label:"Building merchant",goto:"story_town_merchant_building_1"}]},{type:"dialogue",name:"story_town_merchant_tool_1",label:"Tool Merchant",description:["A burly man, skin of leather ",m(qe,{lines:["The very finest tools"]})],options:(e,t,n)=>{const l=n==null?void 0:n.player.stats.gold;return An.map(r=>{const s=F[r.name];return{label:`${(s==null?void 0:s.label)??"UNKNOWN"} - ${r.cost}g`,action:()=>{t==null||t.addInventory(s.name,1),n==null||n.onAddStat("gold",0-r.cost),e==null||e.onNavigate("story_town_merchant_tool_1")},isDisabled:r.cost>(l??0)}})}},{type:"dialogue",name:"story_town_merchant_building_1",label:"Building Merchant",description:["Beard down to his bare nipples ",m(qe,{lines:["DIY... home improvements","Sweat...","Muscles..."]})],options:(e,t,n)=>{const l=n==null?void 0:n.player.stats.gold;return Tn.map(r=>{const s=F[r.name];return{label:`${(s==null?void 0:s.label)??"UNKNOWN"} - ${r.cost}g`,action:()=>{t==null||t.addInventory(s.name,1),n==null||n.onAddStat("gold",0-r.cost),e==null||e.onNavigate("story_town_merchant_building_1")},isDisabled:r.cost>(l??0)}})}}],Ze=[mn,wn,kn,Mn].flat().reduce((e,t)=>(e[t.name]=t,e),{}),ne=Fe(),En=e=>{const t=P(()=>{var d;return((d=e.player.recipes)==null?void 0:d.map(c=>F[c]))??[]}),n=d=>{e.setPlayer("recipes",[...e.player.recipes??[],d].filter((c,b,g)=>g.indexOf(c)===b))},l=P(()=>{var d;return((d=e.player.equipment)==null?void 0:d.map(c=>F[c]))??[]}),r=P(()=>{var d;return((d=l().find(c=>c.equipSlot==="weapon"))==null?void 0:d.masteryType)??"unarmed"}),s=d=>{var c;return Pt(d,((c=e.player.mastery)==null?void 0:c[d])??0)},i=P(()=>{var T;const d=l();let c=d.reduce((I,O)=>{var S;return I+(((S=O.stats)==null?void 0:S.attMin)??0)},1),b=d.reduce((I,O)=>{var S;return I+(((S=O.stats)==null?void 0:S.attMax)??0)},1);const g=r(),v=s(g);c+=(v==null?void 0:v.attMin)??0,b+=(v==null?void 0:v.attMax)??0;const w=1+Math.pow((((T=e.player.stats)==null?void 0:T.strength)??0)/100,.7),k=Math.round(c*w),$=Math.round(b*w);return[k,$]}),o=P(()=>{var J;const d=l(),c=100,b=Math.min(c,Math.max(1,((J=e.player.stats)==null?void 0:J.agility)??0)),g=1,v=de/5,w=Math.sqrt(b/c),k=v*w,$=de/5,T=Math.min(d.reduce((E,L)=>{var N;return E+(((N=L.stats)==null?void 0:N.attSpeed)??0)},0),1),I=T*$,O=de/5,S=r(),A=s(S),x=(A.attSpeed??0)*O,Y=(de/2.5-1)*((w+T+(A.attSpeed??0))/3);return Math.max(de-k-I-Y-x,g)}),a=(d,c=1)=>{const b=(e.player.stats[d]??0)+c;e.setPlayer("stats",d,b)},h=(d,c=1)=>{const b=(e.player.mastery[d]??0)+c;e.setPlayer("mastery",d,b)},f=d=>l().find(c=>c.equipSlot===d.equipSlot)?!1:(e.setPlayer("equipment",[...e.player.equipment,d.name]),Object.entries(d.stats??{}).forEach(([c,b])=>a(c,b)),!0),u=d=>!e.player.equipment.includes(d.name)?!1:(e.setPlayer("equipment",[...e.player.equipment.filter(b=>b!==d.name)]),Object.entries(d.stats??{}).forEach(([b,g])=>a(b,0-g)),!0),y={attackRate:o,attackDamage:i,player:e.player,equipment:l,onAddStat:a,onAddMastery:h,onEquip:f,onUnequip:u,recipes:t,getMasteryPerk:s,weaponMastery:r,onAddRecipe:n};return m(ne.Provider,{value:y,get children(){return e.children}})},at=(e,t)=>(typeof t=="object"&&(t=JSON.stringify(t)),window.localStorage.setItem(e,`${t}`)),Ye=e=>{const t=window.localStorage.getItem(e);if(!t)return t??void 0;try{return JSON.parse(t)}catch{return t}},ae=Fe(),Ln=e=>{const t=(f,u=1)=>{const[y,d]=o(e.state.inventory,f,u);return d>0&&e.setState("inventory",y),d},n=P(()=>e.state.inventory),l=P(()=>e.state.stash);he(f=>{const u=e.state.furniture.map(d=>Qe[d]).filter(d=>d.type==="stash").reduce((d,c)=>d+(c.storageSize??0),0);if(u===f)return u;const y=e.state.stash.filter(Boolean);if(u<y.length)throw new Error("Invalid stash, size too small for contents");return e.setState("stash",[...y,...new Array(u-y.length).fill(null)]),u},0);const r=(f,u=1)=>{const[y,d]=a(e.state.inventory,f,u);return d>0&&e.setState("inventory",y),d},s=(f,u=1)=>{const[y,d]=o(e.state.stash,f,u),[c,b]=a(e.state.inventory,f,u);return b!==d?(console.error(`Unable to move ${f} from invent to stash`),0):(d>0&&ve(()=>{e.setState("inventory",c),e.setState("stash",y)}),d)},i=(f,u=1)=>{const[y,d]=a(e.state.stash,f,u),[c,b]=o(e.state.inventory,f,u);return d!==b?(console.error(`Unable to move ${f} from stash to invent`),0):(d>0&&ve(()=>{e.setState("inventory",c),e.setState("stash",y)}),d)},o=(f,u,y)=>{if(!F[u])return console.warn("Invalid or not found item",u),[f,0];const d=F[u];if(!y)return[f,0];if(y===1/0)return console.error("Cannot add infinite items to invent"),[f,0];let c=[...f];if(d.exclusive&&c.find(g=>(g==null?void 0:g.name)===d.name))return[c,0];let b=y;return d.stackable&&d.maxStack&&(c=c.map(g=>{if(!(g!=null&&g.name)||!b)return g;if(g.name===d.name&&g.count<d.maxStack){let v=Math.min(g.count+b,d.maxStack);return b-=v-g.count,{...g,count:v}}return g})),b&&(c=c.map(g=>{if(!b)return g;if(g===null){const v=Math.min(b,d.maxStack??1);return b-=v,{name:d.name,count:v}}return g})),[c,y-b]},a=(f,u,y=1)=>{if(!y)return[f,0];if(!F[u])return console.warn("Invalid or not found name",u),[f,0];const d=F[u];if(f.findLastIndex(v=>(v==null?void 0:v.name)===d.name)<0)return[f,0];let b=y;const g=[...f.toReversed().map(v=>{if(!b||(v==null?void 0:v.name)!==d.name)return v;if(v.count<=b)return b-=v.count,null;const w=v.count-b;return b=0,{...v,count:w}}).reverse()].filter(Boolean);return g.push(...new Array(Et-g.length).fill(null)),[g,y-b]},h={inventory:n,stash:l,addInventory:t,removeInventory:r,addStash:s,removeStash:i};return m(ae.Provider,{value:h,get children(){return e.children}})},ct={stats:{health:10,maxHealth:10,gold:0,experience:0},equipment:[],mastery:{},recipes:[]},ut={prohibitedItems:[],stash:new Array(2).fill(null),furniture:[],inventory:new Array(Et).fill(null)},z=Fe(),Te="freeze_time",dt="state",In=e=>{const[t,n]=R([]),[l,r]=R(X),[s,i]=Je(ct),[o,a]=Je(ut),[h,f]=R([X]),[u,y]=R(0),[d,c]=R(!0),[b,g]=R(ot),[v,w]=R(15),[k,$]=R([]);xe(()=>{setInterval(()=>{d()||(T(),k().forEach(([E,L])=>L()))},Ee)});const T=()=>{k().length&&(y(u()+1),u()>b()&&(g(b()+ot),w(v()+1)),k().forEach(([E,L])=>L()))};setInterval(()=>{x()},1e4);const I=(E,L)=>{k().find(([N])=>N===E)||$([...k(),[E,L]])},O=E=>{$([...k().filter(([L])=>L!==E)])};document.addEventListener("visibilitychange",()=>{if(document.visibilityState==="hidden")x(),at(Te,Date.now());else{const E=Ye(Te);if(E){const L=Math.min(Date.now()-E,st);let N=Math.floor(L/Ee);M(N)}}});const S=()=>{const E=Ye(dt);E&&ve(()=>{r(E.story),i(E.player),a(E.state),f(E.nav),y(E.ticks)});const L=Ye(Te);if(L){const N=Math.min(Date.now()-L,st);let Q=Math.floor(N/Ee);M(Q)}},A=()=>{ve(()=>{i(ct),a(ut),y(0),Y(X)}),x()};window.cs=A;const x=()=>{console.log("Saving...");const E={player:ie(s),state:ie(o),ticks:u(),story:l(),nav:h()};at(dt,E)},M=E=>{E>0?requestIdleCallback(()=>{let L=1e3;for(;E>0&&L>0;)T(),E--,L--;E>0?M(E):c(!1)}):c(!1)};window.addEventListener("load",S),window.addEventListener("beforeunload",()=>{x(),window.localStorage.setItem(Te,`${Date.now()}`)});const Y=E=>{if(E==="_start"&&(E=X),E===X){f([X]),r(X);return}const L=/^_back/.test(E);if(!L&&!Ze[E]){console.error(`Unknown story ${E}`);return}if(L){const[N,Q]=E.split("."),le=Math.min(parseInt(Q??"1"),h().length+1);E=h().at(-1-le)??X,h().length>1&&f(h().slice(0,-le))}else h().at(-1)!==E&&f([...h(),E]);r(E)},J={state:o,setState:a,year:v,startActivity:I,endActivity:O,onNavigate:Y,nav:h,onLog:(E,L="basic")=>{var le;const N=new Date,Q={msg:E,time:[N.getHours(),N.getMinutes(),N.getSeconds()].join(":"),type:L};n([...t().slice(Math.min(((le=t())==null?void 0:le.length)-999,0)),Q])},log:t,pause:d,setNav:f,onClearState:A};return m(z.Provider,{value:J,get children(){return m(Ln,{state:o,setState:a,get children(){return m(En,{player:s,setPlayer:i,get children(){return m(On,{story:l,setStory:r,get children(){return e.children}})}})}})}})},ce=Fe(),On=e=>{const t=j(z),n=j(ne),[l,r]=R();he(()=>{const u=e.story()??X;u!=="task"&&r(Ze[u]??Ze[X])});const s=()=>{var d;const u=l();if(!u)return;if(u.type==="task")return{name:"task",label:u.label,health:u.duration??0,chance:1,drops:u.items};const y=Math.random();if(!(u.type!=="encounter"||!((d=u.encounters)!=null&&d.length)))return u.encounters.sort((c,b)=>c.chance-b.chance).find(c=>y<=c.chance)},i=u=>{const{attMin:y,attMax:d}=u.stats??{};if(!(!y||!d))return y+Math.round(Math.random()*(y-d))},o=u=>a(u==null?void 0:u.drops),a=u=>{const y=l();if(!y)return;u=u??y.items??[];let d=[];const c=y.masteryType?(n==null?void 0:n.player.mastery[y.masteryType])??0:0;for(let b of u){let g=b.chance;for(c&&(g=g+cn(b.name,y.masteryType,c));g>0;)Math.random()<=g&&d.push(b),g--}return d==null?void 0:d.map(b=>F[b.name].name).filter(Boolean)},f={story:l,getEncounter:s,getDamage:i,getDrops:o,getItems:a,onTask:u=>{t==null||t.setNav([...(t==null?void 0:t.nav())??[],"task"]),e.setStory("task"),r({name:"task",type:"task",...u,onComplete:u.noRepeat?u.onComplete??(()=>t==null?void 0:t.onNavigate("_back")):void 0})}};return m(ce.Provider,{value:f,get children(){return e.children}})};var Pn=p('<div class="flex flex-row mt-auto gap-2"><div class="w-full border content-center cursor-pointer h-12 text-lg font-bold mt-auto">Go back</div><div class="w-full border content-center cursor-pointer h-12 text-lg font-bold mt-auto">Town'),jn=p('<div class="flex flex-col gap-5 p-2 h-full overflow-y-auto">'),Rn=p("<div class=text-gray-500>Nothing here..."),Dn=p('<span class="text-xs text-gray-400">'),Nn=p('<div class="w-full border content-center h-12 text-lg font-bold flex flex-col justify-center">');const qn=()=>{const e=j(z),t=j(ae),n=j(ne),l=j(ce),r=i=>{if(i.goto)return e==null?void 0:e.onNavigate(i.goto);if(i.action&&e&&t&&n&&l)return i.action(e,t,n,l)},s=P(()=>{var o;const i=(o=l==null?void 0:l.story())==null?void 0:o.options;return Array.isArray(i)?i:e&&t&&n&&l?(i==null?void 0:i(e,t,n,l))??[]:[]});return(()=>{var i=jn();return _(i,m(B,{get when(){return s().length},get fallback(){return Rn()},get children(){return m(Z,{get each(){return s()},children:o=>(()=>{var a=Nn();return a.$$click=()=>!o.isDisabled&&r(o),_(a,()=>o.label,null),_(a,m(B,{get when(){return o.subtext},get children(){var h=Dn();return _(h,()=>o.subtext),h}}),null),W(h=>{var f=!!o.isDisabled,u=!o.isDisabled;return f!==h.e&&a.classList.toggle("text-gray-500",h.e=f),u!==h.t&&a.classList.toggle("cursor-pointer",h.t=u),h},{e:void 0,t:void 0}),a})()})}}),null),_(i,m(B,{get when(){var o;return((o=l==null?void 0:l.story())==null?void 0:o.name)!==X},get children(){var o=Pn(),a=o.firstChild,h=a.nextSibling;return a.$$click=()=>r({label:"Go back",goto:"_back"}),h.$$click=()=>r({label:"Back to town",goto:"_start"}),o}}),null),i})()};se(["click"]);var Bn=p("<div>");const K=e=>(()=>{var t=Bn();return Ve(t,"click",e.onClick),_(t,()=>e.children),W(()=>Kt(t,`${e.class??""} bg-black rounded py-1 px-2 cursor-pointer hover:outline hover:outline-blue-500 font-bold text-xs h-full`)),t})();se(["click"]);var xn=p("<div class=text-sm>"),Hn=p("<button class=m-auto> "),Fn=p("<button class=m-auto>equip"),Vn=p('<div class="px-2 py-1 bg-blue-300 w-full flex flex-row justify-between items-center mb-2"><span class="font-bold text-xl text-black">Stash</span><div class="flex flex-row gap-4">'),Un=p('<div class="absolute bottom-0 left-0 w-full border-t content-center p-2 bg-slate-500"><div class="flex flex-col gap-2"><div class="flex flex-row justify-center relative"><span class="absolute left-0 top-0 font-bold cursor-pointer border-2 rounded-xl px-2 hover:bg-white hover:text-black">X</span><div class=font-bold> (<!>)</div></div><div class="flex flex-col gap-1 justify-between"><div class="w-full flex flex-row justify-between gp-2 mb-2"></div><div class="px-2 py-1 bg-red-300 w-full flex flex-row justify-between items-center"><span class="font-bold text-xl text-black">Drop</span><div class="flex flex-row gap-4">'),Yn=p('<div class="h-full relative"><div class="flex flex-col gap-2 h-7/8 overflow-auto p-2">'),Wn=p('<div class="border p-1 cursor-pointer flex flex-row justify-between"><div></div><div>(<!>)'),Kn=p('<div class="border p-1 flex flex-row justify-between border-gray-700 text-gray-700">Empty');const Xn=()=>{const e=j(z),t=j(ae),n=j(ne),l=j(ce),[r,s]=R(),i=d=>{d<0||!(t!=null&&t.inventory().at(d))||s(d)},o=P(()=>{const d=r()??-1;if(d<0)return;const c=t==null?void 0:t.inventory().at(d);return c?{item:F[c.name],count:c.count}:null}),a=()=>{var c,b;const d=o();d&&(!e||!t||!n||!l||(b=(c=d.item).use)!=null&&b.call(c,e,t,n,l)&&s(void 0))},h=()=>{const d=o(),c=d?d.item:null;c!=null&&c.equipSlot&&n!=null&&n.onEquip(c)&&(t==null||t.removeInventory(c.name,1),s(void 0))},f=d=>{const c=o();c&&(t==null||t.removeInventory(c.item.name,d),d>=(c.count??1)&&s(void 0))},u=d=>{const c=o();c&&(d=d===1/0?(t==null?void 0:t.inventory().reduce((b,g)=>(g==null?void 0:g.name)===c.item.name?b+(g.count??0):b,0))??0:d,c&&(t==null||t.addStash(c.item.name,d)))},y=P(()=>e==null?void 0:e.nav().includes("story_home_1"));return(()=>{var d=Yn(),c=d.firstChild;return c.$$click=()=>s(void 0),_(c,m(Z,{get each(){return(t==null?void 0:t.inventory())??[]},children:(b,g)=>m(jt,{item:b,onSelect:()=>i(g())})})),_(d,m(B,{get when(){return o()},get children(){var b=Un(),g=b.firstChild,v=g.firstChild,w=v.firstChild,k=w.nextSibling,$=k.firstChild,T=$.nextSibling;T.nextSibling;var I=v.nextSibling,O=I.firstChild,S=O.nextSibling,A=S.firstChild,x=A.nextSibling;return w.$$click=()=>s(void 0),_(k,()=>{var M;return(M=o())==null?void 0:M.item.label},$),_(k,()=>{var M;return(M=o())==null?void 0:M.count},T),_(g,m(B,{get when(){return o().item.stats},get children(){var M=xn();return _(M,()=>Object.entries(o().item.stats??{}).filter(([Y,U])=>!!U).map(([Y,U])=>`[${Y}: ${U}]`).join("")),M}}),I),_(O,m(B,{get when(){var M;return(M=o())==null?void 0:M.item.use},get children(){var M=Hn(),Y=M.firstChild;return M.$$click=a,_(M,()=>{var U;return((U=o())==null?void 0:U.item.useVerb)??"Use"},Y),M}}),null),_(O,m(B,{get when(){var M;return((M=o())==null?void 0:M.item).equipSlot},get children(){var M=Fn();return M.$$click=h,M}}),null),_(I,m(B,{get when(){return y()},get children(){var M=Vn(),Y=M.firstChild,U=Y.nextSibling;return _(U,m(K,{onClick:()=>u(1),children:"One"}),null),_(U,m(K,{onClick:()=>{var J;return u(((J=o())==null?void 0:J.count)??1)},children:"Stack"}),null),_(U,m(K,{onClick:()=>u(1/0),children:"All"}),null),M}}),S),_(x,m(K,{onClick:()=>f(1),children:"One"}),null),_(x,m(K,{onClick:()=>{var M;return f(((M=o())==null?void 0:M.count)??1)},children:"Stack"}),null),_(x,m(K,{onClick:()=>f(1/0),children:"All"}),null),b}}),null),d})()},jt=e=>{const t=l=>{l.stopPropagation(),e.onSelect()},n=P(()=>e.item?F[e.item.name].label:null);return m(B,{get when(){return e.item},get fallback(){return Kn()},get children(){var l=Wn(),r=l.firstChild,s=r.nextSibling,i=s.firstChild,o=i.nextSibling;return o.nextSibling,l.$$click=t,_(r,n),_(s,()=>{var a;return(a=e.item)==null?void 0:a.count},o),l}})};se(["click"]);var Gn=p('<div class="w-full border rounded relative text-black bg-gray-500"><div class="ease-linear w-0 h-full rounded"></div><div class="absolute left-1/2 top-1/2 -translate-1/2 whitespace-nowrap">');const Ce=e=>{const t=j(z),[n,l]=R(e.ticks),r=()=>{let s=n();s<=0&&(e.onFinish(),s=e.ticks+1),l(s-1)};return xe(()=>t==null?void 0:t.startActivity(e.name,r)),He(()=>t==null?void 0:t.endActivity(e.name)),m(Se,{get max(){return e.ticks},get value(){return e.ticks-n()},get type(){return e.type},get showPc(){return e.showPc},get showNumber(){return e.showNumber},get label(){return e.label}})},Se=e=>{const t=P(()=>Math.min(e.value/e.max*100,100));return(()=>{var n=Gn(),l=n.firstChild,r=l.nextSibling;return _(r,m(Ae,{get children(){return[m(H,{get when(){return e.showPc},get children(){return[ee(()=>e.label)," (",ee(()=>t().toFixed(0)),"%)"]}}),m(H,{get when(){return e.showNumber},get children(){return[ee(()=>e.label)," ",ee(()=>e.value)]}})]}})),W(s=>{var i=!e.isSmall,o=t()+"%",a=!e.type,h=e.type==="green",f=e.type==="yellow",u=e.type==="blue",y=e.type==="red";return i!==s.e&&n.classList.toggle("h-full",s.e=i),o!==s.t&&Xt(l,"width",s.t=o),a!==s.a&&l.classList.toggle("bg-white",s.a=a),h!==s.o&&l.classList.toggle("bg-green-500",s.o=h),f!==s.i&&l.classList.toggle("bg-yellow-500",s.i=f),u!==s.n&&l.classList.toggle("bg-blue-500",s.n=u),y!==s.s&&l.classList.toggle("bg-red-500",s.s=y),s},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0}),n})()};var zn=p('<div class="flex flex-col justify-between items-center cursor-pointer"><div class="text-xl font-bold"></div><div class="h-4 w-32">'),Jn=p('<div class="flex flex-row justify-between items-center font-bold mb-2"><div>Level</div><div>Stats'),Qn=p('<div class="flex flex-col h-full"><div class="h-7/8 p-2"></div><div class="h-1/8 flex flex-row justify-between gap-2 p-2"><button>Skills</button><button>Mastery</button><button>Recipes'),Zn=p('<div class="flex flex-row justify-between items-center cursor-pointer"><div></div><div class="h-4 w-32">'),Cn=p('<div class="flex flex-row justify-between items-center border-b border-gray-700"><div></div><div class=text-xs>'),el=p('<div class="flex flex-row justify-between items-center"><div>');const tl=()=>{const[e,t]=R("mastery"),n=j(ne),[l,r]=R(),s=P(()=>Object.entries((n==null?void 0:n.player.mastery)??{}).map(([a,h])=>{const f=ye[a];return{label:(f==null?void 0:f.label)??"",progress:Ot(h,_e)*100,level:$e(h,_e),name:a}})??[]),i=a=>{r(void 0),t(a)},o=P(()=>{var u,y,d;const a=(u=l())==null?void 0:u.name;if(a===void 0)return;const h=$e((n==null?void 0:n.player.mastery[a])??0,_e),f=(y=ye[a])==null?void 0:y.bonus.findLastIndex(c=>c.level<=h);return(d=ye[a])==null?void 0:d.bonus.slice(0,(f??0)+2).map((c,b,g)=>({level:c.level,stats:Object.entries(c.stats??{}).filter(([v,w])=>!!w).map(([v,w])=>`[${v}: ${w}]`).join(""),isLast:b===g.length-1}))});return(()=>{var a=Qn(),h=a.firstChild,f=h.nextSibling,u=f.firstChild,y=u.nextSibling,d=y.nextSibling;return _(h,m(Ae,{get children(){return[m(H,{get when(){return e()==="skills"},children:"TODO"}),m(H,{get when(){return ee(()=>e()==="mastery")()&&!l()},get children(){return m(Z,{get each(){return s()},children:c=>(()=>{var b=Zn(),g=b.firstChild,v=g.nextSibling;return b.$$click=()=>r(c),_(g,()=>c.label),_(v,m(Se,{get label(){return`${c.level}`},type:"yellow",max:100,get value(){return c.progress},showPc:!0})),b})()})}}),m(H,{get when(){return ee(()=>e()==="mastery")()&&l()},get children(){return[(()=>{var c=zn(),b=c.firstChild,g=b.nextSibling;return _(b,()=>{var v;return(v=l())==null?void 0:v.label}),_(g,m(Se,{get label(){return`${l().level}`},type:"yellow",max:100,get value(){return l().progress},showPc:!0})),c})(),Jn(),m(Z,{get each(){return o()},children:c=>(()=>{var b=Cn(),g=b.firstChild,v=g.nextSibling;return _(g,()=>c.level),_(v,(()=>{var w=ee(()=>!!c.isLast);return()=>w()?"???":c.stats})()),b})()})]}}),m(H,{get when(){return e()==="recipes"},get children(){return m(Z,{get each(){return n==null?void 0:n.recipes()},children:c=>(()=>{var b=el(),g=b.firstChild;return _(g,()=>c.label),b})()})}})]}})),u.$$click=()=>i("skills"),y.$$click=()=>i("mastery"),d.$$click=()=>i("recipes"),W(c=>{var b=e()==="skills",g=e()==="mastery",v=e()==="recipes";return b!==c.e&&u.classList.toggle("selected",c.e=b),g!==c.t&&y.classList.toggle("selected",c.t=g),v!==c.a&&d.classList.toggle("selected",c.a=v),c},{e:void 0,t:void 0,a:void 0}),a})()};se(["click"]);var nl=p('<span class="text-red-800 font-bold">'),ll=p('<span class="text-green-800 font-bold">'),ft=p('<span class="text-red-800 font-bold m-1">'),rl=p('<span class="font-bold m-1">'),sl=p("<span class=font-bold>"),ol=p("<div class=text-red-800>"),il=p("<div class=h-8><div class=h-2>"),al=p("<div class=h-2>"),cl=p('<div class="h-8 mt-5">'),ul=p('<div class="flex flex-col gap-1 p-1 h-full"><div class=bg-black>Attacking (<!>)');const dl=()=>{const e=j(z),t=j(ce),n=j(ne),l=j(ae),[r,s]=R(),[i,o]=R(25),[a,h]=R(0),[f,u]=R(0),[y,d]=R(),[c,b]=R();he($=>{var T,I;return(T=t==null?void 0:t.story())!=null&&T.name&&(e!=null&&e.pause())&&!$?(s((I=t==null?void 0:t.story())==null?void 0:I.name),e==null||e.startActivity(`${r()}_catchup`,g),!$):!(e!=null&&e.pause())&&$?(e==null||e.endActivity(`${r()}_catchup`),!$):$},!1);const g=()=>{i()<=0&&c()?v():o(i()-1)};xe(()=>{var $,T;s(($=t==null?void 0:t.story())==null?void 0:$.name),o((n==null?void 0:n.attackRate())??25),b(t==null?void 0:t.getEncounter()),d((T=c())==null?void 0:T.health)});const v=()=>{var U,J,E;const $=!(e!=null&&e.pause()),[T,I]=[n,t==null?void 0:t.story()],O=c(),S=y();if(!T||!I)return;if(o((n==null?void 0:n.attackRate())??25),!O&&I.limit&&f()>=I.limit){(U=I.onComplete)==null||U.call(I,e,l,n,t);return}if(!O){b(t==null?void 0:t.getEncounter()),d((J=c())==null?void 0:J.health);return}if(!S)return;const[A,x]=(n==null?void 0:n.attackDamage())??[0,1],M=A+Math.round(Math.random()*(x-A)),Y=S-Math.min(M,S);if($&&(e==null||e.onLog(["You hit the ",(()=>{var L=nl();return _(L,O.label),L})()," for ",(()=>{var L=ll();return _(L,M),L})()," damage"],"basic")),n==null||n.onAddMastery(n==null?void 0:n.weaponMastery(),M),Y<=0){$&&(e==null||e.onLog(["You killed the",(()=>{var N=ft();return _(N,O.label),N})()],"good")),u(f()+1),b(void 0),O.experience&&(n==null||n.onAddStat("experience",O.experience));const L=(E=t==null?void 0:t.getDrops(O))==null?void 0:E.filter(N=>{var Q;return!((Q=e==null?void 0:e.state.prohibitedItems)!=null&&Q.includes(N))}).filter(N=>!!(l!=null&&l.addInventory(N)));if(L!=null&&L.length&&$&&(e==null||e.onLog(["It dropped:",(()=>{var N=rl();return _(N,L==null?void 0:L.map(Q=>{var le;return(le=F[Q])==null?void 0:le.label}).join(", ")),N})()],"drop")),I.noRepeat)return;h(I.cooldown??0),e==null||e.startActivity(`${r()}_wait`,k)}d(Math.max(Y,0))},w=()=>{var x;const $=!(e!=null&&e.pause()),[T,I]=[n==null?void 0:n.player,t==null?void 0:t.story()];if(!T||!I)return;const{attMin:O,attMax:S}=((x=c())==null?void 0:x.stats)??{};if(O===void 0||S===void 0)return;const A=O+Math.round(Math.random()*(S-O));if($&&(e==null||e.onLog([(()=>{var M=ft();return _(M,c().label),M})()," hits you for ",(()=>{var M=sl();return _(M,A),M})()," damage!"],"bad")),T.stats.health<=A){e==null||e.onNavigate("_start");return}n==null||n.onAddStat("health",-A)},k=()=>{if(a()<=0)return e==null||e.endActivity(`${r()}_wait`),v();h(a()-1)};return He(()=>{e==null||e.endActivity(`${r()}_wait`)}),m(B,{get when(){return!(e!=null&&e.pause())},get children(){var $=ul(),T=$.firstChild,I=T.firstChild,O=I.nextSibling;return O.nextSibling,_(T,f,O),_(T,m(B,{get when(){var S;return(S=t==null?void 0:t.story())==null?void 0:S.limit},get children(){return[" / ",ee(()=>{var S;return(S=t==null?void 0:t.story())==null?void 0:S.limit})]}}),O),_($,m(B,{get when(){var S;return ee(()=>{var A;return!!(!c()&&((A=t==null?void 0:t.story())!=null&&A.limit))})()&&f()>=(((S=t==null?void 0:t.story())==null?void 0:S.limit)??0)},children:"There is nothing left here to destroy"}),null),_($,m(B,{get when(){return c()},fallback:"Waiting.. Searching.. Wondering..",get children(){return[(()=>{var S=ol();return _(S,()=>{var A;return(A=c())==null?void 0:A.label}),S})(),(()=>{var S=il(),A=S.firstChild;return _(S,m(Se,{type:"red",get max(){return(n==null?void 0:n.player.stats.maxHealth)??10},get value(){return(n==null?void 0:n.player.stats.health)??0},label:"You",showNumber:!0}),A),_(A,m(Ce,{get name(){return`${r()}_att`},get ticks(){return i()},onFinish:v,type:"yellow",isSmall:!0})),S})(),(()=>{var S=cl();return _(S,m(Se,{type:"red",get max(){return c().health},get value(){return y()},get label(){var A;return(A=c())==null?void 0:A.label},showNumber:!0}),null),_(S,m(B,{get when(){var A,x;return(x=(A=c())==null?void 0:A.stats)==null?void 0:x.attSpeed},get children(){var A=al();return _(A,m(Ce,{get name(){return`${r()}_enc`},get ticks(){return c().stats.attSpeed},onFinish:w,type:"yellow",isSmall:!0})),A}}),null),S})()]}}),null),$}})};var fl=p('<span class="text-red-800 font-bold m-1">'),hl=p('<span class="font-bold m-1">'),gl=p("<div class=text-red-800>"),bl=p("<div class=h-8>"),ml=p('<div class="flex flex-col gap-1 p-1 h-full"><div class=bg-black>');const _l=()=>{const e=j(z),t=j(ae),n=j(ne),l=j(ce),[r,s]=R(),[i,o]=R(!1),[a,h]=R(0),[f,u]=R(0),y=P(()=>{var v,w,k;const g=(v=l==null?void 0:l.story())==null?void 0:v.masteryType;if(g){const $=Pt(g,(n==null?void 0:n.player.mastery[g])??0);return Math.max(1,(((w=l==null?void 0:l.story())==null?void 0:w.duration)??100)-($.durationModifier??0))}return((k=l==null?void 0:l.story())==null?void 0:k.duration)??100});he(()=>{var g;(g=l==null?void 0:l.story())!=null&&g.utilityType&&(n!=null&&n.equipment().find(v=>{var w;return v.utilityType===((w=l==null?void 0:l.story())==null?void 0:w.utilityType)})||e==null||e.onNavigate("_back"))}),he(g=>{var v,w;return y()?(v=l==null?void 0:l.story())!=null&&v.name&&(e!=null&&e.pause())&&!g?(s((w=l==null?void 0:l.story())==null?void 0:w.name),u(f()??y()),e==null||e.startActivity(`${r()}_catchup`,d),!g):!(e!=null&&e.pause())&&g?(e==null||e.endActivity(`${r()}_catchup`),!g):g:g},!1);const d=()=>{f()<=0&&i()?c():u(f()-1)};xe(()=>{var g;s((g=l==null?void 0:l.story())==null?void 0:g.name),o(!0)});const c=()=>{var w,k;const g=l==null?void 0:l.story();if(!n||!l||!g)return;if(!i()){u(y()),o(!0);return}o(!1),e==null||e.onLog(["You finished",(()=>{var $=fl();return _($,g.description),$})()],"good"),g.masteryType&&(n==null||n.onAddMastery(g.masteryType,g.experience??0));const v=(w=l.getItems())==null?void 0:w.filter($=>{var T;return!((T=e==null?void 0:e.state.prohibitedItems)!=null&&T.includes($))}).filter($=>!!(t!=null&&t.addInventory($)));if(v!=null&&v.length&&(e==null||e.onLog(["You gained:",(()=>{var $=hl();return _($,v==null?void 0:v.join(", ")),$})()],"drop")),g.noRepeat)return((k=g.onComplete)==null?void 0:k.call(g,e,t,n,l))??(e==null?void 0:e.onNavigate("_back"));h(g.cooldown??0),e==null||e.startActivity(`${r()}_wait`,b)},b=()=>{if(a()<=0)return e==null||e.endActivity(`${r()}_wait`),c();h(a()-1)};return He(()=>{e==null||e.endActivity(`${r()}_wait`),e==null||e.endActivity(`${r()}_catchup`)}),m(B,{get when(){return!(e!=null&&e.pause())},get children(){var g=ml(),v=g.firstChild;return _(v,()=>{var w;return(w=l==null?void 0:l.story())==null?void 0:w.label}),_(g,m(B,{get when(){return i()},fallback:"Waiting.. Searching.. Wondering..",get children(){return[(()=>{var w=gl();return _(w,()=>{var k;return(k=l==null?void 0:l.story())==null?void 0:k.description}),w})(),(()=>{var w=bl();return _(w,m(Ce,{get name(){return`${r()}_task`},get ticks(){return y()},onFinish:c,label:"Task",showPc:!0})),w})()]}}),null),g}})};var yl=p('<div class="text-lg font-bold mt-5">Weapon'),vl=p('<div class="text-lg font-bold mt-5">Armour'),wl=p('<div class="flex flex-col h-full"><div class="h-7/8 p-2"></div><div class="h-1/8 flex flex-row justify-between gap-2 p-2"><button>Equip</button><button>Stats'),pl=p('<div class="flex flex-row justify-between border-gray-700"><div></div><div>'),$l=p('<div class="flex flex-row justify-between items-center border-gray-700"><div></div><div class="text-xs text-gray-500">');const Sl=()=>{const[e,t]=R("stats"),n=j(ne),l=j(ae),r=P(()=>{const o=n==null?void 0:n.attackDamage(),a=1e3/Ee,h=1/(((n==null?void 0:n.attackRate())??de)/a);return[{label:"Health",value:(n==null?void 0:n.player.stats.health)??0},{label:"Max health",value:(n==null?void 0:n.player.stats.maxHealth)??0},{label:"",value:" "},{label:"Att. min",value:(o==null?void 0:o.at(0))??0},{label:"Att. max",value:(o==null?void 0:o.at(1))??0},{label:"Att. rate",value:`${(h==null?void 0:h.toFixed(2))??0} p/s`},{label:"",value:" "},{label:"Phys. res",value:(n==null?void 0:n.player.stats.physRes)??0},{label:"Mag. res",value:(n==null?void 0:n.player.stats.magRes)??0}]}),s=o=>{l!=null&&l.addInventory(o.name,1)&&(n==null||n.onUnequip(o))},i=P(()=>{const o=["weapon","offhand"],a=["head","shoulder","chest","hand","leg","foot"];return[{label:yl(),isDisabled:!1,isEmpty:!0},...o.map(h=>{const f=h&&(n==null?void 0:n.equipment().find(u=>u.equipSlot===h));return{label:(f==null?void 0:f.label)??h,isDisabled:!f,subtext:Object.entries((f==null?void 0:f.stats)??{}).map(([u,y])=>`[${u}: ${y}]`).join(""),onClick:f?()=>s(f):void 0}}),{label:vl(),isDisabled:!1,isEmpty:!0},...a.map(h=>{const f=h&&(n==null?void 0:n.equipment().find(u=>u.equipSlot===h));return{label:(f==null?void 0:f.label)??h,isDisabled:!f,subtext:Object.entries((f==null?void 0:f.stats)??{}).map(([u,y])=>`[${u}: ${y}]`).join(""),onClick:f?()=>s(f):void 0}})]});return(()=>{var o=wl(),a=o.firstChild,h=a.nextSibling,f=h.firstChild,u=f.nextSibling;return _(a,m(Ae,{get children(){return[m(H,{get when(){return e()==="stats"},get children(){return m(Z,{get each(){return r()},children:y=>(()=>{var d=pl(),c=d.firstChild,b=c.nextSibling;return _(c,()=>y.label),_(b,()=>y.value),W(()=>d.classList.toggle("border-b",!!y.label)),d})()})}}),m(H,{get when(){return e()==="equip"},get children(){return m(Z,{get each(){return i()},children:y=>(()=>{var d=$l(),c=d.firstChild,b=c.nextSibling;return Ve(d,"click",y.onClick),_(c,()=>y.label),_(b,()=>y.subtext),W(g=>{var v=!y.isEmpty,w=!!y.isDisabled;return v!==g.e&&d.classList.toggle("border-b",g.e=v),w!==g.t&&c.classList.toggle("text-gray-700",g.t=w),g},{e:void 0,t:void 0}),d})()})}})]}})),f.$$click=()=>t("equip"),u.$$click=()=>t("stats"),W(y=>{var d=e()==="equip",c=e()==="stats";return d!==y.e&&f.classList.toggle("selected",y.e=d),c!==y.t&&u.classList.toggle("selected",y.t=c),y},{e:void 0,t:void 0}),o})()};se(["click"]);var kl=p('<div class="absolute bottom-0 left-0 w-full border-t content-center p-2 bg-slate-500"><div class="flex flex-col gap-2"><div class="flex flex-row justify-center relative mb-3"><span class="absolute left-0 top-0 font-bold cursor-pointer border-2 rounded-xl px-2 hover:bg-white hover:text-black">X</span><div class=font-bold> (<!>)</div></div><div class="flex flex-col gap-1 justify-between"><div class="px-2 py-1 bg-blue-300 w-full flex flex-row justify-between items-center mb-2"><span class="font-bold text-xl text-black">Transfer</span><div class="flex flex-row gap-4"></div></div><div class="px-2 py-1 bg-red-300 w-full flex flex-row justify-between items-center"><span class="font-bold text-xl text-black">Drop</span><div class="flex flex-row gap-4">'),Al=p('<div class="h-full relative pb-2"><div class="flex flex-col gap-2 h-7/8 overflow-auto p-2"></div><div class="w-full border content-center cursor-pointer h-12 text-lg font-bold mt-auto">Leave stash');const Tl=()=>{const e=j(ae),t=j(z),[n,l]=R(),r=a=>{a<0||!(e!=null&&e.stash()[a])||l(a)},s=P(()=>{const a=n()??-1;if(a<0)return;const h=e==null?void 0:e.stash().at(a);return h?{item:F[h.name],count:h.count}:null}),i=a=>{const h=s();h&&(e==null||e.removeInventory(h.item.name,a),a>=(h.count??1)&&l(void 0))},o=a=>{const h=s();h&&(a=a===1/0?(e==null?void 0:e.stash().reduce((f,u)=>(u==null?void 0:u.name)===h.item.name?f+u.count:f,0))??0:a,e==null||e.removeStash(h.item.name,a))};return(()=>{var a=Al(),h=a.firstChild,f=h.nextSibling;return h.$$click=()=>l(void 0),_(h,m(Z,{get each(){return e==null?void 0:e.stash()},children:(u,y)=>m(jt,{item:u,onSelect:()=>r(y())})})),_(a,m(B,{get when(){return s()},get children(){var u=kl(),y=u.firstChild,d=y.firstChild,c=d.firstChild,b=c.nextSibling,g=b.firstChild,v=g.nextSibling;v.nextSibling;var w=d.nextSibling,k=w.firstChild,$=k.firstChild,T=$.nextSibling,I=k.nextSibling,O=I.firstChild,S=O.nextSibling;return c.$$click=()=>l(void 0),_(b,()=>{var A;return(A=s())==null?void 0:A.item.label},g),_(b,()=>{var A;return(A=s())==null?void 0:A.count},v),_(T,m(K,{onClick:()=>o(1),children:"One"}),null),_(T,m(K,{onClick:()=>{var A;return o(((A=s())==null?void 0:A.count)??1)},children:"Stack"}),null),_(T,m(K,{onClick:()=>o(1/0),children:"All"}),null),_(S,m(K,{onClick:()=>i(1),children:"One"}),null),_(S,m(K,{onClick:()=>{var A;return i(((A=s())==null?void 0:A.count)??1)},children:"Stack"}),null),_(S,m(K,{onClick:()=>i(1/0),children:"All"}),null),u}}),f),f.$$click=()=>t==null?void 0:t.onNavigate("_back"),a})()};se(["click"]);var Ml=p('<div class="flex flex-col p-2 gap-2 w-full"><div class="border p-2 font-bold cursor-pointer">RESET');const El=()=>{const e=j(z);return(()=>{var t=Ml(),n=t.firstChild;return Ve(n,"click",e==null?void 0:e.onClearState),t})()};se(["click"]);var Ll=p('<div class="w-dvw h-dvh lg:w-[360px] lg:h-[800px] flex flex-col justify-between"><div class="h-3/10 bg-gray-400"><div class=h-1/10></div><div class=h-9/10></div></div><div class=h-1/10></div><div class="h-5/10 bg-gray-800">'),Il=p("<div>Unknown view"),Ol=p('<div class="h-1/10 w-full flex flex-row justify-between font-bold">'),Pl=p('<div class="flex flex-col gap-2 p-1 h-full"><div class="bg-black text-left pl-1"></div><div class="text-black whitespace-pre-wrap text-left overflow-y-auto text-sm">'),jl=p('<div class="h-full bg-white flex flex-row"><div class="text-black bottom-0 left-0 border border-gray-100 p-1 flex flex-col gap-1 bg-white"><div class="rounded h-4 w-4 cursor-pointer"title="Show/hide bad"></div><div class="rounded h-4 w-4 cursor-pointer"title="Show/hide good"></div><div class="rounded h-4 w-4 cursor-pointer"title="Show/hide meta"></div><div class="rounded h-4 w-4 cursor-pointer"title="Show/hide drop"></div><div class="rounded h-4 w-4 cursor-pointer"title="Show/hide basic"></div></div><div class="text-black h-full overflow-y-auto flex flex-col w-full">'),Rl=p('<div class="flex flex-row items-center px-1 transition-colors duration-500 border-t border-gray-200"><div class="text-xs text-blue-400 mr-1">[<!>]</div><div class="text-wrap text-xs text-left">'),Dl=p('<div class="flex flex-row bg-black px-1 justify-between"><div class=text-red-500>HP <!>/</div><div class=text-yellow-500>Gold </div><div class=text-white>Age </div><div class=text-green-500>Lvl <!> (<!>%)'),Nl=p('<div class="content-center w-1/4 border border-l-0 cursor-pointer last:border-r-0">');const ql=()=>m(In,{get children(){return m(Bl,{})}}),Bl=()=>{const[e,t]=R("story"),n=j(ce),l=P(()=>{var r;return e()==="story"&&((r=n==null?void 0:n.story())==null?void 0:r.name)==="story_stash_1"?"stash":e()});return(()=>{var r=Ll(),s=r.firstChild,i=s.firstChild,o=i.nextSibling,a=s.nextSibling,h=a.nextSibling;return _(i,m(Vl,{})),_(o,m(Hl,{})),_(a,m(Fl,{})),_(h,m(Ae,{get fallback(){return Il()},get children(){return[m(H,{get when(){return l()==="story"},get children(){return m(qn,{})}}),m(H,{get when(){return l()==="stash"},get children(){return m(Tl,{})}}),m(H,{get when(){return l()==="invent"},get children(){return m(Xn,{})}}),m(H,{get when(){return l()==="skills"},get children(){return m(tl,{})}}),m(H,{get when(){return l()==="stats"},get children(){return m(Sl,{})}}),m(H,{get when(){return l()==="menu"},get children(){return m(El,{})}})]}})),_(r,m(xl,{onChange:t,get view(){return e()}}),null),r})()},xl=e=>(()=>{var t=Ol();return _(t,m(be,{label:"Story",onClick:()=>e.onChange("story"),get view(){return e.view},type:"story"}),null),_(t,m(be,{label:"Invent",onClick:()=>e.onChange("invent"),get view(){return e.view},type:"invent"}),null),_(t,m(be,{label:"Skills",onClick:()=>e.onChange("skills"),get view(){return e.view},type:"skills"}),null),_(t,m(be,{label:"Stats",onClick:()=>e.onChange("stats"),get view(){return e.view},type:"stats"}),null),_(t,m(be,{label:"Menu",onClick:()=>e.onChange("menu"),get view(){return e.view},type:"menu"}),null),t})(),Hl=()=>{const e=j(ce);return m(Ae,{get children(){return[m(H,{get when(){var t;return((t=e==null?void 0:e.story())==null?void 0:t.type)==="dialogue"},get children(){var t=Pl(),n=t.firstChild,l=n.nextSibling;return _(n,()=>{var r;return((r=e==null?void 0:e.story())==null?void 0:r.label)??"Story"}),_(l,()=>{var r;return(r=e==null?void 0:e.story())==null?void 0:r.description}),t}}),m(H,{get when(){var t;return((t=e==null?void 0:e.story())==null?void 0:t.type)==="encounter"},get children(){return m(dl,{})}}),m(H,{get when(){var t;return((t=e==null?void 0:e.story())==null?void 0:t.type)==="task"},get children(){return m(_l,{})}})]}})},Fl=()=>{const[e,t]=R(),n=j(z),[l,r]=Je({good:!0,bad:!0,meta:!0,drop:!0,basic:!0}),s=P(()=>{const i=e();if(!i)return;const o=i.scrollTop+i.clientHeight>i.scrollHeight-10;return setTimeout(()=>o&&i.scrollTo(0,i.scrollHeight??0)),n==null?void 0:n.log().filter(a=>l[a.type])});return(()=>{var i=jl(),o=i.firstChild,a=o.firstChild,h=a.nextSibling,f=h.nextSibling,u=f.nextSibling,y=u.nextSibling,d=o.nextSibling;return a.$$click=()=>r("bad",!l.bad),h.$$click=()=>r("good",!l.good),f.$$click=()=>r("meta",!l.meta),u.$$click=()=>r("drop",!l.drop),y.$$click=()=>r("basic",!l.basic),Gt(t,d),_(d,m(Z,{get each(){return s()},children:c=>(()=>{var b=Rl(),g=b.firstChild,v=g.firstChild,w=v.nextSibling;w.nextSibling;var k=g.nextSibling;return _(g,()=>c.time,w),_(k,()=>c.msg),W($=>$t(b,{"last:bg-red-500 last:text-white bg-red-200":c.type==="bad","last:bg-green-500 last:text-white bg-green-200":c.type==="good","last:bg-yellow-500 bg-yellow-200":c.type==="meta","last:bg-blue-500 last:text-white bg-blue-200":c.type==="drop"},$)),b})()})),W(c=>{var b=!l.bad,g=!!l.bad,v=!l.good,w=!!l.good,k=!l.meta,$=!!l.meta,T=!l.drop,I=!!l.drop,O=!l.basic,S=!!l.basic;return b!==c.e&&a.classList.toggle("bg-red-100",c.e=b),g!==c.t&&a.classList.toggle("bg-red-500",c.t=g),v!==c.a&&h.classList.toggle("bg-green-100",c.a=v),w!==c.o&&h.classList.toggle("bg-green-500",c.o=w),k!==c.i&&f.classList.toggle("bg-yellow-100",c.i=k),$!==c.n&&f.classList.toggle("bg-yellow-500",c.n=$),T!==c.s&&u.classList.toggle("bg-blue-100",c.s=T),I!==c.h&&u.classList.toggle("bg-blue-500",c.h=I),O!==c.r&&y.classList.toggle("bg-gray-100",c.r=O),S!==c.d&&y.classList.toggle("bg-gray-500",c.d=S),c},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0}),i})()},Vl=()=>{const e=j(ne),t=j(z);return(()=>{var n=Dl(),l=n.firstChild,r=l.firstChild,s=r.nextSibling;s.nextSibling;var i=l.nextSibling;i.firstChild;var o=i.nextSibling;o.firstChild;var a=o.nextSibling,h=a.firstChild,f=h.nextSibling,u=f.nextSibling,y=u.nextSibling;return y.nextSibling,_(l,()=>e==null?void 0:e.player.stats.health,s),_(l,()=>e==null?void 0:e.player.stats.maxHealth,null),_(i,()=>e==null?void 0:e.player.stats.gold,null),_(o,()=>t==null?void 0:t.year(),null),_(a,()=>$e((e==null?void 0:e.player.stats.experience)??0),f),_(a,()=>(Ot((e==null?void 0:e.player.stats.experience)??0)*100).toFixed(0),y),n})()},be=e=>(()=>{var t=Nl();return Ve(t,"click",e.onClick),_(t,()=>e.label),W(n=>$t(t,{"border-t-0 bg-gray-800":e.view===e.type},n)),t})();se(["click"]);const Ul=document.getElementById("root");Wt(()=>m(ql,{}),Ul);
