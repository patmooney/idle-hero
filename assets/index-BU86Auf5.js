var bt=Object.defineProperty;var pt=(e,t,n)=>t in e?bt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var E=(e,t,n)=>pt(e,typeof t!="symbol"?t+"":t,n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const o of l.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerPolicy&&(l.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?l.credentials="include":s.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(s){if(s.ep)return;s.ep=!0;const l=n(s);fetch(s.href,l)}})();const mt=!1,vt=(e,t)=>e===t,G=Symbol("solid-proxy"),Ce=Symbol("solid-track"),de={equals:vt};let We=Qe;const Y=1,he=2,Ke={owned:null,cleanups:null,context:null,owner:null};var C=null;let Ae=null,wt=null,L=null,P=null,W=null,_e=0;function fe(e,t){const n=L,r=C,s=e.length===0,l=t===void 0?r:t,o=s?Ke:{owned:null,cleanups:null,context:l?l.context:null,owner:l},i=s?e:()=>e(()=>B(()=>se(o)));C=o,L=null;try{return ee(i,!0)}finally{L=n,C=r}}function T(e,t){t=t?Object.assign({},de,t):de;const n={value:e,observers:null,observerSlots:null,comparator:t.equals||void 0},r=s=>(typeof s=="function"&&(s=s(n.value)),ze(n,s));return[Je.bind(n),r]}function j(e,t,n){const r=De(e,t,!1,Y);ae(r)}function Ye(e,t,n){We=kt;const r=De(e,t,!1,Y);r.user=!0,W?W.push(r):ae(r)}function O(e,t,n){n=n?Object.assign({},de,n):de;const r=De(e,t,!0,0);return r.observers=null,r.observerSlots=null,r.comparator=n.equals||void 0,ae(r),Je.bind(r)}function _t(e){return ee(e,!1)}function B(e){if(L===null)return e();const t=L;L=null;try{return e()}finally{L=t}}function ie(e){Ye(()=>B(e))}function $e(e){return C===null||(C.cleanups===null?C.cleanups=[e]:C.cleanups.push(e)),e}function Ee(){return L}function Xe(e,t){const n=Symbol("context");return{id:n,Provider:xt(n),defaultValue:e}}function R(e){let t;return C&&C.context&&(t=C.context[e.id])!==void 0?t:e.defaultValue}function Ge(e){const t=O(e),n=O(()=>Le(t()));return n.toArray=()=>{const r=n();return Array.isArray(r)?r:r!=null?[r]:[]},n}function Je(){if(this.sources&&this.state)if(this.state===Y)ae(this);else{const e=P;P=null,ee(()=>ye(this),!1),P=e}if(L){const e=this.observers?this.observers.length:0;L.sources?(L.sources.push(this),L.sourceSlots.push(e)):(L.sources=[this],L.sourceSlots=[e]),this.observers?(this.observers.push(L),this.observerSlots.push(L.sources.length-1)):(this.observers=[L],this.observerSlots=[L.sources.length-1])}return this.value}function ze(e,t,n){let r=e.value;return(!e.comparator||!e.comparator(r,t))&&(e.value=t,e.observers&&e.observers.length&&ee(()=>{for(let s=0;s<e.observers.length;s+=1){const l=e.observers[s],o=Ae&&Ae.running;o&&Ae.disposed.has(l),(o?!l.tState:!l.state)&&(l.pure?P.push(l):W.push(l),l.observers&&Ze(l)),o||(l.state=Y)}if(P.length>1e6)throw P=[],new Error},!1)),t}function ae(e){if(!e.fn)return;se(e);const t=_e;$t(e,e.value,t)}function $t(e,t,n){let r;const s=C,l=L;L=C=e;try{r=e.fn(t)}catch(o){return e.pure&&(e.state=Y,e.owned&&e.owned.forEach(se),e.owned=null),e.updatedAt=n+1,et(o)}finally{L=l,C=s}(!e.updatedAt||e.updatedAt<=n)&&(e.updatedAt!=null&&"observers"in e?ze(e,r):e.value=r,e.updatedAt=n)}function De(e,t,n,r=Y,s){const l={fn:e,state:r,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:C,context:C?C.context:null,pure:n};return C===null||C!==Ke&&(C.owned?C.owned.push(l):C.owned=[l]),l}function ge(e){if(e.state===0)return;if(e.state===he)return ye(e);if(e.suspense&&B(e.suspense.inFallback))return e.suspense.effects.push(e);const t=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<_e);)e.state&&t.push(e);for(let n=t.length-1;n>=0;n--)if(e=t[n],e.state===Y)ae(e);else if(e.state===he){const r=P;P=null,ee(()=>ye(e,t[0]),!1),P=r}}function ee(e,t){if(P)return e();let n=!1;t||(P=[]),W?n=!0:W=[],_e++;try{const r=e();return St(n),r}catch(r){n||(W=null),P=null,et(r)}}function St(e){if(P&&(Qe(P),P=null),e)return;const t=W;W=null,t.length&&ee(()=>We(t),!1)}function Qe(e){for(let t=0;t<e.length;t++)ge(e[t])}function kt(e){let t,n=0;for(t=0;t<e.length;t++){const r=e[t];r.user?e[n++]=r:ge(r)}for(t=0;t<n;t++)ge(e[t])}function ye(e,t){e.state=0;for(let n=0;n<e.sources.length;n+=1){const r=e.sources[n];if(r.sources){const s=r.state;s===Y?r!==t&&(!r.updatedAt||r.updatedAt<_e)&&ge(r):s===he&&ye(r,t)}}}function Ze(e){for(let t=0;t<e.observers.length;t+=1){const n=e.observers[t];n.state||(n.state=he,n.pure?P.push(n):W.push(n),n.observers&&Ze(n))}}function se(e){let t;if(e.sources)for(;e.sources.length;){const n=e.sources.pop(),r=e.sourceSlots.pop(),s=n.observers;if(s&&s.length){const l=s.pop(),o=n.observerSlots.pop();r<s.length&&(l.sourceSlots[o]=r,s[r]=l,n.observerSlots[r]=o)}}if(e.tOwned){for(t=e.tOwned.length-1;t>=0;t--)se(e.tOwned[t]);delete e.tOwned}if(e.owned){for(t=e.owned.length-1;t>=0;t--)se(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}e.state=0}function At(e){return e instanceof Error?e:new Error(typeof e=="string"?e:"Unknown error",{cause:e})}function et(e,t=C){throw At(e)}function Le(e){if(typeof e=="function"&&!e.length)return Le(e());if(Array.isArray(e)){const t=[];for(let n=0;n<e.length;n++){const r=Le(e[n]);Array.isArray(r)?t.push.apply(t,r):t.push(r)}return t}return e}function xt(e,t){return function(r){let s;return j(()=>s=B(()=>(C.context={...C.context,[e]:r.value},Ge(()=>r.children))),void 0),s}}const Ct=Symbol("fallback");function Re(e){for(let t=0;t<e.length;t++)e[t]()}function Et(e,t,n={}){let r=[],s=[],l=[],o=0,i=t.length>1?[]:null;return $e(()=>Re(l)),()=>{let a=e()||[],f=a.length,u,c;return a[Ce],B(()=>{let w,d,_,A,M,S,x,I,D;if(f===0)o!==0&&(Re(l),l=[],r=[],s=[],o=0,i&&(i=[])),n.fallback&&(r=[Ct],s[0]=fe(g=>(l[0]=g,n.fallback())),o=1);else if(o===0){for(s=new Array(f),c=0;c<f;c++)r[c]=a[c],s[c]=fe(p);o=f}else{for(_=new Array(f),A=new Array(f),i&&(M=new Array(f)),S=0,x=Math.min(o,f);S<x&&r[S]===a[S];S++);for(x=o-1,I=f-1;x>=S&&I>=S&&r[x]===a[I];x--,I--)_[I]=s[x],A[I]=l[x],i&&(M[I]=i[x]);for(w=new Map,d=new Array(I+1),c=I;c>=S;c--)D=a[c],u=w.get(D),d[c]=u===void 0?-1:u,w.set(D,c);for(u=S;u<=x;u++)D=r[u],c=w.get(D),c!==void 0&&c!==-1?(_[c]=s[u],A[c]=l[u],i&&(M[c]=i[u]),c=d[c],w.set(D,c)):l[u]();for(c=S;c<f;c++)c in _?(s[c]=_[c],l[c]=A[c],i&&(i[c]=M[c],i[c](c))):s[c]=fe(p);s=s.slice(0,o=f),r=a.slice(0)}return s});function p(w){if(l[c]=w,i){const[d,_]=T(c);return i[c]=_,t(a[c],d)}return t(a[c])}}}function h(e,t){return B(()=>e(t||{}))}const tt=e=>`Stale read from <${e}>.`;function K(e){const t="fallback"in e&&{fallback:()=>e.fallback};return O(Et(()=>e.each,e.children,t||void 0))}function N(e){const t=e.keyed,n=O(()=>e.when,void 0,void 0),r=t?n:O(n,void 0,{equals:(s,l)=>!s==!l});return O(()=>{const s=r();if(s){const l=e.children;return typeof l=="function"&&l.length>0?B(()=>l(t?s:()=>{if(!B(r))throw tt("Show");return n()})):l}return e.fallback},void 0,void 0)}function ce(e){const t=Ge(()=>e.children),n=O(()=>{const r=t(),s=Array.isArray(r)?r:[r];let l=()=>{};for(let o=0;o<s.length;o++){const i=o,a=s[o],f=l,u=O(()=>f()?void 0:a.when,void 0,void 0),c=a.keyed?u:O(u,void 0,{equals:(p,w)=>!p==!w});l=()=>f()||(c()?[i,u,a]:void 0)}return l});return O(()=>{const r=n()();if(!r)return e.fallback;const[s,l,o]=r,i=o.children;return typeof i=="function"&&i.length>0?B(()=>i(o.keyed?l():()=>{var f;if(((f=B(n)())==null?void 0:f[0])!==s)throw tt("Match");return l()})):i},void 0,void 0)}function q(e){return e}const ne=e=>O(()=>e());function Lt(e,t,n){let r=n.length,s=t.length,l=r,o=0,i=0,a=t[s-1].nextSibling,f=null;for(;o<s||i<l;){if(t[o]===n[i]){o++,i++;continue}for(;t[s-1]===n[l-1];)s--,l--;if(s===o){const u=l<r?i?n[i-1].nextSibling:n[l-i]:a;for(;i<l;)e.insertBefore(n[i++],u)}else if(l===i)for(;o<s;)(!f||!f.has(t[o]))&&t[o].remove(),o++;else if(t[o]===n[l-1]&&n[i]===t[s-1]){const u=t[--s].nextSibling;e.insertBefore(n[i++],t[o++].nextSibling),e.insertBefore(n[--l],u),t[s]=n[l]}else{if(!f){f=new Map;let c=i;for(;c<l;)f.set(n[c],c++)}const u=f.get(t[o]);if(u!=null)if(i<u&&u<l){let c=o,p=1,w;for(;++c<s&&c<l&&!((w=f.get(t[c]))==null||w!==u+p);)p++;if(p>u-i){const d=t[o];for(;i<u;)e.insertBefore(n[i++],d)}else e.replaceChild(n[i++],t[o++])}else o++;else t[o++].remove()}}}const He="_$DX_DELEGATE";function Tt(e,t,n,r={}){let s;return fe(l=>{s=l,t===document?e():y(t,e(),t.firstChild?null:void 0,n)},r.owner),()=>{s(),t.textContent=""}}function m(e,t,n,r){let s;const l=()=>{const i=document.createElement("template");return i.innerHTML=e,i.content.firstChild},o=()=>(s||(s=l())).cloneNode(!0);return o.cloneNode=o,o}function ue(e,t=window.document){const n=t[He]||(t[He]=new Set);for(let r=0,s=e.length;r<s;r++){const l=e[r];n.has(l)||(n.add(l),t.addEventListener(l,Ot))}}function nt(e,t,n,r){Array.isArray(n)?(e[`$$${t}`]=n[0],e[`$$${t}Data`]=n[1]):e[`$$${t}`]=n}function rt(e,t,n={}){const r=Object.keys(t||{}),s=Object.keys(n);let l,o;for(l=0,o=s.length;l<o;l++){const i=s[l];!i||i==="undefined"||t[i]||(Be(e,i,!1),delete n[i])}for(l=0,o=r.length;l<o;l++){const i=r[l],a=!!t[i];!i||i==="undefined"||n[i]===a||!a||(Be(e,i,!0),n[i]=a)}return n}function Mt(e,t,n){n!=null?e.style.setProperty(t,n):e.style.removeProperty(t)}function It(e,t,n){return B(()=>e(t,n))}function y(e,t,n,r){if(n!==void 0&&!r&&(r=[]),typeof t!="function")return be(e,t,r,n);j(s=>be(e,t(),s,n),r)}function Be(e,t,n){const r=t.trim().split(/\s+/);for(let s=0,l=r.length;s<l;s++)e.classList.toggle(r[s],n)}function Ot(e){let t=e.target;const n=`$$${e.type}`,r=e.target,s=e.currentTarget,l=a=>Object.defineProperty(e,"target",{configurable:!0,value:a}),o=()=>{const a=t[n];if(a&&!t.disabled){const f=t[`${n}Data`];if(f!==void 0?a.call(t,f,e):a.call(t,e),e.cancelBubble)return}return t.host&&typeof t.host!="string"&&!t.host._$host&&t.contains(e.target)&&l(t.host),!0},i=()=>{for(;o()&&(t=t._$host||t.parentNode||t.host););};if(Object.defineProperty(e,"currentTarget",{configurable:!0,get(){return t||document}}),e.composedPath){const a=e.composedPath();l(a[0]);for(let f=0;f<a.length-2&&(t=a[f],!!o());f++){if(t._$host){t=t._$host,i();break}if(t.parentNode===s)break}}else i();l(r)}function be(e,t,n,r,s){for(;typeof n=="function";)n=n();if(t===n)return n;const l=typeof t,o=r!==void 0;if(e=o&&n[0]&&n[0].parentNode||e,l==="string"||l==="number"){if(l==="number"&&(t=t.toString(),t===n))return n;if(o){let i=n[0];i&&i.nodeType===3?i.data!==t&&(i.data=t):i=document.createTextNode(t),n=z(e,n,r,i)}else n!==""&&typeof n=="string"?n=e.firstChild.data=t:n=e.textContent=t}else if(t==null||l==="boolean")n=z(e,n,r);else{if(l==="function")return j(()=>{let i=t();for(;typeof i=="function";)i=i();n=be(e,i,n,r)}),()=>n;if(Array.isArray(t)){const i=[],a=n&&Array.isArray(n);if(Te(i,t,n,s))return j(()=>n=be(e,i,n,r,!0)),()=>n;if(i.length===0){if(n=z(e,n,r),o)return n}else a?n.length===0?Fe(e,i,r):Lt(e,n,i):(n&&z(e),Fe(e,i));n=i}else if(t.nodeType){if(Array.isArray(n)){if(o)return n=z(e,n,r,t);z(e,n,null,t)}else n==null||n===""||!e.firstChild?e.appendChild(t):e.replaceChild(t,e.firstChild);n=t}}return n}function Te(e,t,n,r){let s=!1;for(let l=0,o=t.length;l<o;l++){let i=t[l],a=n&&n[e.length],f;if(!(i==null||i===!0||i===!1))if((f=typeof i)=="object"&&i.nodeType)e.push(i);else if(Array.isArray(i))s=Te(e,i,a)||s;else if(f==="function")if(r){for(;typeof i=="function";)i=i();s=Te(e,Array.isArray(i)?i:[i],Array.isArray(a)?a:[a])||s}else e.push(i),s=!0;else{const u=String(i);a&&a.nodeType===3&&a.data===u?e.push(a):e.push(document.createTextNode(u))}}return s}function Fe(e,t,n=null){for(let r=0,s=t.length;r<s;r++)e.insertBefore(t[r],n)}function z(e,t,n,r){if(n===void 0)return e.textContent="";const s=r||document.createTextNode("");if(t.length){let l=!1;for(let o=t.length-1;o>=0;o--){const i=t[o];if(s!==i){const a=i.parentNode===e;!l&&!o?a?e.replaceChild(s,i):e.insertBefore(s,n):a&&i.remove()}else l=!0}}else e.insertBefore(s,n);return[s]}const Me=Symbol("store-raw"),Z=Symbol("store-node"),V=Symbol("store-has"),lt=Symbol("store-self");function st(e){let t=e[G];if(!t&&(Object.defineProperty(e,G,{value:t=new Proxy(e,Dt)}),!Array.isArray(e))){const n=Object.keys(e),r=Object.getOwnPropertyDescriptors(e);for(let s=0,l=n.length;s<l;s++){const o=n[s];r[o].get&&Object.defineProperty(e,o,{enumerable:r[o].enumerable,get:r[o].get.bind(t)})}}return t}function pe(e){let t;return e!=null&&typeof e=="object"&&(e[G]||!(t=Object.getPrototypeOf(e))||t===Object.prototype||Array.isArray(e))}function J(e,t=new Set){let n,r,s,l;if(n=e!=null&&e[Me])return n;if(!pe(e)||t.has(e))return e;if(Array.isArray(e)){Object.isFrozen(e)?e=e.slice(0):t.add(e);for(let o=0,i=e.length;o<i;o++)s=e[o],(r=J(s,t))!==s&&(e[o]=r)}else{Object.isFrozen(e)?e=Object.assign({},e):t.add(e);const o=Object.keys(e),i=Object.getOwnPropertyDescriptors(e);for(let a=0,f=o.length;a<f;a++)l=o[a],!i[l].get&&(s=e[l],(r=J(s,t))!==s&&(e[l]=r))}return e}function me(e,t){let n=e[t];return n||Object.defineProperty(e,t,{value:n=Object.create(null)}),n}function oe(e,t,n){if(e[t])return e[t];const[r,s]=T(n,{equals:!1,internal:!0});return r.$=s,e[t]=r}function Pt(e,t){const n=Reflect.getOwnPropertyDescriptor(e,t);return!n||n.get||!n.configurable||t===G||t===Z||(delete n.value,delete n.writable,n.get=()=>e[G][t]),n}function ot(e){Ee()&&oe(me(e,Z),lt)()}function qt(e){return ot(e),Reflect.ownKeys(e)}const Dt={get(e,t,n){if(t===Me)return e;if(t===G)return n;if(t===Ce)return ot(e),n;const r=me(e,Z),s=r[t];let l=s?s():e[t];if(t===Z||t===V||t==="__proto__")return l;if(!s){const o=Object.getOwnPropertyDescriptor(e,t);Ee()&&(typeof l!="function"||e.hasOwnProperty(t))&&!(o&&o.get)&&(l=oe(r,t,l)())}return pe(l)?st(l):l},has(e,t){return t===Me||t===G||t===Ce||t===Z||t===V||t==="__proto__"?!0:(Ee()&&oe(me(e,V),t)(),t in e)},set(){return!0},deleteProperty(){return!0},ownKeys:qt,getOwnPropertyDescriptor:Pt};function ve(e,t,n,r=!1){if(!r&&e[t]===n)return;const s=e[t],l=e.length;n===void 0?(delete e[t],e[V]&&e[V][t]&&s!==void 0&&e[V][t].$()):(e[t]=n,e[V]&&e[V][t]&&s===void 0&&e[V][t].$());let o=me(e,Z),i;if((i=oe(o,t,s))&&i.$(()=>n),Array.isArray(e)&&e.length!==l){for(let a=e.length;a<l;a++)(i=o[a])&&i.$();(i=oe(o,"length",l))&&i.$(e.length)}(i=o[lt])&&i.$()}function it(e,t){const n=Object.keys(t);for(let r=0;r<n.length;r+=1){const s=n[r];ve(e,s,t[s])}}function jt(e,t){if(typeof t=="function"&&(t=t(e)),t=J(t),Array.isArray(t)){if(e===t)return;let n=0,r=t.length;for(;n<r;n++){const s=t[n];e[n]!==s&&ve(e,n,s)}ve(e,"length",r)}else it(e,t)}function re(e,t,n=[]){let r,s=e;if(t.length>1){r=t.shift();const o=typeof r,i=Array.isArray(e);if(Array.isArray(r)){for(let a=0;a<r.length;a++)re(e,[r[a]].concat(t),n);return}else if(i&&o==="function"){for(let a=0;a<e.length;a++)r(e[a],a)&&re(e,[a].concat(t),n);return}else if(i&&o==="object"){const{from:a=0,to:f=e.length-1,by:u=1}=r;for(let c=a;c<=f;c+=u)re(e,[c].concat(t),n);return}else if(t.length>1){re(e[r],t,[r].concat(n));return}s=e[r],n=[r].concat(n)}let l=t[0];typeof l=="function"&&(l=l(s,n),l===s)||r===void 0&&l==null||(l=J(l),r===void 0||pe(s)&&pe(l)&&!Array.isArray(l)?it(s,l):ve(e,r,l))}function Ie(...[e,t]){const n=J(e||{}),r=Array.isArray(n),s=st(n);function l(...o){_t(()=>{r&&o.length===1?jt(n,o[0]):re(n,o)})}return[s,l]}const Nt=80,Rt=5,at=1.7,ct=20,Q=1,Oe=100,ut=500,ft=new Array(495).fill(1).map((e,t)=>Math.floor(Nt*Math.pow(t+1,at))),we=new Array(500).fill(1).map((e,t)=>Math.floor(Rt*Math.pow(t+1,at))),dt=(e,t=ft)=>{if(!e)return 0;const n=t.findIndex(l=>l>e);if(n<0&&e>0)return 1;const r=e-(t[n-1]??0),s=t[n]-(t[n-1]??0);return r/s},Se=(e,t=ft)=>{const n=t.findIndex(r=>r>e);return n<0&&e>0?t.length:n};var Ht=m('<div class="flex w-full absolute h-full items-center bg-main justify-center text-white text-xl top-0 left-0">Catching up...');const ke=Xe(),H=new Event("tick"),Bt=e=>{const[t,n]=T(0),[r,s]=T(!0),l=new EventTarget;ie(()=>{setInterval(()=>{r()||(n(t()+1),l==null||l.dispatchEvent(H))},Oe)}),document.addEventListener("visibilitychange",()=>{document.hidden?(s(!0),window.localStorage.setItem("freeze_time",`${Date.now()}`)):o()});const o=()=>{s(!0);const a=parseInt(window.localStorage.getItem("freeze_time")??`${Date.now()}`),f=Date.now()-a;let u=Math.floor(f/Oe);for(;u>=0;)n(t()+1),l==null||l.dispatchEvent(H),u--;s(!1)};window.addEventListener("load",()=>setTimeout(o,500)),window.addEventListener("beforeunload",()=>{window.localStorage.setItem("freeze_time",`${Date.now()}`)});const i=()=>l==null?void 0:l.dispatchEvent(H);return h(ke.Provider,{value:{evt:l,fire:i},get children(){return[ne(()=>e.children),h(N,{get when(){return r()},get children(){return Ht()}})]}})},Ft=[{name:"hay_hand_1",label:"Hay hand wraps",stackable:!1,equipSlot:"hand",craftComplexity:1,craftType:"basic",craftLevel:1,ingredients:[["hay_1",25]],stats:{attMin:1,attMax:3}},{name:"hay_head_1",label:"Hay bandana",stackable:!1,equipSlot:"head",craftComplexity:1,craftType:"basic",craftLevel:1,ingredients:[["hay_1",25]],stats:{maxHealth:5}},{name:"hay_chest_1",label:"Hay vest",stackable:!1,equipSlot:"chest",craftComplexity:1,craftType:"basic",craftLevel:1,ingredients:[["hay_1",50]],stats:{physRes:1}},{name:"utility_axe_1",label:"Rusty axe",stackable:!1,equipSlot:"weapon",utilityType:"axe",stats:{}}],Vt=[{name:"recipe_hay_hand_1",label:"Recipe: Hay hand wraps",stackable:!1,exclusive:!0,craftableItem:"hay_hand_1"},{name:"recipe_hay_head_1",label:"Recipe: Hay bandana",stackable:!1,exclusive:!0,craftableItem:"hay_head_1"},{name:"recipe_hay_chest_1",label:"Recipe: Hay vest",stackable:!1,exclusive:!0,craftableItem:"hay_chest_1"}].map(e=>({...e,use:t=>(t.onTask({noRepeat:!0,label:"Learning",description:e.label,duration:100,onComplete:()=>(t.player.recipes.includes(e.craftableItem)||(t.setPlayer("recipes",[...t.player.recipes,e.craftableItem]),t.setState("prohibitedItems",[...t.state.prohibitedItems,e.name])),t.removeInventory(e.name),t.onNavigate("_back"),!0)}),!1)})),Ut=[{name:"hay_1",label:"Hay",stackable:!0,maxStack:100},{name:"wood_log_1",label:"Wooden log",stackable:!0,maxStack:100}],U=[Ft,Vt,Ut].flat().reduce((e,t)=>(e[t.name]=t,e),{});var Wt=m('<div class="font-bold m-2">'),Kt=m("<div>");const Pe=e=>(()=>{var t=Wt();return y(t,h(K,{get each(){return e.lines},children:(n,r)=>(()=>{var s=Kt();return y(s,h(N,{get when(){return r()===0},children:'" .. '}),null),y(s,n,null),y(s,h(N,{get when(){return r()===e.lines.length-1},children:' .. "'}),null),s})()})),t})();var Yt=m("<span class=text-red-500>Fight scarecrows"),Xt=m('<span class="font-bold ml-1">'),Gt=m('<span class="font-bold text-blue-500 mr-1">Hay'),Jt=m("<span class=font-bold>");const zt=[{name:"story_town_1",label:"Town",description:"You are in town",type:"dialogue",options:[{label:"Visit Farm",goto:"story_farmer_1"},{label:"Leave the town",goto:"story_forest_1"},{label:"Merchants",goto:"story_town_merchants_1"},{label:"Home",goto:"story_home_1"}]},{name:"story_farmer_1",label:"Farm",description:"A vacant expressionless farmer. Hasn't washed in days.",type:"dialogue",options:[{label:"Approach the farmer",goto:"story_farmer_2"},{label:Yt(),goto:"story_scarecrows_1"},{label:"Sell Hay",action:e=>{const t=e.player.invent,{removeInventory:n,onAddStat:r}=e,s=t.filter(l=>(l==null?void 0:l.name)==="hay_1").reduce((l,o)=>l+((o==null?void 0:o.stack)??0),0);s&&(n("hay_1",s),r("gold",s),e.onLog(["You sell",(()=>{var l=Xt();return y(l,s),l})()," ",Gt(),"For ",(()=>{var l=Jt();return y(l,s),l})()," gold"],"meta"))}}]},{name:"story_farmer_2",label:"Farmer",description:["You approach, he holds your wrist loosely like an exhausted child.",h(Pe,{lines:["Loathsome shadowed cloaks","Golden light shimmering, blind eyes","Fear, is Death knocking?"]}),"He sits and cries."],type:"dialogue",options:[{label:"Console",goto:"story_farmer_3"},{label:"Leave",goto:"_back"}]},{name:"story_farmer_3",label:"Farmer",description:h(Pe,{lines:["Am *I* the keeper of the wheat?","... or is it the keeper of me?"]}),type:"dialogue",options:[{label:"Silently leave",goto:"_back.2"}]},{name:"story_scarecrows_1",label:"Scarecrows",description:"Fighting scarecrows",type:"encounter",cooldown:20,encounters:[{name:"enc_scarecrow_1",label:"Scarecrow",health:10,chance:1,experience:50,drops:[{name:"hay_1",chance:1},{name:"recipe_hay_hand_1",chance:.05},{name:"recipe_hay_head_1",chance:.05},{name:"recipe_hay_chest_1",chance:.05}]}]}],Qt=[{type:"craft",name:"bench_simple",label:"Simple crafting bench",cratingType:"basic",craftingComplexity:1}],Zt=Qt.reduce((e,t)=>(e[t.name]=t,e),{}),en=[{name:"story_home_1",label:"Home",description:"Home sweet home",type:"dialogue",options:[{label:"Build",goto:"story_home_2"},{label:"Stash",goto:"story_home_3"},{label:"Craft",goto:"story_home_4"}]},{name:"story_home_4",label:"Crafting",description:"A workshop",type:"dialogue",options:e=>e.state.furniture.map(t=>Zt[t]).filter(t=>t.type==="craft").map(t=>({label:t.label,goto:`story_craft_${t.cratingType}_1`}))},{name:"story_craft_basic_1",label:"Basic crafting",description:"A very simple crafting table",type:"dialogue",options:e=>e.player.recipes.map(t=>U[t]).filter(t=>t.craftType==="basic").map(t=>{var n;return{label:t.label,action:r=>tn(r,t),isDisabled:!nn(e,t),subtext:(n=t.ingredients)==null?void 0:n.map(r=>`${U[r[0]].label} (${r[1]})`).join(" - ")}})}],tn=(e,t)=>{var n;e.addInventory(t),(n=t.ingredients)==null||n.forEach(r=>e.removeInventory(...r))},nn=(e,t)=>{var n;return(n=t.ingredients)!=null&&n.length?t.ingredients.every(r=>e.player.invent.reduce((l,o)=>((o==null?void 0:o.name)===r[0]&&(l=l+(o.stack??1)),l),0)>=r[1]):!0},rn=[{type:"dialogue",name:"story_forest_1",label:"Forest border",description:"The canopy casts a shadow. Sounds, eyes ... movement",options:e=>[{label:"Chop wood",goto:"task_chop_wood_1",isDisabled:!!!e.player.equipment.find(n=>n.equipSlot==="weapon"&&n.utilityType==="axe")}]},{type:"task",name:"task_chop_wood_1",label:"Surrounded by trees",description:"Chopping wood",duration:100,masteryType:"woodcutting",cooldown:10,experience:1,utilityType:"axe",items:[{name:"wood_log_1",chance:1}]}],ln=[{name:"utility_axe_1",cost:100}],sn=[{type:"dialogue",name:"story_town_merchants_1",label:"Town Bazaar",description:"Souks, stalls, spices, hands... hands... hands...",options:[{label:"Tool merchant",goto:"story_town_merchant_tool_1"}]},{type:"dialogue",name:"story_town_merchant_tool_1",label:"Tool Merchant",description:["A burly man, skin of leather ",h(Pe,{lines:["The very finest tools"]})],options:e=>{const t=e.player.stats.gold;return ln.map(n=>{const r=U[n.name];return{label:(r==null?void 0:r.label)??"UNKNOWN",action:s=>{s.addInventory(r),s.onAddStat("gold",0-n.cost),s.onNavigate("story_town_merchant_tool_1")},isDisabled:n.cost>t}})}}],qe=[zt,en,rn,sn].flat().reduce((e,t)=>(e[t.name]=t,e),{}),on=[{name:"unarmed",label:"Unarmed",bonus:new Array(ut+1).fill(null).map((e,t)=>{if(!(!t||t%5!==0))return{level:t,stats:{attMin:t%10===0?1:0,attMax:1,attSpeed:t%50===0?.1:0}}}).filter(Boolean)}],an=[{name:"woodcutting",label:"Woodcutting",bonus:new Array(ut+1).fill(null).map((e,t)=>{if(!(!t||t%5!==0))return{level:t,stats:{durationModifier:t%10===0?10:0},dropModifiers:[{name:"wood_log_1",chance:t%50===0?1:0}]}}).filter(Boolean)}],je=[on,an].flat().reduce((e,t)=>(e[t.name]=t,e),{}),ht=(e,t)=>{const n=je[e];if(!n)return{};const r=Se(t,we),s=n.bonus.filter(l=>l.level<=r);return(s==null?void 0:s.reduce((l,o)=>(Object.entries(o.stats).forEach(([i,a])=>{l[i]=(l[i]??0)+a}),l),{}))??{}},cn=(e,t,n)=>{const r=je[t];if(!r)return 0;const s=Se(n,we),l=r.bonus.filter(o=>o.level<=s);return l==null?void 0:l.reduce((o,i)=>{var a,f;return o+(((f=(a=i.dropModifiers)==null?void 0:a.find(u=>u.name===e))==null?void 0:f.chance)??0)},0)};class gt{constructor(t){E(this,"name");E(this,"label");E(this,"description");E(this,"type");E(this,"encounters");E(this,"duration");E(this,"noRepeat");E(this,"cooldown");E(this,"items");E(this,"skills");E(this,"options");E(this,"onComplete");E(this,"masteryType");E(this,"experience");E(this,"utilityType");this.label=t.label,this.type=t.type,this.name=t.name,this.description=t.description,Object.assign(this,t)}getEncounter(){var n;if(this.type==="task")return{name:"task",label:this.label,health:this.duration??0,chance:1,drops:this.items};const t=Math.random();if(!(this.type!=="encounter"||!((n=this.encounters)!=null&&n.length)))return this.encounters.sort((r,s)=>r.chance-s.chance).find(r=>t<=r.chance)}getDrops(t){return this.getItems(t==null?void 0:t.drops)}getItems(t=this.items??[],n,r){let s=[];for(let l of t){let o=l.chance;for(n&&r&&(o=o+cn(l.name,n,r));o>0;)Math.random()<=o&&s.push(l),o--}return s==null?void 0:s.map(l=>U[l.name]).filter(Boolean)}}class un{constructor(t={},n=new Array(ct).fill(null)){E(this,"equipment");E(this,"stats");E(this,"mastery");E(this,"invent");E(this,"recipes");this.equipment=t.equipment??[],this.mastery=t.mastery??{},this.recipes=t.recipes??[],this.stats=t.stats??{gold:120,experience:0,health:10,maxHealth:10,strength:1,agility:1,attSpeed:0},this.invent=n}weaponMastery(){var t;return((t=this.equipment.find(n=>n.equipSlot==="weapon"))==null?void 0:t.masteryType)??"unarmed"}getMasteryPerk(t){return ht(t,this.mastery[t]??0)}attackDamage(){let t=this.equipment.reduce((a,f)=>{var u;return a+(((u=f.stats)==null?void 0:u.attMin)??0)},1),n=this.equipment.reduce((a,f)=>{var u;return a+(((u=f.stats)==null?void 0:u.attMax)??0)},1);const r=this.weaponMastery(),s=this.getMasteryPerk(r);t+=(s==null?void 0:s.attMin)??0,n+=(s==null?void 0:s.attMax)??0;const l=1+Math.pow((this.stats.strength??0)/100,.7),o=Math.round(t*l),i=Math.round(n*l);return[o,i]}attackRate(){const n=Math.min(100,Math.max(1,this.stats.agility??0)),r=1,s=Q/5,l=Math.sqrt(n/100),o=s*l,i=Q/5,a=Math.min(this.equipment.reduce((M,S)=>{var x;return M+(((x=S.stats)==null?void 0:x.attSpeed)??0)},0),1),f=a*i,u=Q/5,c=this.weaponMastery(),p=this.getMasteryPerk(c),w=(p.attSpeed??0)*u,_=(Q/2.5-1)*((l+a+(p.attSpeed??0))/3);return Math.max(Q-o-f-_-w,r)}}class fn{constructor(t){E(this,"prohibitedItems");E(this,"furniture");this.prohibitedItems=[],this.furniture=[],Object.assign(this,t)}}const le="story_town_1",F=Xe(),xe=e=>new gt(qe[e]??qe[le]),dn=e=>{const[t,n]=T(xe(le)),[r,s]=Ie(new un({})),[l,o]=Ie(new fn({furniture:["bench_simple"]})),[i,a]=T([le]),[f,u]=T([]);ie(()=>{const g=JSON.parse(window.localStorage.getItem("save")??"null");g&&(s(g.player),o(g.state),a(g.nav),n(xe(g.story)))});const c=()=>{window.localStorage.setItem("save",JSON.stringify({player:J(r),story:t().name,state:J(l),nav:i()}))};window.addEventListener("beforeunload",c),setInterval(c,1e4);const p=(g,k=1)=>{if(typeof g=="string"){if(!U[g])return console.warn("Invalid or not found item",g),k;g=U[g]}let v=[...r.invent];if(g.exclusive&&v.find(b=>(b==null?void 0:b.name)===g.name))return 0;let $=k;return g.stackable&&g.maxStack&&(v=v.map(b=>{if(!(b!=null&&b.name)||!(b!=null&&b.stack)||!b.maxStack||!$)return b;if(b.name===g.name&&b.stack<b.maxStack){let X=Math.min(b.stack+$,b.maxStack);return $-=X-b.stack,{...b,stack:X}}return b})),$&&(v=v.map(b=>{if(!$)return b;if(b===null){const X=Math.min($,g.maxStack??1);return $-=X,{...g,stack:X}}return b})),$<k&&s("invent",v),k-$},w=(g,k=1)=>{if(typeof g=="string"){if(!U[g])return console.warn("Invalid or not found item",g),!1;g=U[g]}if(r.invent.findLastIndex(b=>(b==null?void 0:b.name)===g.name)<0)return!1;const $=[...r.invent.toReversed().map(b=>{if(!k||(b==null?void 0:b.name)!==g.name||!(b!=null&&b.stack))return b;if(b.stack<=k)return k-=b.stack,null;const X=b.stack-k;return k=0,{...b,stack:X}}).reverse()].filter(Boolean);return $.push(...new Array(ct-$.length).fill(null)),s("invent",$),!0},d=g=>{const k=/^_back/.test(g);if(!k&&!qe[g]){console.error(`Unknown story ${g}`);return}if(k){const[v,$]=g.split("."),b=Math.min(parseInt($??"1"),i().length+1);g=i().at(-1-b)??le,i().length>1&&a(i().slice(0,-b))}else i().at(-1)!==g&&a([...i(),g]);n(xe(g))},_=(g,k=1)=>{const v=(r.stats[g]??0)+k;s("stats",g,v)},D={story:t,onNavigate:d,onAddStat:_,player:r,state:l,setState:o,setPlayer:s,addInventory:p,removeInventory:w,log:f,onLog:(g,k="basic")=>{var b;const v=new Date,$={msg:g,time:[v.getHours(),v.getMinutes(),v.getSeconds()].join(":"),type:k};u([...f().slice(Math.min(((b=f())==null?void 0:b.length)-999,0)),$])},onAddMastery:(g,k=1)=>{const v=(r.mastery[g]??0)+k;s("mastery",g,v)},onEquip:g=>{if(w(g)){let k=!1;return s("equipment",[...r.equipment.map(v=>v.equipSlot===g.equipSlot?(k=!0,Object.entries(v.stats??{}).forEach(([$,b])=>_($,0-b)),p(v),g):v),...k?[]:[g]]),Object.entries(g.stats??{}).forEach(([v,$])=>_(v,$)),!0}return!1},onUnequip:g=>!!r.equipment.find(v=>v.name===g.name)&&p(g)?(s("equipment",[...r.equipment.filter(v=>v.name!==g.name)]),Object.entries(g.stats??{}).forEach(([v,$])=>_(v,0-$)),!0):!1,onTask:g=>{a([...i(),"task"]),n(new gt({name:"task",type:"task",...g,onComplete:g.noRepeat?g.onComplete??(()=>d("_back")):void 0}))}};return h(F.Provider,{value:D,get children(){return e.children}})};var hn=m('<div class="flex flex-row mt-auto gap-2"><div class="w-full border content-center cursor-pointer h-12 text-lg font-bold mt-auto">Go back</div><div class="w-full border content-center cursor-pointer h-12 text-lg font-bold mt-auto">Town'),gn=m('<div class="flex flex-col gap-5 p-2 h-full overflow-y-auto">'),yn=m("<div class=text-gray-500>Nothing here..."),bn=m('<span class="text-xs text-gray-400">'),pn=m('<div class="w-full border content-center h-12 text-lg font-bold flex flex-col justify-center">');const mn=()=>{const e=R(F),t=r=>{if(r.goto)return e==null?void 0:e.onNavigate(r.goto);if(r.action&&e)return r.action(e)},n=O(()=>{const r=e==null?void 0:e.story().options;return Array.isArray(r)?r:(r==null?void 0:r(e))??[]});return(()=>{var r=gn();return y(r,h(N,{get when(){return n().length},get fallback(){return yn()},get children(){return h(K,{get each(){return n()},children:s=>(()=>{var l=pn();return l.$$click=()=>!s.isDisabled&&t(s),y(l,()=>s.label,null),y(l,h(N,{get when(){return s.subtext},get children(){var o=bn();return y(o,()=>s.subtext),o}}),null),j(o=>{var i=!!s.isDisabled,a=!s.isDisabled;return i!==o.e&&l.classList.toggle("text-gray-500",o.e=i),a!==o.t&&l.classList.toggle("cursor-pointer",o.t=a),o},{e:void 0,t:void 0}),l})()})}}),null),y(r,h(N,{get when(){var s;return((s=e==null?void 0:e.story())==null?void 0:s.name)!==le},get children(){var s=hn(),l=s.firstChild,o=l.nextSibling;return l.$$click=()=>t({label:"Go back",goto:"_back"}),o.$$click=()=>t({label:"Back to town",goto:"story_town_1"}),s}}),null),r})()};ue(["click"]);var vn=m("<button>use"),wn=m("<button>equip"),_n=m('<div class="absolute bottom-0 left-0 w-full border-t content-center p-2"><div class="flex flex-col gap-2"><div> </div><div class="flex flex-row gap-1 justify-between"><button>drop</button><button>drop all'),$n=m('<div class="h-full relative"><div class="flex flex-col gap-2 h-7/8 overflow-auto p-2">'),Sn=m('<div class="border p-1 cursor-pointer flex flex-row justify-between"><div></div><div>(<!>)');const kn=()=>{const e=R(F),[t,n]=T(),r=()=>{var o;const l=t();!l||!e||(o=l.use)!=null&&o.call(l,e)&&n(void 0)},s=()=>{const l=t();!l.equipSlot||!e||e.onEquip(l)&&n(void 0)};return(()=>{var l=$n(),o=l.firstChild;return o.$$click=()=>n(void 0),y(o,h(K,{get each(){return(e==null?void 0:e.player.invent)??[]},children:i=>h(An,{item:i,onSelect:()=>n(i)})})),y(l,h(N,{get when(){return t()},get children(){var i=_n(),a=i.firstChild,f=a.firstChild,u=f.firstChild,c=f.nextSibling,p=c.firstChild,w=p.nextSibling;return y(f,()=>{var d;return(d=t())==null?void 0:d.label},u),y(f,()=>{var d;return(d=t())==null?void 0:d.equipSlot},null),p.$$click=()=>e==null?void 0:e.removeInventory(t()),w.$$click=()=>e==null?void 0:e.removeInventory(t(),1/0),y(c,h(N,{get when(){var d;return(d=t())==null?void 0:d.use},get children(){var d=vn();return d.$$click=r,d}}),null),y(c,h(N,{get when(){return t().equipSlot},get children(){var d=wn();return d.$$click=s,d}}),null),i}}),null),l})()},An=e=>{const t=n=>{n.stopPropagation(),e.onSelect()};return h(N,{get when(){return e.item},get children(){var n=Sn(),r=n.firstChild,s=r.nextSibling,l=s.firstChild,o=l.nextSibling;return o.nextSibling,n.$$click=t,y(r,()=>{var i;return(i=e.item)==null?void 0:i.label}),y(s,()=>{var i;return(i=e.item)==null?void 0:i.stack},o),n}})};ue(["click"]);var xn=m('<div class="w-full h-full border rounded relative text-black bg-gray-500"><div class="ease-linear w-0 h-full rounded"></div><div class="absolute left-1/2 top-1/2 -translate-1/2 whitespace-nowrap">');const yt=e=>{const t=R(ke),[n,r]=T(e.ticks),s=()=>{let l=n();l<=0&&(e.onFinish(),l=e.ticks+1),r(l-1)};return ie(()=>t==null?void 0:t.evt.addEventListener(H.type,s)),$e(()=>t==null?void 0:t.evt.removeEventListener(H.type,s)),h(Ne,{get max(){return e.ticks},get value(){return e.ticks-n()},get type(){return e.type},get showPc(){return e.showPc},get showNumber(){return e.showNumber},get label(){return e.label}})},Ne=e=>{const t=O(()=>Math.min(e.value/e.max*100,100));return(()=>{var n=xn(),r=n.firstChild,s=r.nextSibling;return y(s,h(ce,{get children(){return[h(q,{get when(){return e.showPc},get children(){return[ne(()=>e.label)," (",ne(()=>t().toFixed(0)),"%)"]}}),h(q,{get when(){return e.showNumber},get children(){return[ne(()=>e.label)," ",ne(()=>e.value)]}})]}})),j(l=>{var o=t()+"%",i=!e.type,a=e.type==="green",f=e.type==="yellow",u=e.type==="blue",c=e.type==="red";return o!==l.e&&Mt(r,"width",l.e=o),i!==l.t&&r.classList.toggle("bg-white",l.t=i),a!==l.a&&r.classList.toggle("bg-green-500",l.a=a),f!==l.o&&r.classList.toggle("bg-yellow-500",l.o=f),u!==l.i&&r.classList.toggle("bg-blue-500",l.i=u),c!==l.n&&r.classList.toggle("bg-red-500",l.n=c),l},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),n})()};var Cn=m('<div class="flex flex-col h-full"><div class="h-7/8 p-2"></div><div class="h-1/8 flex flex-row justify-between gap-2 p-2"><button>Skills</button><button>Mastery</button><button>Recipes'),En=m('<div class="flex flex-row justify-between items-center"><div></div><div class="h-4 w-32">'),Ln=m('<div class="flex flex-row justify-between items-center"><div>');const Ve=()=>{const[e,t]=T("mastery"),n=R(F),r=O(()=>Object.entries((n==null?void 0:n.player.mastery)??{}).map(([l,o])=>{const i=je[l];return{label:i==null?void 0:i.label,progress:dt(o,we)*100,level:Se(o,we)}})),s=O(()=>(n==null?void 0:n.player.recipes.map(l=>U[l]))??[]);return(()=>{var l=Cn(),o=l.firstChild,i=o.nextSibling,a=i.firstChild,f=a.nextSibling,u=f.nextSibling;return y(o,h(ce,{get children(){return[h(q,{get when(){return e()==="skills"},children:"TODO"}),h(q,{get when(){return e()==="mastery"},get children(){return h(K,{get each(){return r()},children:c=>(()=>{var p=En(),w=p.firstChild,d=w.nextSibling;return y(w,()=>c.label),y(d,h(Ne,{get label(){return`${c.level}`},type:"yellow",max:100,get value(){return c.progress},showPc:!0})),p})()})}}),h(q,{get when(){return e()==="recipes"},get children(){return h(K,{get each(){return s()},children:c=>(()=>{var p=Ln(),w=p.firstChild;return y(w,()=>c.label),p})()})}})]}})),a.$$click=()=>t("skills"),f.$$click=()=>t("mastery"),u.$$click=()=>t("recipes"),j(c=>{var p=e()==="skills",w=e()==="mastery",d=e()==="recipes";return p!==c.e&&a.classList.toggle("selected",c.e=p),w!==c.t&&f.classList.toggle("selected",c.t=w),d!==c.a&&u.classList.toggle("selected",c.a=d),c},{e:void 0,t:void 0,a:void 0}),l})()};ue(["click"]);var Tn=m('<span class="text-red-800 font-bold">'),Mn=m('<span class="text-green-800 font-bold">'),In=m('<span class="text-red-800 font-bold m-1">'),On=m('<span class="font-bold m-1">'),Pn=m("<div class=text-red-800>"),Ue=m("<div class=h-8>"),qn=m('<div class="flex flex-col gap-1 p-1 h-full"><div class=bg-black>Attacking (<!>)');const Dn=()=>{const e=R(F),t=R(ke),[n,r]=T(25),[s,l]=T(0),[o,i]=T(0),[a,f]=T(),[u,c]=T();ie(()=>{var d;r((e==null?void 0:e.player.attackRate())??25),c(e==null?void 0:e.story().getEncounter()),f((d=u())==null?void 0:d.health)});const p=()=>{var g,k;const[d,_]=[e==null?void 0:e.player,e==null?void 0:e.story()],A=u(),M=a();if(!d||!_)return;if(r((e==null?void 0:e.player.attackRate())??25),!A){c(e==null?void 0:e.story().getEncounter()),f((g=u())==null?void 0:g.health);return}if(!M)return;const[S,x]=(e==null?void 0:e.player.attackDamage())??[0,1],I=S+Math.round(Math.random()*(x-S)),D=M-Math.min(I,M);if(e==null||e.onLog(["You hit the ",(()=>{var v=Tn();return y(v,A.label),v})()," for ",(()=>{var v=Mn();return y(v,I),v})()," damage"],"basic"),e==null||e.onAddMastery(e.player.weaponMastery(),I),D<=0){e==null||e.onLog(["You killed the",(()=>{var $=In();return y($,A.label),$})()],"good"),i(o()+1),c(void 0),A.experience&&(e==null||e.onAddStat("experience",A.experience));const v=(k=_.getDrops(A))==null?void 0:k.filter($=>!(e!=null&&e.state.prohibitedItems.includes($.name))).filter($=>!!(e!=null&&e.addInventory($)));if(v!=null&&v.length&&(e==null||e.onLog(["It dropped:",(()=>{var $=On();return y($,v==null?void 0:v.map(b=>b.label).join(", ")),$})()],"drop")),_.noRepeat)return;l(_.cooldown??0),t==null||t.evt.addEventListener(H.type,w)}f(Math.max(D,0))},w=()=>{if(s()<=0)return t==null||t.evt.removeEventListener(H.type,w),p();l(s()-1)};return $e(()=>{t==null||t.evt.removeEventListener(H.type,w)}),(()=>{var d=qn(),_=d.firstChild,A=_.firstChild,M=A.nextSibling;return M.nextSibling,y(_,o,M),y(d,h(N,{get when(){return u()},fallback:"Waiting.. Searching.. Wondering..",get children(){return[(()=>{var S=Pn();return y(S,()=>{var x;return(x=u())==null?void 0:x.label}),S})(),(()=>{var S=Ue();return y(S,h(yt,{get ticks(){return n()},onFinish:p,label:"Attack",showPc:!0})),S})(),(()=>{var S=Ue();return y(S,h(Ne,{type:"red",get max(){return u().health},get value(){return a()},label:"Health",showNumber:!0})),S})()]}}),null),d})()};var jn=m('<span class="text-red-800 font-bold m-1">'),Nn=m('<span class="font-bold m-1">'),Rn=m("<div class=text-red-800>"),Hn=m("<div class=h-8>"),Bn=m('<div class="flex flex-col gap-1 p-1 h-full"><div class=bg-black>');const Fn=()=>{const e=R(F),t=R(ke),[n,r]=T(!1),[s,l]=T(0),o=O(()=>{const f=e==null?void 0:e.story().masteryType;if(f){const u=ht(f,e.player.mastery[f]??0);return Math.max(1,((e==null?void 0:e.story().duration)??100)-(u.durationModifier??0))}return(e==null?void 0:e.story().duration)??100});Ye(()=>{const[f,u]=[e==null?void 0:e.player,e==null?void 0:e.story()];!f||!u||u.utilityType&&(f.equipment.find(c=>c.utilityType===u.utilityType)||e==null||e.onNavigate("_back"))}),ie(()=>{r(!0)});const i=()=>{var p,w;const[f,u]=[e==null?void 0:e.player,e==null?void 0:e.story()];if(!f||!u)return;if(!n()){r(!0);return}r(!1),e==null||e.onLog(["You finished",(()=>{var d=jn();return y(d,u.description),d})()],"good"),u.masteryType&&(e==null||e.onAddMastery(u.masteryType,u.experience??0));const c=(p=u.getItems(void 0,u.masteryType,u.masteryType?f.mastery[u.masteryType]:void 0))==null?void 0:p.filter(d=>!(e!=null&&e.state.prohibitedItems.includes(d.name))).filter(d=>!!(e!=null&&e.addInventory(d)));if(c!=null&&c.length&&(e==null||e.onLog(["You gained:",(()=>{var d=Nn();return y(d,c==null?void 0:c.map(_=>_.label).join(", ")),d})()],"drop")),u.noRepeat)return((w=u.onComplete)==null?void 0:w.call(u))??(e==null?void 0:e.onNavigate("_back"));l(u.cooldown??0),t==null||t.evt.addEventListener(H.type,a)},a=()=>{if(s()<=0)return t==null||t.evt.removeEventListener(H.type,a),i();l(s()-1)};return $e(()=>{t==null||t.evt.removeEventListener(H.type,a)}),(()=>{var f=Bn(),u=f.firstChild;return y(u,()=>e==null?void 0:e.story().label),y(f,h(N,{get when(){return n()},fallback:"Waiting.. Searching.. Wondering..",get children(){return[(()=>{var c=Rn();return y(c,()=>e==null?void 0:e.story().description),c})(),(()=>{var c=Hn();return y(c,h(yt,{get ticks(){return o()},onFinish:i,label:"Task",showPc:!0})),c})()]}}),null),f})()};var Vn=m('<div class="text-lg font-bold mt-5">Weapon'),Un=m('<div class="text-lg font-bold mt-5">Armour'),Wn=m('<div class="flex flex-col h-full"><div class="h-7/8 p-2"></div><div class="h-1/8 flex flex-row justify-between gap-2 p-2"><button>Equip</button><button>Stats'),Kn=m('<div class="flex flex-row justify-between border-gray-700"><div></div><div>'),Yn=m('<div class="flex flex-row justify-between items-center border-gray-700"><div></div><div class="text-xs text-gray-500">');const Xn=()=>{const[e,t]=T("stats"),n=R(F),r=O(()=>{const l=n==null?void 0:n.player.attackDamage(),o=1e3/Oe,i=1/(((n==null?void 0:n.player.attackRate())??Q)/o);return[{label:"Health",value:(n==null?void 0:n.player.stats.health)??0},{label:"Max health",value:(n==null?void 0:n.player.stats.maxHealth)??0},{label:"",value:" "},{label:"Att. min",value:(l==null?void 0:l.at(0))??0},{label:"Att. max",value:(l==null?void 0:l.at(1))??0},{label:"Att. rate",value:`${(i==null?void 0:i.toFixed(2))??0} p/s`},{label:"",value:" "},{label:"Phys. res",value:(n==null?void 0:n.player.stats.physRes)??0},{label:"Mag. res",value:(n==null?void 0:n.player.stats.magRes)??0}]}),s=O(()=>{const l=["weapon","offhand"],o=["head","shoulder","chest","hand","leg","foot"];return[{label:Vn(),isDisabled:!1,isEmpty:!0},...l.map(i=>{const a=i&&(n==null?void 0:n.player.equipment.find(f=>f.equipSlot===i));return{label:(a==null?void 0:a.label)??i,isDisabled:!a,subtext:Object.entries((a==null?void 0:a.stats)??{}).map(([f,u])=>`[${f}: ${u}]`).join(""),onClick:a?()=>n==null?void 0:n.onUnequip(a):void 0}}),{label:Un(),isDisabled:!1,isEmpty:!0},...o.map(i=>{const a=i&&(n==null?void 0:n.player.equipment.find(f=>f.equipSlot===i));return{label:(a==null?void 0:a.label)??i,isDisabled:!a,subtext:Object.entries((a==null?void 0:a.stats)??{}).map(([f,u])=>`[${f}: ${u}]`).join(""),onClick:a?()=>n==null?void 0:n.onUnequip(a):void 0}})]});return(()=>{var l=Wn(),o=l.firstChild,i=o.nextSibling,a=i.firstChild,f=a.nextSibling;return y(o,h(ce,{get children(){return[h(q,{get when(){return e()==="stats"},get children(){return h(K,{get each(){return r()},children:u=>(()=>{var c=Kn(),p=c.firstChild,w=p.nextSibling;return y(p,()=>u.label),y(w,()=>u.value),j(()=>c.classList.toggle("border-b",!!u.label)),c})()})}}),h(q,{get when(){return e()==="equip"},get children(){return h(K,{get each(){return s()},children:u=>(()=>{var c=Yn(),p=c.firstChild,w=p.nextSibling;return nt(c,"click",u.onClick),y(p,()=>u.label),y(w,()=>u.subtext),j(d=>{var _=!u.isEmpty,A=!!u.isDisabled;return _!==d.e&&c.classList.toggle("border-b",d.e=_),A!==d.t&&p.classList.toggle("text-gray-700",d.t=A),d},{e:void 0,t:void 0}),c})()})}})]}})),a.$$click=()=>t("equip"),f.$$click=()=>t("stats"),j(u=>{var c=e()==="equip",p=e()==="stats";return c!==u.e&&a.classList.toggle("selected",u.e=c),p!==u.t&&f.classList.toggle("selected",u.t=p),u},{e:void 0,t:void 0}),l})()};ue(["click"]);var Gn=m('<div class="w-dvw h-dvh lg:w-[360px] lg:h-[800px] flex flex-col justify-between"><div class="h-3/10 bg-gray-400"><div class=h-1/10></div><div class=h-9/10></div></div><div class=h-1/10></div><div class="h-5/10 bg-gray-800">'),Jn=m("<div>Unknown view"),zn=m('<div class="h-1/10 w-full flex flex-row justify-between font-bold">'),Qn=m('<div class="flex flex-col gap-2 p-1 h-full"><div class="bg-black text-left pl-1"></div><div class="text-black whitespace-pre-wrap text-left overflow-y-auto text-sm">'),Zn=m('<div class="h-full bg-white flex flex-row"><div class="text-black bottom-0 left-0 border border-gray-100 p-1 flex flex-col gap-1 bg-white"><div class="rounded h-4 w-4 cursor-pointer"title="Show/hide bad"></div><div class="rounded h-4 w-4 cursor-pointer"title="Show/hide good"></div><div class="rounded h-4 w-4 cursor-pointer"title="Show/hide meta"></div><div class="rounded h-4 w-4 cursor-pointer"title="Show/hide drop"></div><div class="rounded h-4 w-4 cursor-pointer"title="Show/hide basic"></div></div><div class="text-black h-full overflow-y-auto flex flex-col w-full">'),er=m('<div class="flex flex-row items-center px-1 transition-colors duration-500 border-t border-gray-200"><div class="text-xs text-blue-400 mr-1">[<!>]</div><div class="text-wrap text-xs text-left">'),tr=m('<div class="flex flex-row bg-black px-1 justify-between"><div class=text-red-500>HP <!>/</div><div class=text-yellow-500>Gold </div><div class=text-green-500>Lvl <!> (<!>%)'),nr=m('<div class="content-center w-1/4 border border-l-0 cursor-pointer last:border-r-0">');function rr(){const[e,t]=T("story");return h(dn,{get children(){return h(Bt,{get children(){var n=Gn(),r=n.firstChild,s=r.firstChild,l=s.nextSibling,o=r.nextSibling,i=o.nextSibling;return y(s,h(ir,{})),y(l,h(sr,{})),y(o,h(or,{})),y(i,h(ce,{get fallback(){return Jn()},get children(){return[h(q,{get when(){return e()==="story"},get children(){return h(mn,{})}}),h(q,{get when(){return e()==="invent"},get children(){return h(kn,{})}}),h(q,{get when(){return e()==="skills"},get children(){return h(Ve,{})}}),h(q,{get when(){return e()==="stats"},get children(){return h(Xn,{})}}),h(q,{get when(){return e()==="menu"},get children(){return h(Ve,{})}})]}})),y(n,h(lr,{onChange:t,get view(){return e()}}),null),n}})}})}const lr=e=>(()=>{var t=zn();return y(t,h(te,{label:"Story",onClick:()=>e.onChange("story"),get view(){return e.view},type:"story"}),null),y(t,h(te,{label:"Invent",onClick:()=>e.onChange("invent"),get view(){return e.view},type:"invent"}),null),y(t,h(te,{label:"Skills",onClick:()=>e.onChange("skills"),get view(){return e.view},type:"skills"}),null),y(t,h(te,{label:"Stats",onClick:()=>e.onChange("stats"),get view(){return e.view},type:"stats"}),null),y(t,h(te,{label:"Menu",onClick:()=>e.onChange("menu"),get view(){return e.view},type:"menu"}),null),t})(),sr=()=>{const e=R(F);return h(ce,{get children(){return[h(q,{get when(){return(e==null?void 0:e.story().type)==="dialogue"},get children(){var t=Qn(),n=t.firstChild,r=n.nextSibling;return y(n,()=>(e==null?void 0:e.story().label)??"Story"),y(r,()=>e==null?void 0:e.story().description),t}}),h(q,{get when(){return(e==null?void 0:e.story().type)==="encounter"},get children(){return h(Dn,{})}}),h(q,{get when(){return(e==null?void 0:e.story().type)==="task"},get children(){return h(Fn,{})}})]}})},or=()=>{const[e,t]=T(),{log:n}=R(F)??{},[r,s]=Ie({good:!0,bad:!0,meta:!0,drop:!0,basic:!0}),l=O(()=>{const o=e();if(!o)return;const i=o.scrollTop+o.clientHeight>o.scrollHeight-10;return setTimeout(()=>i&&o.scrollTo(0,o.scrollHeight??0)),n==null?void 0:n().filter(a=>r[a.type])});return(()=>{var o=Zn(),i=o.firstChild,a=i.firstChild,f=a.nextSibling,u=f.nextSibling,c=u.nextSibling,p=c.nextSibling,w=i.nextSibling;return a.$$click=()=>s("bad",!r.bad),f.$$click=()=>s("good",!r.good),u.$$click=()=>s("meta",!r.meta),c.$$click=()=>s("drop",!r.drop),p.$$click=()=>s("basic",!r.basic),It(t,w),y(w,h(K,{get each(){return l()},children:d=>(()=>{var _=er(),A=_.firstChild,M=A.firstChild,S=M.nextSibling;S.nextSibling;var x=A.nextSibling;return y(A,()=>d.time,S),y(x,()=>d.msg),j(I=>rt(_,{"last:bg-red-500 last:text-white bg-red-200":d.type==="bad","last:bg-green-500 last:text-white bg-green-200":d.type==="good","last:bg-yellow-500 bg-yellow-200":d.type==="meta","last:bg-blue-500 last:text-white bg-blue-200":d.type==="drop"},I)),_})()})),j(d=>{var _=!r.bad,A=!!r.bad,M=!r.good,S=!!r.good,x=!r.meta,I=!!r.meta,D=!r.drop,g=!!r.drop,k=!r.basic,v=!!r.basic;return _!==d.e&&a.classList.toggle("bg-red-100",d.e=_),A!==d.t&&a.classList.toggle("bg-red-500",d.t=A),M!==d.a&&f.classList.toggle("bg-green-100",d.a=M),S!==d.o&&f.classList.toggle("bg-green-500",d.o=S),x!==d.i&&u.classList.toggle("bg-yellow-100",d.i=x),I!==d.n&&u.classList.toggle("bg-yellow-500",d.n=I),D!==d.s&&c.classList.toggle("bg-blue-100",d.s=D),g!==d.h&&c.classList.toggle("bg-blue-500",d.h=g),k!==d.r&&p.classList.toggle("bg-gray-100",d.r=k),v!==d.d&&p.classList.toggle("bg-gray-500",d.d=v),d},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0}),o})()},ir=()=>{const e=R(F);return(()=>{var t=tr(),n=t.firstChild,r=n.firstChild,s=r.nextSibling;s.nextSibling;var l=n.nextSibling;l.firstChild;var o=l.nextSibling,i=o.firstChild,a=i.nextSibling,f=a.nextSibling,u=f.nextSibling;return u.nextSibling,y(n,()=>e==null?void 0:e.player.stats.health,s),y(n,()=>e==null?void 0:e.player.stats.maxHealth,null),y(l,()=>e==null?void 0:e.player.stats.gold,null),y(o,()=>Se((e==null?void 0:e.player.stats.experience)??0),a),y(o,()=>(dt((e==null?void 0:e.player.stats.experience)??0)*100).toFixed(0),u),t})()},te=e=>(()=>{var t=nr();return nt(t,"click",e.onClick),y(t,()=>e.label),j(n=>rt(t,{"border-t-0 bg-gray-800":e.view===e.type},n)),t})();ue(["click"]);const ar=document.getElementById("root");Tt(()=>h(rr,{}),ar);
