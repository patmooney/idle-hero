(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();const Ln=!1,En=(e,t)=>e===t,Se=Symbol("solid-proxy"),pt=Symbol("solid-track"),ze={equals:En};let nn=ln;const we=1,We=2,rn={owned:null,cleanups:null,context:null,owner:null};var W=null;let st=null,Mn=null,X=null,Q=null,me=null,et=0;function He(e,t){const n=X,r=W,o=e.length===0,s=t===void 0?r:t,a=o?rn:{owned:null,cleanups:null,context:s?s.context:null,owner:s},i=o?e:()=>e(()=>ie(()=>Re(a)));W=a,X=null;try{return Le(i,!0)}finally{X=n,W=r}}function q(e,t){t=t?Object.assign({},ze,t):ze;const n={value:e,observers:null,observerSlots:null,comparator:t.equals||void 0},r=o=>(typeof o=="function"&&(o=o(n.value)),an(n,o));return[sn.bind(n),r]}function Z(e,t,n){const r=Lt(e,t,!1,we);Be(r)}function $e(e,t,n){nn=Pn;const r=Lt(e,t,!1,we);r.user=!0,me?me.push(r):Be(r)}function U(e,t,n){n=n?Object.assign({},ze,n):ze;const r=Lt(e,t,!0,0);return r.observers=null,r.observerSlots=null,r.comparator=n.equals||void 0,Be(r),sn.bind(r)}function ve(e){return Le(e,!1)}function ie(e){if(X===null)return e();const t=X;X=null;try{return e()}finally{X=t}}function Oe(e){$e(()=>ie(e))}function tt(e){return W===null||(W.cleanups===null?W.cleanups=[e]:W.cleanups.push(e)),e}function _t(){return X}function nt(e,t){const n=Symbol("context");return{id:n,Provider:Bn(n),defaultValue:e}}function N(e){let t;return W&&W.context&&(t=W.context[e.id])!==void 0?t:e.defaultValue}function on(e){const t=U(e),n=U(()=>vt(t()));return n.toArray=()=>{const r=n();return Array.isArray(r)?r:r!=null?[r]:[]},n}function sn(){if(this.sources&&this.state)if(this.state===we)Be(this);else{const e=Q;Q=null,Le(()=>Ge(this),!1),Q=e}if(X){const e=this.observers?this.observers.length:0;X.sources?(X.sources.push(this),X.sourceSlots.push(e)):(X.sources=[this],X.sourceSlots=[e]),this.observers?(this.observers.push(X),this.observerSlots.push(X.sources.length-1)):(this.observers=[X],this.observerSlots=[X.sources.length-1])}return this.value}function an(e,t,n){let r=e.value;return(!e.comparator||!e.comparator(r,t))&&(e.value=t,e.observers&&e.observers.length&&Le(()=>{for(let o=0;o<e.observers.length;o+=1){const s=e.observers[o],a=st&&st.running;a&&st.disposed.has(s),(a?!s.tState:!s.state)&&(s.pure?Q.push(s):me.push(s),s.observers&&cn(s)),a||(s.state=we)}if(Q.length>1e6)throw Q=[],new Error},!1)),t}function Be(e){if(!e.fn)return;Re(e);const t=et;Rn(e,e.value,t)}function Rn(e,t,n){let r;const o=W,s=X;X=W=e;try{r=e.fn(t)}catch(a){return e.pure&&(e.state=we,e.owned&&e.owned.forEach(Re),e.owned=null),e.updatedAt=n+1,un(a)}finally{X=s,W=o}(!e.updatedAt||e.updatedAt<=n)&&(e.updatedAt!=null&&"observers"in e?an(e,r):e.value=r,e.updatedAt=n)}function Lt(e,t,n,r=we,o){const s={fn:e,state:r,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:W,context:W?W.context:null,pure:n};return W===null||W!==rn&&(W.owned?W.owned.push(s):W.owned=[s]),s}function Xe(e){if(e.state===0)return;if(e.state===We)return Ge(e);if(e.suspense&&ie(e.suspense.inFallback))return e.suspense.effects.push(e);const t=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<et);)e.state&&t.push(e);for(let n=t.length-1;n>=0;n--)if(e=t[n],e.state===we)Be(e);else if(e.state===We){const r=Q;Q=null,Le(()=>Ge(e,t[0]),!1),Q=r}}function Le(e,t){if(Q)return e();let n=!1;t||(Q=[]),me?n=!0:me=[],et++;try{const r=e();return Dn(n),r}catch(r){n||(me=null),Q=null,un(r)}}function Dn(e){if(Q&&(ln(Q),Q=null),e)return;const t=me;me=null,t.length&&Le(()=>nn(t),!1)}function ln(e){for(let t=0;t<e.length;t++)Xe(e[t])}function Pn(e){let t,n=0;for(t=0;t<e.length;t++){const r=e[t];r.user?e[n++]=r:Xe(r)}for(t=0;t<n;t++)Xe(e[t])}function Ge(e,t){e.state=0;for(let n=0;n<e.sources.length;n+=1){const r=e.sources[n];if(r.sources){const o=r.state;o===we?r!==t&&(!r.updatedAt||r.updatedAt<et)&&Xe(r):o===We&&Ge(r,t)}}}function cn(e){for(let t=0;t<e.observers.length;t+=1){const n=e.observers[t];n.state||(n.state=We,n.pure?Q.push(n):me.push(n),n.observers&&cn(n))}}function Re(e){let t;if(e.sources)for(;e.sources.length;){const n=e.sources.pop(),r=e.sourceSlots.pop(),o=n.observers;if(o&&o.length){const s=o.pop(),a=n.observerSlots.pop();r<o.length&&(s.sourceSlots[a]=r,o[r]=s,n.observerSlots[r]=a)}}if(e.tOwned){for(t=e.tOwned.length-1;t>=0;t--)Re(e.tOwned[t]);delete e.tOwned}if(e.owned){for(t=e.owned.length-1;t>=0;t--)Re(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}e.state=0}function On(e){return e instanceof Error?e:new Error(typeof e=="string"?e:"Unknown error",{cause:e})}function un(e,t=W){throw On(e)}function vt(e){if(typeof e=="function"&&!e.length)return vt(e());if(Array.isArray(e)){const t=[];for(let n=0;n<e.length;n++){const r=vt(e[n]);Array.isArray(r)?t.push.apply(t,r):t.push(r)}return t}return e}function Bn(e,t){return function(r){let o;return Z(()=>o=ie(()=>(W.context={...W.context,[e]:r.value},on(()=>r.children))),void 0),o}}const Un=Symbol("fallback");function Et(e){for(let t=0;t<e.length;t++)e[t]()}function Nn(e,t,n={}){let r=[],o=[],s=[],a=0,i=t.length>1?[]:null;return tt(()=>Et(s)),()=>{let h=e()||[],l=h.length,g,d;return h[pt],ie(()=>{let y,m,f,c,b,u,w,v,x;if(l===0)a!==0&&(Et(s),s=[],r=[],o=[],a=0,i&&(i=[])),n.fallback&&(r=[Un],o[0]=He(E=>(s[0]=E,n.fallback())),a=1);else if(a===0){for(o=new Array(l),d=0;d<l;d++)r[d]=h[d],o[d]=He(_);a=l}else{for(f=new Array(l),c=new Array(l),i&&(b=new Array(l)),u=0,w=Math.min(a,l);u<w&&r[u]===h[u];u++);for(w=a-1,v=l-1;w>=u&&v>=u&&r[w]===h[v];w--,v--)f[v]=o[w],c[v]=s[w],i&&(b[v]=i[w]);for(y=new Map,m=new Array(v+1),d=v;d>=u;d--)x=h[d],g=y.get(x),m[d]=g===void 0?-1:g,y.set(x,d);for(g=u;g<=w;g++)x=r[g],d=y.get(x),d!==void 0&&d!==-1?(f[d]=o[g],c[d]=s[g],i&&(b[d]=i[g]),d=m[d],y.set(x,d)):s[g]();for(d=u;d<l;d++)d in f?(o[d]=f[d],s[d]=c[d],i&&(i[d]=b[d],i[d](d))):o[d]=He(_);o=o.slice(0,a=l),r=h.slice(0)}return o});function _(y){if(s[d]=y,i){const[m,f]=q(d);return i[d]=f,t(h[d],m)}return t(h[d])}}}function S(e,t){return ie(()=>e(t||{}))}const dn=e=>`Stale read from <${e}>.`;function re(e){const t="fallback"in e&&{fallback:()=>e.fallback};return U(Nn(()=>e.each,e.children,t||void 0))}function z(e){const t=e.keyed,n=U(()=>e.when,void 0,void 0),r=t?n:U(n,void 0,{equals:(o,s)=>!o==!s});return U(()=>{const o=r();if(o){const s=e.children;return typeof s=="function"&&s.length>0?ie(()=>s(t?o:()=>{if(!ie(r))throw dn("Show");return n()})):s}return e.fallback},void 0,void 0)}function Ue(e){const t=on(()=>e.children),n=U(()=>{const r=t(),o=Array.isArray(r)?r:[r];let s=()=>{};for(let a=0;a<o.length;a++){const i=a,h=o[a],l=s,g=U(()=>l()?void 0:h.when,void 0,void 0),d=h.keyed?g:U(g,void 0,{equals:(_,y)=>!_==!y});s=()=>l()||(d()?[i,g,h]:void 0)}return s});return U(()=>{const r=n()();if(!r)return e.fallback;const[o,s,a]=r,i=a.children;return typeof i=="function"&&i.length>0?ie(()=>i(a.keyed?s():()=>{var l;if(((l=ie(n)())==null?void 0:l[0])!==o)throw dn("Match");return s()})):i},void 0,void 0)}function Y(e){return e}const qn=void 0,ge=e=>U(()=>e());function Fn(e,t,n){let r=n.length,o=t.length,s=r,a=0,i=0,h=t[o-1].nextSibling,l=null;for(;a<o||i<s;){if(t[a]===n[i]){a++,i++;continue}for(;t[o-1]===n[s-1];)o--,s--;if(o===a){const g=s<r?i?n[i-1].nextSibling:n[s-i]:h;for(;i<s;)e.insertBefore(n[i++],g)}else if(s===i)for(;a<o;)(!l||!l.has(t[a]))&&t[a].remove(),a++;else if(t[a]===n[s-1]&&n[i]===t[o-1]){const g=t[--o].nextSibling;e.insertBefore(n[i++],t[a++].nextSibling),e.insertBefore(n[--s],g),t[o]=n[s]}else{if(!l){l=new Map;let d=i;for(;d<s;)l.set(n[d],d++)}const g=l.get(t[a]);if(g!=null)if(i<g&&g<s){let d=a,_=1,y;for(;++d<o&&d<s&&!((y=l.get(t[d]))==null||y!==g+_);)_++;if(_>g-i){const m=t[a];for(;i<g;)e.insertBefore(n[i++],m)}else e.replaceChild(n[i++],t[a++])}else a++;else t[a++].remove()}}}const Mt="_$DX_DELEGATE";function Hn(e,t,n,r={}){let o;return He(s=>{o=s,t===document?e():$(t,e(),t.firstChild?null:void 0,n)},r.owner),()=>{o(),t.textContent=""}}function L(e,t,n,r){let o;const s=()=>{const i=document.createElement("template");return i.innerHTML=e,i.content.firstChild},a=()=>(o||(o=s())).cloneNode(!0);return a.cloneNode=a,a}function pe(e,t=window.document){const n=t[Mt]||(t[Mt]=new Set);for(let r=0,o=e.length;r<o;r++){const s=e[r];n.has(s)||(n.add(s),t.addEventListener(s,Wn))}}function jn(e,t){t==null?e.removeAttribute("class"):e.className=t}function rt(e,t,n,r){Array.isArray(n)?(e[`$$${t}`]=n[0],e[`$$${t}Data`]=n[1]):e[`$$${t}`]=n}function fn(e,t,n={}){const r=Object.keys(t||{}),o=Object.keys(n);let s,a;for(s=0,a=o.length;s<a;s++){const i=o[s];!i||i==="undefined"||t[i]||(Rt(e,i,!1),delete n[i])}for(s=0,a=r.length;s<a;s++){const i=r[s],h=!!t[i];!i||i==="undefined"||n[i]===h||!h||(Rt(e,i,!0),n[i]=h)}return n}function Vn(e,t,n){n!=null?e.style.setProperty(t,n):e.style.removeProperty(t)}function zn(e,t,n){return ie(()=>e(t,n))}function $(e,t,n,r){if(n!==void 0&&!r&&(r=[]),typeof t!="function")return Ke(e,t,r,n);Z(o=>Ke(e,t(),o,n),r)}function Rt(e,t,n){const r=t.trim().split(/\s+/);for(let o=0,s=r.length;o<s;o++)e.classList.toggle(r[o],n)}function Wn(e){let t=e.target;const n=`$$${e.type}`,r=e.target,o=e.currentTarget,s=h=>Object.defineProperty(e,"target",{configurable:!0,value:h}),a=()=>{const h=t[n];if(h&&!t.disabled){const l=t[`${n}Data`];if(l!==void 0?h.call(t,l,e):h.call(t,e),e.cancelBubble)return}return t.host&&typeof t.host!="string"&&!t.host._$host&&t.contains(e.target)&&s(t.host),!0},i=()=>{for(;a()&&(t=t._$host||t.parentNode||t.host););};if(Object.defineProperty(e,"currentTarget",{configurable:!0,get(){return t||document}}),e.composedPath){const h=e.composedPath();s(h[0]);for(let l=0;l<h.length-2&&(t=h[l],!!a());l++){if(t._$host){t=t._$host,i();break}if(t.parentNode===o)break}}else i();s(r)}function Ke(e,t,n,r,o){for(;typeof n=="function";)n=n();if(t===n)return n;const s=typeof t,a=r!==void 0;if(e=a&&n[0]&&n[0].parentNode||e,s==="string"||s==="number"){if(s==="number"&&(t=t.toString(),t===n))return n;if(a){let i=n[0];i&&i.nodeType===3?i.data!==t&&(i.data=t):i=document.createTextNode(t),n=Ae(e,n,r,i)}else n!==""&&typeof n=="string"?n=e.firstChild.data=t:n=e.textContent=t}else if(t==null||s==="boolean")n=Ae(e,n,r);else{if(s==="function")return Z(()=>{let i=t();for(;typeof i=="function";)i=i();n=Ke(e,i,n,r)}),()=>n;if(Array.isArray(t)){const i=[],h=n&&Array.isArray(n);if(yt(i,t,n,o))return Z(()=>n=Ke(e,i,n,r,!0)),()=>n;if(i.length===0){if(n=Ae(e,n,r),a)return n}else h?n.length===0?Dt(e,i,r):Fn(e,n,i):(n&&Ae(e),Dt(e,i));n=i}else if(t.nodeType){if(Array.isArray(n)){if(a)return n=Ae(e,n,r,t);Ae(e,n,null,t)}else n==null||n===""||!e.firstChild?e.appendChild(t):e.replaceChild(t,e.firstChild);n=t}}return n}function yt(e,t,n,r){let o=!1;for(let s=0,a=t.length;s<a;s++){let i=t[s],h=n&&n[e.length],l;if(!(i==null||i===!0||i===!1))if((l=typeof i)=="object"&&i.nodeType)e.push(i);else if(Array.isArray(i))o=yt(e,i,h)||o;else if(l==="function")if(r){for(;typeof i=="function";)i=i();o=yt(e,Array.isArray(i)?i:[i],Array.isArray(h)?h:[h])||o}else e.push(i),o=!0;else{const g=String(i);h&&h.nodeType===3&&h.data===g?e.push(h):e.push(document.createTextNode(g))}}return o}function Dt(e,t,n=null){for(let r=0,o=t.length;r<o;r++)e.insertBefore(t[r],n)}function Ae(e,t,n,r){if(n===void 0)return e.textContent="";const o=r||document.createTextNode("");if(t.length){let s=!1;for(let a=t.length-1;a>=0;a--){const i=t[a];if(o!==i){const h=i.parentNode===e;!s&&!a?h?e.replaceChild(o,i):e.insertBefore(o,n):h&&i.remove()}else s=!0}}else e.insertBefore(o,n);return[o]}const wt=Symbol("store-raw"),Te=Symbol("store-node"),he=Symbol("store-has"),hn=Symbol("store-self");function bn(e){let t=e[Se];if(!t&&(Object.defineProperty(e,Se,{value:t=new Proxy(e,Kn)}),!Array.isArray(e))){const n=Object.keys(e),r=Object.getOwnPropertyDescriptors(e);for(let o=0,s=n.length;o<s;o++){const a=n[o];r[a].get&&Object.defineProperty(e,a,{enumerable:r[a].enumerable,get:r[a].get.bind(t)})}}return t}function Ye(e){let t;return e!=null&&typeof e=="object"&&(e[Se]||!(t=Object.getPrototypeOf(e))||t===Object.prototype||Array.isArray(e))}function ye(e,t=new Set){let n,r,o,s;if(n=e!=null&&e[wt])return n;if(!Ye(e)||t.has(e))return e;if(Array.isArray(e)){Object.isFrozen(e)?e=e.slice(0):t.add(e);for(let a=0,i=e.length;a<i;a++)o=e[a],(r=ye(o,t))!==o&&(e[a]=r)}else{Object.isFrozen(e)?e=Object.assign({},e):t.add(e);const a=Object.keys(e),i=Object.getOwnPropertyDescriptors(e);for(let h=0,l=a.length;h<l;h++)s=a[h],!i[s].get&&(o=e[s],(r=ye(o,t))!==o&&(e[s]=r))}return e}function Ze(e,t){let n=e[t];return n||Object.defineProperty(e,t,{value:n=Object.create(null)}),n}function De(e,t,n){if(e[t])return e[t];const[r,o]=q(n,{equals:!1,internal:!0});return r.$=o,e[t]=r}function Xn(e,t){const n=Reflect.getOwnPropertyDescriptor(e,t);return!n||n.get||!n.configurable||t===Se||t===Te||(delete n.value,delete n.writable,n.get=()=>e[Se][t]),n}function gn(e){_t()&&De(Ze(e,Te),hn)()}function Gn(e){return gn(e),Reflect.ownKeys(e)}const Kn={get(e,t,n){if(t===wt)return e;if(t===Se)return n;if(t===pt)return gn(e),n;const r=Ze(e,Te),o=r[t];let s=o?o():e[t];if(t===Te||t===he||t==="__proto__")return s;if(!o){const a=Object.getOwnPropertyDescriptor(e,t);_t()&&(typeof s!="function"||e.hasOwnProperty(t))&&!(a&&a.get)&&(s=De(r,t,s)())}return Ye(s)?bn(s):s},has(e,t){return t===wt||t===Se||t===pt||t===Te||t===he||t==="__proto__"?!0:(_t()&&De(Ze(e,he),t)(),t in e)},set(){return!0},deleteProperty(){return!0},ownKeys:Gn,getOwnPropertyDescriptor:Xn};function Je(e,t,n,r=!1){if(!r&&e[t]===n)return;const o=e[t],s=e.length;n===void 0?(delete e[t],e[he]&&e[he][t]&&o!==void 0&&e[he][t].$()):(e[t]=n,e[he]&&e[he][t]&&o===void 0&&e[he][t].$());let a=Ze(e,Te),i;if((i=De(a,t,o))&&i.$(()=>n),Array.isArray(e)&&e.length!==s){for(let h=e.length;h<s;h++)(i=a[h])&&i.$();(i=De(a,"length",s))&&i.$(e.length)}(i=a[hn])&&i.$()}function mn(e,t){const n=Object.keys(t);for(let r=0;r<n.length;r+=1){const o=n[r];Je(e,o,t[o])}}function Yn(e,t){if(typeof t=="function"&&(t=t(e)),t=ye(t),Array.isArray(t)){if(e===t)return;let n=0,r=t.length;for(;n<r;n++){const o=t[n];e[n]!==o&&Je(e,n,o)}Je(e,"length",r)}else mn(e,t)}function Me(e,t,n=[]){let r,o=e;if(t.length>1){r=t.shift();const a=typeof r,i=Array.isArray(e);if(Array.isArray(r)){for(let h=0;h<r.length;h++)Me(e,[r[h]].concat(t),n);return}else if(i&&a==="function"){for(let h=0;h<e.length;h++)r(e[h],h)&&Me(e,[h].concat(t),n);return}else if(i&&a==="object"){const{from:h=0,to:l=e.length-1,by:g=1}=r;for(let d=h;d<=l;d+=g)Me(e,[d].concat(t),n);return}else if(t.length>1){Me(e[r],t,[r].concat(n));return}o=e[r],n=[r].concat(n)}let s=t[0];typeof s=="function"&&(s=s(o,n),s===o)||r===void 0&&s==null||(s=ye(s),r===void 0||Ye(o)&&Ye(s)&&!Array.isArray(s)?mn(o,s):Je(e,r,s))}function Qe(...[e,t]){const n=ye(e||{}),r=Array.isArray(n),o=bn(n);function s(...a){ve(()=>{r&&a.length===1?Yn(n,a[0]):Me(n,a)})}return[o,s]}const Zn=80,Jn=10,pn=1.7,_n=20,xe=40,je=100,vn=500,Pt=720*60*1e3,Ot=3600*24*10/85,se="story_town_1",St=10,Qn=100,yn=new Array(495).fill(1).map((e,t)=>Math.floor(Zn*Math.pow(t+1,pn))),be=new Array(500).fill(1).map((e,t)=>Math.floor(Jn*Math.pow(t+1,pn))),$t=(e,t=yn)=>{if(!e)return 0;const n=t.findIndex(s=>s>e);if(n<0&&e>0)return 1;const r=e-(t[n-1]??0),o=t[n]-(t[n-1]??0);return r/o},ce=(e,t=yn)=>{const n=t.findIndex(r=>r>e);return n<0&&e>0?t.length:n},Cn=[{name:"unarmed",label:"Unarmed",bonus:new Array(vn+1).fill(null).map((e,t)=>{if(!(!t||t%5!==0))return{level:t,stats:{attMin:t%10===0?1:0,attMax:1,attSpeed:t%50===0?.1:0}}}).filter(Boolean)}],er=[{name:"woodcutting",label:"Woodcutting",bonus:new Array(vn+1).fill(null).map((e,t)=>{if(!(!t||t%5!==0))return{level:t,stats:{durationModifier:t%10===0?10:0},dropModifiers:[{name:"wood_log_1",chance:t%50===0?1:0}]}}).filter(Boolean)}],Ie=[Cn,er].flat().reduce((e,t)=>(e[t.name]=t,e),{}),tr=(e,t)=>wn(e,ce(t,be)),wn=(e,t)=>{const n=Ie[e];if(!n)return{};const r=n.bonus.filter(o=>o.level<=t);return(r==null?void 0:r.reduce((o,s)=>(Object.entries(s.stats).forEach(([a,i])=>{o[a]=(o[a]??0)+i}),o),{}))??{}},nr=(e,t,n)=>{const r=Ie[t];if(!r)return 0;const o=ce(n,be),s=r.bonus.filter(a=>a.level<=o);return s==null?void 0:s.reduce((a,i)=>{var h,l;return a+(((l=(h=i.dropModifiers)==null?void 0:h.find(g=>g.name===e))==null?void 0:l.chance)??0)},0)};var rr=L('<div class="font-bold m-2">'),or=L("<div>");const Ce=e=>(()=>{var t=rr();return $(t,S(re,{get each(){return e.lines},children:(n,r)=>(()=>{var o=or();return $(o,S(z,{get when(){return r()===0},children:'" .. '}),null),$(o,n,null),$(o,S(z,{get when(){return r()===e.lines.length-1},children:' .. "'}),null),o})()})),t})(),sr=[{name:"hay_hand_1",label:"Hay hand wraps",equipSlot:"hand",craftComplexity:1,craftType:"basic",craftLevel:1,ingredients:[{name:"hay_1",count:25}],stats:{attMin:1,attMax:3}},{name:"hay_head_1",label:"Hay bandana",equipSlot:"head",craftComplexity:1,craftType:"basic",craftLevel:1,ingredients:[{name:"hay_1",count:25}],stats:{maxHealth:5}},{name:"hay_chest_1",label:"Hay vest",equipSlot:"chest",craftComplexity:1,craftType:"basic",craftLevel:1,ingredients:[{name:"hay_1",count:50}],stats:{physRes:1}},{name:"utility_axe_1",label:"Rusty axe",equipSlot:"weapon",utilityType:"axe",stats:{}}],ar=[{name:"recipe_hay_hand_1",label:"Recipe: Hay hand wraps",craftableItem:"hay_hand_1"},{name:"recipe_bench_basic_1",label:"Recipe: Basic crafting table",craftableFurniture:"furniture_bench_basic_1"},{name:"recipe_hay_head_1",label:"Recipe: Hay bandana",craftableItem:"hay_head_1"},{name:"recipe_hay_chest_1",label:"Recipe: Hay vest",craftableItem:"hay_chest_1"},{name:"recipe_worm_kabab_1",label:"Recipe: Worm kabab",craftableItem:"food_worm_kabab_1"},{name:"recipe_camp_fire_1",label:"Recipe: Camp fire",craftableFurniture:"furniture_cook_basic_1"}].map(e=>({...e,useVerb:"Read",category:"book",exclusive:!0,use:(t,n,r,o)=>(o==null||o.onTask({noRepeat:!0,label:"Learning",description:e.label,duration:100,onComplete:()=>{var s;return(s=r==null?void 0:r.recipes())!=null&&s.find(a=>a.craftableItem===e.craftableItem)||(r==null||r.onAddRecipe(e.name),t==null||t.setState("prohibitedItems",[...(t==null?void 0:t.state.prohibitedItems)??[],e.name])),n==null||n.removeInventory(e.name,1),t==null||t.onNavigate("_back"),!0}}),!1)})),ir=[{name:"hay_1",label:"Hay",category:"resource",maxStack:100},{name:"wood_log_1",label:"Wooden log",category:"resource",maxStack:100}],lr=[{name:"wood_club_1",label:"Wooden Club",equipSlot:"weapon",craftType:"weapon",craftComplexity:1,craftLevel:1,ingredients:[{name:"wood_log_1",count:15}],masteryType:"mace",stats:{attMin:2,attMax:5,attSpeed:-.1}},{name:"wood_shield_1",label:"Wooden Shield",equipSlot:"offhand",craftType:"armour",craftComplexity:1,craftLevel:1,ingredients:[{name:"wood_log_1",count:20}],stats:{physRes:2,maxHealth:10}},{name:"wood_chest_1",label:"Wooden Plank Vest",equipSlot:"chest",craftType:"armour",craftComplexity:2,craftLevel:1,ingredients:[{name:"wood_log_1",count:40}],stats:{physRes:3,agility:-1}},{name:"stone_axe_1",label:"Stone Axe",equipSlot:"weapon",craftType:"weapon",craftComplexity:2,craftLevel:2,ingredients:[{name:"wood_log_1",count:10},{name:"stone_1",count:10}],masteryType:"axe",stats:{attMin:3,attMax:8,attSpeed:-.05,strength:1}},{name:"stone_helm_1",label:"Stone Helm",equipSlot:"head",craftType:"armour",craftComplexity:2,craftLevel:2,ingredients:[{name:"stone_1",count:20},{name:"hay_1",count:10}],stats:{physRes:4,maxHealth:10,intelligence:-1}},{name:"copper_sword_1",label:"Copper Shortsword",equipSlot:"weapon",craftType:"weapon",craftComplexity:3,craftLevel:2,ingredients:[{name:"copper_ingot_1",count:8},{name:"wood_log_1",count:5}],masteryType:"sword",stats:{attMin:4,attMax:10,attSpeed:.1,dexterity:1}},{name:"copper_chest_1",label:"Copper Breastplate",equipSlot:"chest",craftType:"armour",craftComplexity:3,craftLevel:2,ingredients:[{name:"copper_ingot_1",count:15}],stats:{physRes:5,magRes:1,strength:1}},{name:"iron_spear_1",label:"Iron Spear",equipSlot:"weapon",craftType:"weapon",craftComplexity:4,craftLevel:3,ingredients:[{name:"iron_ingot_1",count:12},{name:"wood_log_1",count:8}],masteryType:"spear",stats:{attMin:6,attMax:14,attSpeed:0,dexterity:2}},{name:"iron_helm_1",label:"Iron Helmet",equipSlot:"head",craftType:"armour",craftComplexity:4,craftLevel:3,ingredients:[{name:"iron_ingot_1",count:8}],stats:{physRes:6,maxHealth:15,charisma:-1}},{name:"iron_boots_1",label:"Iron Greaves",equipSlot:"foot",craftType:"armour",craftComplexity:4,craftLevel:3,ingredients:[{name:"iron_ingot_1",count:6}],stats:{physRes:3,agility:-1}}],cr=[{name:"food_acorn_1",label:"Raw acorn (+2hp)",useVerb:"Eat",maxStack:10,hp:2},{name:"food_worm_1",label:"Raw worm (+1hp)",useVerb:"Eat",maxStack:10,hp:1},{name:"food_worm_kabab_1",label:"Worm... kabab (+4hp)",useVerb:"Eat",maxStack:10,craftType:"food",hp:4,craftComplexity:1,ingredients:[{name:"food_worm_1",count:10}]}].map(e=>({...e,category:"food",use:(t,n,r)=>{const o=r.player.stats.health,s=r.player.stats.maxHealth??10,a=Math.min(e.hp,s-o);return o<s?(r.onAddStat("health",a),n.removeInventory(e.name,1),!0):!1}})),ur=[{name:"demonic_essense_1",label:"Demonic Essense",category:"unique"}],dr=.05,fr=.2,qe=["marginal","somewhat","evident","proven","considerable","superb","extraordinary","legendary","monstrous","psychotic","mythic","divine","world-ending"],hr=[["wooden","stone","bone","obsidian"],["copper","bronze","iron","steel"],["damascus","cold iron","silver","titanium"],["meteor","mithril","adamantine","orichalcum"],["light","water","earth","fire"]],br=[["cloth","leather","bone","obsidian"],["copper","bronze","iron","steel"],["damascus","cold iron","silver","titanium"],["meteor","mithril","adamantine","orichalcum"],["light","water","earth","fire"]],gr=[["weapon","staff","staff"],["weapon","sword","sword"],["weapon","great axe","battleaxe"],["weapon","dagger","dagger"],["weapon","spear","spear"]],mr=[["head","helmet"],["shoulder","paldron"],["hand","gauntlets"],["chest","armour"],["leg","grieves"],["foot","boots"]],pr=[["attMin","attack"],["attMax","attack"],["attSpeed","speed"]],_r=[["maxHealth","health"],["physRes","defence"],["magRes","resistance"]],vr={staff:{attMin:4,attMax:4,attSpeed:.1},sword:{attMin:2,attMax:3,attSpeed:.3},battleaxe:{attMin:1,attMax:6,attSpeed:.2},dagger:{attMin:1,attMax:2,attSpeed:.5},spear:{attMin:2,attMax:4,attSpeed:.2}},yr={helmet:{maxHealth:5},paldron:{magRes:1,physRes:1},gauntlets:{attSpeed:.1,physRes:1,strength:1},armour:{physRes:2,magRes:2,maxHealth:5,constitution:1},grieves:{physRes:1,magRes:1},boots:{physRes:1,magRes:1,agility:1}},Bt=[["Rat","Bat","Slime","Beetle","Crab","Snake","Frog","Spider","Worm","Crow"],["Wolf","Goblin","Boar","Lizard","Scorpion","Bandit","Imp","Wasp","Monkey","Skeleton"],["Troll","Ogre","Harpy","Basilisk","Minotaur","Wyvern","Centaur","Golem","Manticore","Wraith"],["Chimera","Hydra","Vampire","Lich","Griffin","Djinn","Kraken","Behemoth","Leviathan","Shade"],["Dragon","Phoenix","Titan","Seraph","Demon","Colossus","Archon","World Serpent","Voidborn"]],Ut=[["Small","Wild","Feral","Hungry","Quick","Silent","Agile","Savage","Venomous","Rabid","Stalking","Stone","Iron","Ashen","Muddy"],["Shadow","Ember","Frost","Storm","Thorn","Crystal","Winged","Clawed","Bladed","Blooded","Vicious","Twisted","Warped","Cursed","Blighted"],["Arcane","Runic","Mystic","Phantom","Spectral","Infernal","Corrupted","Lunar","Solar","Tidal","Venomous","Void","Enchanted","Temporal","Primeval"],["Ancient","Forgotten","Eternal","Eldritch","Celestial","Dread","Malevolent","Sacred","Forbidden","Prime","Abyssal","Astral","Titan","Leviathan","Demonic"],["Mythic","Divine","Eternal","Worldforged","Cataclysmic","Apocalyptic","Transcendent","Omniscient","Voidborn","Infinite","Cosmic","Godbound","Alpha","Omega","Absolute"]],at=[[0,5],[5,10],[10,30],[30,60],[60,100]],it=[[5,10],[10,30],[30,60],[60,100],[100,150]],lt=[[20,50],[50,100],[100,200],[200,400],[400,1e3]],ct=[[50,100],[40,90],[30,80],[20,60],[10,50]],wr=[[["easy_drop_1",.2],["easy_drop_2",.1],["easy_drop_3",.1],["easy_drop_4",.1],["easy_drop_rare_1",.01],["easy_drop_rare_2",.01],["easy_drop_ultra_1",.001]],[["med_drop_1",.2],["med_drop_2",.1],["med_drop_3",.1],["med_drop_4",.1],["med_drop_rare_1",.01],["med_drop_rare_2",.01],["med_drop_ultra_1",.001]],[["hard_drop_1",.2],["hard_drop_2",.1],["hard_drop_3",.1],["hard_drop_4",.1],["hard_drop_rare_1",.01],["hard_drop_rare_2",.01],["hard_drop_ultra_1",.001]],[["insane_drop_1",.2],["insane_drop_2",.1],["insane_drop_3",.1],["insane_drop_4",.1],["insane_drop_rare_1",.01],["insane_drop_rare_2",.01],["insane_drop_ultra_1",.001]],[["demonic_drop_1",.2],["demonic_drop_2",.1],["demonic_drop_3",.1],["demonic_drop_4",.1],["demonic_drop_rare_1",.01],["demonic_drop_rare_2",.01],["demonic_drop_ultra_1",.001]]],Sr=[[0,5],[5,20],[20,30],[30,50],[50,100]],$r=(e=0,t)=>{const n=at[e][0]+Math.round(Math.random()*(at[e][1]-at[e][0])),r=it[e][0]+Math.round(Math.random()*(it[e][1]-it[e][0])),o=lt[e][0]+Math.round(Math.random()*(lt[e][1]-lt[e][0])),s=ct[e][0]+Math.round(Math.random()*(ct[e][1]-ct[e][0])),a=[];if(Math.random()<dr){const h=kr(e);t.onCreateItem(h),a.push({name:h.name,chance:1})}const i=[Ut[e][Math.floor(Math.random()*Ut[e].length)],Bt[e][Math.floor(Math.random()*Bt[e].length)]].join(" ");return{name:i.replaceAll(/\s/g,"_").toLowerCase()+"_1",label:i,drops:a,chance:1,health:o,gold:Sr[e],stats:{attMax:r,attMin:n,attSpeed:s}}},kt=(e=0)=>{const t={name:`generated_level_${e}`,label:`Cave of mystery level ${e}`,description:"What is going on?",type:"encounter",...e<4?{limit:1,onComplete:(n,r,o,s)=>{n.setState("markers",[...n.state.markers,`generated_level_${e}`]),s.onStory({...t,limit:void 0,onComplete:void 0,name:`${t.name}_cmpl`,options:[{label:"Go deeper",action:(a,i,h,l)=>l.onStory(kt(e+1))}]})}}:{},options:n=>{const r={label:"Go deeper",action:(o,s,a,i)=>i.onStory(kt(e+1))};return[...n.state.markers.includes(`generated_level_${e}`)?[r]:[]]},encounters:n=>$r(e,n)};return t},kr=(e=0)=>{var m;let t,n,r;Math.random()<.1?(t=gr,n=pr,r=hr):(t=mr,n=_r,r=br);let o;const s=Math.random();let a=0;for(let f=0;f<r[e].length;f++)if(a+=(f+1)*.1,s<=a){o=r[e].toReversed().at(f);break}const i=t[Math.floor(Math.random()*t.length)],h=1+e*1+(r[e].indexOf(o??"")??0)*.25;let l={};if(i.at(2)){const f=i.at(2);l=Object.entries(f?vr[f]??{}:{}).reduce((c,[b,u])=>(c[b]=u*h,c),{})}else{const f=i.at(1);l=Object.entries(f?yr[f]??{}:{}).reduce((c,[b,u])=>(c[b]=u*h,c),{})}let g=0;if(Math.random()<fr)for(;;){if(Math.random()<=.5){const c=n[Math.floor(Math.random()*n.length)];l[c[0]]=(l[c[0]]??0)+1,g++;continue}if(!(Math.random()<=.3))break}let d="",_="";if(g){const f=Object.entries(l).reduce((c,[b,u])=>!(c!=null&&c[1])||u>c[1]?[b,u]:c,void 0);if(f!=null&&f[0]){const[c,b]=f;d=b>qe.length?qe.at(-1)+"+".repeat(b-qe.length):qe[b-1],_=f?((m=n.find(u=>u[0]===c))==null?void 0:m[1])??"unknown":"unknown"}}l.attMax=Math.max(l.attMax??0,l.attMin??0)||void 0;let y=`${o} ${i[1]}`;return g&&(y=`${y} of ${d} ${_}`),{name:crypto.randomUUID(),masteryType:i.at(2),label:y,stats:l,equipSlot:i[0]}},Ar=wr.reduce((e,t)=>(e.push(...t.map(n=>({name:n[0],label:n[0],maxStack:100,category:"misc"}))),e),[]),ae=[sr,ar,ir,lr,cr,ur,Ar].flat().reduce((e,t)=>(e[t.name]=t,e),{});var xr=L("<span class=text-red-500>Fight scarecrows"),Ir=L('<span class="font-bold ml-1">'),Tr=L('<span class="font-bold text-blue-500 mr-1">Hay'),Lr=L("<span class=font-bold>"),Er=L('<span class="font-bold m-1">, ');const Mr=[{name:"story_town_1",label:"Town",description:"You are in town",type:"dialogue",options:[{label:"Visit Farm",goto:"story_farmer_1"},{label:"Leave the town",goto:"story_forest_1"},{label:"Merchants",goto:"story_town_merchants_1"},{label:"Home",goto:"story_home_1"}]},{name:"story_farmer_1",label:"Farm",description:"A vacant expressionless farmer. Hasn't washed in days.",type:"dialogue",options:[{label:"Approach the farmer",goto:"story_farmer_2"},{label:xr(),goto:"story_scarecrows_1"},{label:"Sell Hay",action:(e,t,n)=>{if(!t)return;const o=t.inventory().filter(s=>(s==null?void 0:s.name)==="hay_1").reduce((s,a)=>s+((a==null?void 0:a.count)??0),0);o&&(t.removeInventory("hay_1",o),n==null||n.onAddStat("gold",o),e==null||e.onLog(["You sell",(()=>{var s=Ir();return $(s,o),s})()," ",Tr(),"For ",(()=>{var s=Lr();return $(s,o),s})()," gold"],"meta"))}}]},{name:"story_farmer_2",label:"Farmer",description:["You approach, he holds your wrist loosely like an exhausted child.",S(Ce,{lines:["Loathsome shadowed cloaks","Golden light shimmering, blind eyes","Fear, is Death knocking?"]}),"He sits and cries."],type:"dialogue",options:[{label:"Console",goto:"story_farmer_3"},{label:"Leave",goto:"_back"}]},{name:"story_farmer_3",label:"Farmer",description:S(Ce,{lines:["Am *I* the keeper of the wheat?","... or is it the keeper of me?"]}),type:"dialogue",options:(e,t)=>{const r=!e.state.markers.includes("story_farmer_gift_1"),o=t.inventory().reduce((a,i)=>(i==null?void 0:i.name)==="hay_1"?a+(i==null?void 0:i.count):a,0)<200;return[...r?[{label:"A gift... (200 Hay)",action:()=>{const[a,i]=["recipe_worm_kabab_1","recipe_camp_fire_1"].map(h=>ae[h]);t.removeInventory("hay_1",200)===200&&(t.addInventory("recipe_worm_kabab_1",1),t.addInventory("recipe_camp_fire_1"),e.setState("markers",[...e.state.markers,"story_farmer_gift_1"]),e.onLog(["The farmer reciprocates:",(()=>{var h=Er(),l=h.firstChild;return $(h,a==null?void 0:a.label,l),$(h,i==null?void 0:i.label,null),h})()],"drop"))},isDisabled:o}]:[],{label:"Silently leave",goto:"_back.2"}]}},{name:"story_scarecrows_1",label:"Scarecrows",description:"Fighting scarecrows",type:"encounter",cooldown:20,encounters:[{name:"enc_scarecrow_1",label:"Scarecrow",health:5,chance:1,experience:10,drops:[{name:"hay_1",chance:1},{name:"food_worm_1",chance:1},{name:"recipe_hay_hand_1",chance:.05},{name:"recipe_hay_head_1",chance:.05},{name:"recipe_hay_chest_1",chance:.05}]}]}],Rr=[{name:"furniture_bench_basic_1",label:"Basic bench",type:"craft",craftingComplexity:1,cratingType:"basic",ingredients:[{name:"wood_log_1",count:50}]},{name:"furniture_stash_1",label:"Basic stash",type:"stash",storageSize:5,ingredients:[{name:"wood_log_1",count:20},{name:"hay_1",count:50}]},{name:"furniture_cook_basic_1",label:"Camp fire",type:"craft",cratingType:"food",craftingComplexity:1,ingredients:[{name:"wood_log_1",count:50},{name:"hay_1",count:50}]}],At=[Rr].flat().reduce((e,t)=>(e[t.name]=t,e),{});var Dr=L("<div class=font-bold>Stash"),Pr=L("<div>Retrieve items from stash here, place in stash from your invent");const Or=[{name:"story_home_1",label:"Home",description:"Home sweet home",type:"dialogue",options:[{label:"Build",goto:"story_home_2"},{label:"Stash",goto:"story_stash_1"},{label:"Craft",goto:"story_home_4"}]},{name:"story_stash_1",label:"Stash",type:"dialogue",description:[Dr(),Pr()]},{name:"story_home_2",label:"Building",description:"Build new appliances",type:"dialogue",options:(e,t,n,r)=>{var s;return!n||!t?[]:((s=n==null?void 0:n.recipes())==null?void 0:s.filter(a=>!!a.craftableFurniture).map(a=>At[a.craftableFurniture])).map(a=>{var i;return{label:a.label,action:()=>{r==null||r.onTask({noRepeat:!0,label:"Building",description:a.label,duration:100,onComplete:()=>Br(e,t,a)})},isDisabled:!ut(t,a),subtext:(i=a.ingredients)==null?void 0:i.map(h=>`${ae[h.name].label} (${h.count})`).join(" - ")}})??[]}},{name:"story_home_4",label:"Crafting",description:"A workshop",type:"dialogue",options:e=>{var t;return((t=e==null?void 0:e.state.furniture)==null?void 0:t.map(n=>At[n]).filter(n=>n.type==="craft").map(n=>({label:n.label,goto:`story_craft_${n.cratingType}_1`})))??[]}},{name:"story_craft_basic_1",label:"Basic crafting",description:"A very simple crafting table",type:"dialogue",options:(e,t,n,r)=>{var s;return!n||!t?[]:((s=n==null?void 0:n.recipes())==null?void 0:s.filter(a=>!!a.craftableItem).map(a=>ae[a.craftableItem]).filter(a=>a.craftType==="basic"&&a.craftComplexity===1)).map(a=>{var i;return{label:a.label,action:()=>{r==null||r.onTask({noRepeat:!0,label:"Crafting",description:a.label,duration:100,onComplete:()=>Nt(t,a)})},isDisabled:!ut(t,a),subtext:(i=a.ingredients)==null?void 0:i.map(h=>`${ae[h==null?void 0:h.name].label} (${h==null?void 0:h.count})`).join(" - ")}})??[]}},{name:"story_craft_food_1",label:"Baic cooking",description:"A very simple cooking station",type:"dialogue",options:(e,t,n,r)=>{var s;return!n||!t?[]:((s=n==null?void 0:n.recipes())==null?void 0:s.filter(a=>!!a.craftableItem).map(a=>ae[a.craftableItem]).filter(a=>a.craftType==="food"&&a.craftComplexity===1)).map(a=>{var i;return{label:a.label,action:()=>{r==null||r.onTask({noRepeat:!0,label:"Cooking",description:a.label,duration:100,onComplete:()=>Nt(t,a)})},isDisabled:!ut(t,a),subtext:(i=a.ingredients)==null?void 0:i.map(h=>`${ae[h==null?void 0:h.name].label} (${h==null?void 0:h.count})`).join(" - ")}})??[]}}],Nt=(e,t)=>{var n;e.addInventory(t.name,1),(n=t.ingredients)==null||n.forEach(r=>e.removeInventory(r.name,r.count))},Br=(e,t,n)=>{var r;e.setState("furniture",[...e.state.furniture,n.name]),(r=n.ingredients)==null||r.forEach(o=>t.removeInventory(o.name,o.count))},ut=(e,t)=>{var n;return(n=t.ingredients)!=null&&n.length?t.ingredients.every(r=>((e==null?void 0:e.inventory().reduce((s,a)=>((a==null?void 0:a.name)===r.name&&(s=s+(a.count??1)),s),0))??0)>=r.count):!0};var Ur=L("<span class=text-red-500>Venture deeper"),Nr=L("<span class=text-red-500>Hunt");const qt=[{name:"enc_rabbit_1",label:"Little rabbit",chance:.4,experience:20,drops:[],health:5,stats:{attMin:0,attMax:1,attSpeed:10}},{name:"enc_deer_1",label:"Frightened deer",chance:.2,experience:40,drops:[],health:10,stats:{attMin:0,attMax:4,attSpeed:45}},{name:"enc_dead_tree_1",label:"Dead tree",chance:1,experience:10,health:10,drops:[{name:"food_acorn_1",chance:.5}]},{name:"enc_demonic_tree_1",label:"Demonic tree",chance:.001,experience:2e3,health:400,drops:[{name:"demonic_essense_1",chance:1}]}],qr=[{type:"dialogue",name:"story_forest_1",label:"Forest border",description:"The canopy casts a shadow. Sounds, eyes ... movement",options:(e,t,n)=>[{label:"Chop wood",goto:"task_chop_wood_1",isDisabled:!!!(n!=null&&n.equipment().find(o=>o.equipSlot==="weapon"&&o.utilityType==="axe"))},{label:Ur(),goto:"story_forest_2"},...e.state.markers.includes("story_forest_3")?[{label:Nr(),goto:"story_forest_4"}]:[]]},{type:"task",name:"task_chop_wood_1",label:"Surrounded by trees",description:"Chopping wood",duration:100,masteryType:"woodcutting",cooldown:10,experience:1,utilityType:"axe",items:[{name:"wood_log_1",chance:1},{name:"food_acorn_1",chance:3}]},{name:"story_forest_2",label:"Deep forest",description:"Creatures block your path...",type:"encounter",limit:50,onComplete:e=>{e==null||e.onNavigate("story_forest_3")},cooldown:20,encounters:qt},{name:"story_forest_4",label:"Deep forest hunt",description:"You aren't scared of a few forest creatures",type:"encounter",onComplete:e=>{e==null||e.onNavigate("story_forest_3")},cooldown:20,encounters:qt},{name:"story_forest_3",label:"welcome to the deep forest",type:"dialogue",description:"You made it!",options:[{label:"Endless fight",action:(e,t,n,r)=>r.onStory(kt(0))}]}],Ft=e=>(t,n,r)=>{const o=r==null?void 0:r.player.stats.gold;return e.map(s=>{const a=ae[s.name];return{label:`${(a==null?void 0:a.label)??"UNKNOWN"} - ${s.cost}g`,action:()=>{n==null||n.addInventory(a.name,1),r==null||r.onAddStat("gold",0-s.cost),t==null||t.onLog(`You purchase the ${a.label} for ${s.cost}g`,"meta")},isDisabled:s.cost>(o??0)}})},Fr=[{type:"dialogue",name:"story_town_merchants_1",label:"Town Bazaar",description:"Souks, stalls, spices, hands... hands... hands...",options:[{label:"Tool merchant",goto:"story_town_merchant_tool_1"},{label:"Building merchant",goto:"story_town_merchant_building_1"}]},{type:"dialogue",name:"story_town_merchant_tool_1",label:"Tool Merchant",description:["A burly man, skin of leather ",S(Ce,{lines:["The very finest tools"]})],options:Ft([{name:"utility_axe_1",cost:50}])},{type:"dialogue",name:"story_town_merchant_building_1",label:"Building Merchant",description:["Beard down to his bare nipples ",S(Ce,{lines:["DIY... home improvements","Sweat...","Muscles..."]})],options:Ft([{name:"recipe_bench_basic_1",cost:100}])}],xt=[Mr,Or,qr,Fr].flat().reduce((e,t)=>(e[t.name]=t,e),{}),Ht=(e,t)=>(typeof t=="object"&&(t=JSON.stringify(t)),window.localStorage.setItem(e,`${t}`)),dt=e=>{const t=window.localStorage.getItem(e);if(!t)return t??void 0;try{return JSON.parse(t)}catch{return t}},_e=nt(),Hr=e=>{const t=N(C),n=(d,_=1)=>{const[y,m]=h(e.state.inventory,d,_);return m>0&&e.setState("inventory",y),m},r=U(()=>e.state.inventory),o=U(()=>e.state.stash);$e(d=>{const _=e.state.furniture.map(m=>At[m]).filter(m=>m.type==="stash").reduce((m,f)=>m+(f.storageSize??0),0);if(_===d)return _;const y=e.state.stash.filter(Boolean);if(_<y.length)throw new Error("Invalid stash, size too small for contents");return e.setState("stash",[...y,...new Array(_-y.length).fill(null)]),_},0);const s=(d,_=1)=>{const[y,m]=l(e.state.inventory,d,_);return m>0&&e.setState("inventory",y),m},a=(d,_=1)=>{const[y,m]=h(e.state.stash,d,_),[f,c]=l(e.state.inventory,d,_);return c!==m?(console.error(`Unable to move ${d} from invent to stash`),0):(m>0&&ve(()=>{e.setState("inventory",f),e.setState("stash",y)}),m)},i=(d,_=1)=>{const[y,m]=l(e.state.stash,d,_),[f,c]=h(e.state.inventory,d,_);return m!==c?(console.error(`Unable to move ${d} from stash to invent`),0):(m>0&&ve(()=>{e.setState("inventory",f),e.setState("stash",y)}),m)},h=(d,_,y)=>{const m=t==null?void 0:t.getItemData(_);if(!m)return console.warn("Invalid or not found item",_),[d,0];if(!y)return[d,0];if(y===1/0)return console.error("Cannot add infinite items to invent"),[d,0];let f=[...d];if(m.exclusive&&f.find(b=>(b==null?void 0:b.name)===m.name))return[f,0];let c=y;return m.maxStack&&(f=f.map(b=>{if(!(b!=null&&b.name)||!c)return b;if(b.name===m.name&&b.count<m.maxStack){let u=Math.min(b.count+c,m.maxStack);return c-=u-b.count,{...b,count:u}}return b})),c&&(f=f.map(b=>{if(!c)return b;if(b===null){const u=Math.min(c,m.maxStack??1);return c-=u,{name:m.name,count:u}}return b})),[f,y-c]},l=(d,_,y=1)=>{if(y===1/0&&(y=d.reduce((u,w)=>(w==null?void 0:w.name)===_?u+w.count:u,0)),!y)return[d,0];const m=t==null?void 0:t.getItemData(_);if(!m)return console.warn("Invalid or not found name",_),[d,0];if(d.findLastIndex(u=>(u==null?void 0:u.name)===m.name)<0)return[d,0];let c=y;const b=[...d.toReversed().map(u=>{if(!c||(u==null?void 0:u.name)!==m.name)return u;if(u.count<=c)return c-=u.count,null;const w=u.count-c;return c=0,{...u,count:w}}).reverse()].filter(Boolean);return b.push(...new Array(_n-b.length).fill(null)),[b,y-c]},g={inventory:r,stash:o,addInventory:n,removeInventory:s,addStash:a,removeStash:i};return S(_e.Provider,{value:g,get children(){return e.children}})},jt={stats:{health:St,maxHealth:St,gold:0,experience:0},equipment:[],mastery:{},recipes:[]},Vt={prohibitedItems:[],stash:new Array(2).fill(null),furniture:[],inventory:new Array(_n).fill(null),blockedEncounters:[],markers:[]},C=nt(),Fe="freeze_time",zt="state",jr=e=>{const[t,n]=q(!1),[r,o]=q([]),[s,a]=q(se),[i,h]=Qe({...jt}),[l,g]=Qe({...Vt}),[d,_]=q([se]),[y,m]=q(0),[f,c]=q(!0),[b,u]=q(Ot),[w,v]=q(15),[x,E]=q([]);Oe(()=>{setInterval(()=>{f()||M()},je)});const M=()=>{x().length&&(m(y()+1),y()>b()&&(u(b()+Ot),v(w()+1)),x().forEach(([R,F])=>F()))};setInterval(()=>{O()},1e4);const p=(R,F)=>{x().find(([V])=>V===R)||E([...x(),[R,F]])},T=R=>{E([...x().filter(([F])=>F!==R)])};document.addEventListener("visibilitychange",()=>{if(document.visibilityState==="hidden")O(),Ht(Fe,Date.now());else{const R=dt(Fe);if(R){const F=Math.min(Date.now()-R,Pt);let V=Math.floor(F/je);B(V)}else c(!1)}});const k=()=>{var F;const R=[...l.stash.map(V=>V==null?void 0:V.name),...i.equipment,...l.inventory.map(V=>V==null?void 0:V.name)].filter(Boolean);g("uniqueItems",(F=l.uniqueItems)==null?void 0:F.filter(V=>R.includes(V.name)))},P=()=>{const R=dt(zt);R&&(R.state.blockedEncounters=R.state.blockedEncounters??[],R.state.markers=R.state.markers??[],ve(()=>{a(R.story),h(R.player),g(R.state),_(R.nav),m(R.ticks)}));const F=dt(Fe);if(F){const V=Math.min(Date.now()-F,Pt);let le=Math.floor(V/je);B(le)}else c(!1)},I=()=>{n(!0),ve(()=>{h({...jt}),g({...Vt}),m(0),H(se),o([])}),O(),n(!1)};window.cs=I;const O=()=>{console.log("Saving..."),k();const R={player:ye(i),state:ye(l),ticks:y(),story:s(),nav:d()};Ht(zt,R)},B=R=>{R>0?requestIdleCallback(()=>{let F=1e3;for(;R>0&&F>0;)M(),R--,F--;B(R)}):c(!1)};window.addEventListener("load",P),window.addEventListener("beforeunload",()=>{O(),window.localStorage.setItem(Fe,`${Date.now()}`)});const H=R=>{if(R==="_start"&&(R=se),R===se){_([se]),a(se);return}const F=/^_back/.test(R);if(!F&&!xt[R]){console.error(`Unknown story ${R}`);return}if(F){const[V,le]=R.split("."),oe=Math.min(parseInt(le??"1"),d().length+1);R=d().at(-1-oe)??se,d().length>1&&_(d().slice(0,-oe))}else d().at(-1)!==R&&_([...d(),R]);a(R)},K={state:l,setState:g,year:w,startActivity:p,endActivity:T,onNavigate:H,nav:d,onLog:(R,F="basic")=>{var oe;const V=new Date,le={msg:R,time:[V.getHours(),V.getMinutes(),V.getSeconds()].join(":"),type:F};o([...r().slice(Math.min(((oe=r())==null?void 0:oe.length)-999,0)),le])},log:r,pause:f,setNav:_,onClearState:I,onCreateItem:R=>{g("uniqueItems",[...l.uniqueItems??[],R])},getItemData:R=>{var F;return((F=l.uniqueItems)==null?void 0:F.find(V=>V.name===R))??ae[R]}};return S(z,{get when(){return!t()},get children(){return S(C.Provider,{value:K,get children(){return S(Hr,{state:l,setState:g,get children(){return S(Vr,{player:i,setPlayer:h,get children(){return S(zr,{story:s,setStory:a,get children(){return e.children}})}})}})}})}})},ue=nt(),Vr=e=>{const t=N(C),[n,r]=Qe({unarmed:0,sword:0,axe:0,pickaxe:0,battleaxe:0,scythe:0,spear:0,flail:0,mace:0,staff:0,alchemy:0,smithing:0,crafting:0,woodcutting:0,cooking:0,dagger:0}),o=U(()=>{var u;return((u=e.player.recipes)==null?void 0:u.map(w=>ae[w]))??[]}),s=u=>{e.setPlayer("recipes",[...e.player.recipes??[],u].filter((w,v,x)=>x.indexOf(w)===v))};Oe(()=>{const u=ye(n),w=Object.entries(u).reduce((v,[x])=>{const E=e.player.mastery[x];return v[x]=ce(E,be),v},u);r(w)});const a=U(()=>{var u;return((u=e.player.equipment)==null?void 0:u.map(w=>t==null?void 0:t.getItemData(w)))??[]}),i=U(()=>{var u;return((u=a().find(w=>w.equipSlot==="weapon"))==null?void 0:u.masteryType)??"unarmed"}),h=u=>wn(u,n[u]),l=U(()=>{var k;const u=a();let w=u.reduce((P,I)=>{var O;return P+(((O=I.stats)==null?void 0:O.attMin)??0)},1),v=u.reduce((P,I)=>{var O;return P+(((O=I.stats)==null?void 0:O.attMax)??0)},1);const x=i(),E=h(x);w+=(E==null?void 0:E.attMin)??0,v+=(E==null?void 0:E.attMax)??0;const M=1+Math.pow((((k=e.player.stats)==null?void 0:k.strength)??0)/100,.7),p=Math.round(w*M),T=Math.round(v*M);return[p,T]}),g=U(()=>{var R;const u=a(),w=100,v=Math.min(w,Math.max(1,((R=e.player.stats)==null?void 0:R.dexterity)??0)),x=1,E=xe/5,M=v/w,p=E*M,T=xe/5,k=Math.min(u.reduce((F,V)=>{var le;return F+(((le=V.stats)==null?void 0:le.attSpeed)??0)},0),1),P=k*T,I=xe/5,O=i(),B=h(O),H=(B.attSpeed??0)*I,j=xe/2.5-1,ee=M*.33+k*.33+(B.attSpeed??0)*.33+.01,G=j*ee;return Math.max(xe-p-P-G-H,x)}),d=(u,w=1)=>{const v=e.player.stats[u]??0,x=v+w;u==="experience"&&ce(x)>ce(v)&&(t==null||t.setState("points",(t.state.points??0)+1),t==null||t.onLog("You have levels up! +1 attr. points","meta"),ve(()=>{e.setPlayer("stats","maxHealth",(e.player.stats.maxHealth??10)+5),e.setPlayer("stats","health",e.player.stats.health+5)})),e.setPlayer("stats",u,x)},_=(u,w=1)=>{const v=(e.player.mastery[u]??0)+w,x=ce(v,be);ve(()=>{x!==n[u]&&r(u,x),e.setPlayer("mastery",u,v)})},y=(u,w=1/0)=>Math.min(a().reduce((v,x)=>{var E;return v+(((E=x.stats)==null?void 0:E[u])??0)},0),w),m=U(()=>{const u={...e.player.stats},w=e.player.stats.constitution,v=e.player.stats.maxHealth??St,[x,E]=l();return u.maxHealth=y("maxHealth")+(w?Math.round(v*(1+w/Qn)):v),u.attSpeed=g(),u.attMin=x,u.attMax=E,u.magRes=y("magRes"),u.physRes=y("physRes"),u}),f=u=>a().find(w=>w.equipSlot===u.equipSlot)?!1:(e.setPlayer("equipment",[...e.player.equipment,u.name]),Object.entries(u.stats??{}).forEach(([w,v])=>d(w,v)),!0),c=u=>!e.player.equipment.includes(u.name)?!1:(e.setPlayer("equipment",[...e.player.equipment.filter(v=>v!==u.name)]),Object.entries(u.stats??{}).forEach(([v,x])=>d(v,0-x)),!0),b={attackRate:g,attackDamage:l,player:e.player,equipment:a,stats:m,onAddStat:d,onAddMastery:_,onEquip:f,onUnequip:c,recipes:o,getMasteryPerk:h,weaponMastery:i,onAddRecipe:s};return S(ue.Provider,{value:b,get children(){return e.children}})},ke=nt(),zr=e=>{const t=N(C),n=N(ue),r=N(_e),[o,s]=q();$e(()=>{const m=e.story()??se;m!=="task"&&s(xt[m]??xt[se])});const a=()=>{var c;const m=o();if(!m)return;if(m.type==="task")return{name:"task",label:m.label,health:m.duration??0,chance:1,drops:m.items};if(typeof m.encounters=="function")return m.encounters(t,r,n,y);const f=Math.random();if(!(m.type!=="encounter"||!((c=m.encounters)!=null&&c.length)))return m.encounters.filter(b=>!(t!=null&&t.state.blockedEncounters.includes(b.name))).sort((b,u)=>b.chance-u.chance).find(b=>f<=b.chance)},i=m=>{const{attMin:f,attMax:c}=m.stats??{};if(!(!f||!c))return f+Math.round(Math.random()*(f-c))},h=m=>l(m==null?void 0:m.drops),l=m=>{const f=o();if(!f)return;m=m??f.items??[];let c=[];const b=f.masteryType?(n==null?void 0:n.player.mastery[f.masteryType])??0:0;for(let u of m){let w=u.chance;for(b&&(w=w+nr(u.name,f.masteryType,b));w>0;)Math.random()<=w&&c.push(u),w--}return c==null?void 0:c.map(u=>{const w=t==null?void 0:t.getItemData(u.name);if(!w){console.error(`Unable to find drop ${u.name}`);return}return w.name}).filter(Boolean)},y={story:o,getEncounter:a,getDamage:i,getDrops:h,getItems:l,onTask:m=>{t==null||t.setNav([...(t==null?void 0:t.nav())??[],"task"]),e.setStory("task"),s({name:"task",type:"task",...m,onComplete:m.noRepeat?m.onComplete??(()=>t==null?void 0:t.onNavigate("_back")):void 0})},getGold:m=>m&&m[0]+Math.round(Math.random()*(m[1]-m[0]))||void 0,onStory:m=>{t==null||t.setNav([...(t==null?void 0:t.nav())??[],m.name]),e.setStory(m.name),s(m)}};return S(ke.Provider,{value:y,get children(){return e.children}})};var Wr=L('<div class="flex flex-row mt-auto gap-2"><div class="w-full border content-center cursor-pointer h-12 text-lg font-bold mt-auto">Go back</div><div class="w-full border content-center cursor-pointer h-12 text-lg font-bold mt-auto">Town'),Xr=L('<div class="flex flex-col gap-5 p-2 h-full overflow-y-auto">'),Gr=L("<div class=text-gray-500>Nothing here..."),Kr=L('<span class="text-xs text-gray-400">'),Yr=L('<div class="w-full border content-center h-12 text-lg font-bold flex flex-col justify-center">');const Zr=()=>{const e=N(C),t=N(_e),n=N(ue),r=N(ke),o=a=>{if(a.goto)return e==null?void 0:e.onNavigate(a.goto);if(a.action&&e&&t&&n&&r)return a.action(e,t,n,r)},s=U(()=>{var i;const a=(i=r==null?void 0:r.story())==null?void 0:i.options;return Array.isArray(a)?a:e&&t&&n&&r?(a==null?void 0:a(e,t,n,r))??[]:[]});return(()=>{var a=Xr();return $(a,S(z,{get when(){return s().length},get fallback(){return Gr()},get children(){return S(re,{get each(){return s()},children:i=>(()=>{var h=Yr();return h.$$click=()=>!i.isDisabled&&o(i),$(h,()=>i.label,null),$(h,S(z,{get when(){return i.subtext},get children(){var l=Kr();return $(l,()=>i.subtext),l}}),null),Z(l=>{var g=!!i.isDisabled,d=!i.isDisabled;return g!==l.e&&h.classList.toggle("text-gray-500",l.e=g),d!==l.t&&h.classList.toggle("cursor-pointer",l.t=d),l},{e:void 0,t:void 0}),h})()})}}),null),$(a,S(z,{get when(){var i;return((i=r==null?void 0:r.story())==null?void 0:i.name)!==se},get children(){var i=Wr(),h=i.firstChild,l=h.nextSibling;return h.$$click=()=>o({label:"Go back",goto:"_back"}),l.$$click=()=>o({label:"Back to town",goto:"_start"}),i}}),null),a})()};pe(["click"]);var Jr=L("<div>");const ne=e=>(()=>{var t=Jr();return rt(t,"click",e.onClick),$(t,()=>e.children),Z(()=>jn(t,`${e.class??""} bg-black rounded py-1 px-2 cursor-pointer hover:outline hover:outline-blue-500 font-bold text-xs h-full`)),t})();pe(["click"]);var Qr=L("<div class=text-sm>"),Cr=L("<button class=m-auto> "),eo=L("<button class=m-auto>equip"),to=L('<div class="px-2 py-1 bg-blue-900 border border-blue-500 rounded w-full flex flex-row justify-between items-center mb-2"><span class="font-bold text-xl text-black">Stash</span><div class="flex flex-row gap-4">'),no=L('<div class="px-2 py-1 bg-red-900 border border-red-500 w-full flex flex-row justify-between items-center rounded"><span class="font-bold text-xl text-black">Drop</span><div class="flex flex-row gap-4">'),ro=L('<div class="absolute bottom-0 left-0 w-full border-t content-center p-2 bg-slate-500"><div class="flex flex-col gap-2"><div class="flex flex-row justify-center relative"><span class="absolute left-0 top-0 font-bold cursor-pointer border-2 rounded-xl px-2 hover:bg-white hover:text-black">X</span><div class=font-bold> [<!> / <!>]</div></div><div class="flex flex-col gap-1 justify-between"><div class="w-full flex flex-row justify-between gp-2 mb-2">'),oo=L('<div class="h-full relative"><div class="flex flex-col gap-2 h-7/8 overflow-auto p-2">'),so=L('<span class="text-red-700 text-xs mr-1 cursor-pointer">[drop]'),ao=L('<div class="border p-1 cursor-pointer flex flex-col"><div class="flex flex-row justify-between items-center"><div class=text-left></div><div class="flex flex-row gap-2 items-center"><div class=text-sm>[<!>]</div>(<!>)'),io=L('<div class="border p-1 flex flex-row justify-between border-gray-700 text-gray-700">Empty');const lo=()=>{const e=N(C),t=N(_e),n=N(ue),r=N(ke),[o,s]=q(),a=f=>{f<0||!(t!=null&&t.inventory().at(f))||s(f)},i=U(()=>{const f=o()??-1;if(f<0)return;const c=t==null?void 0:t.inventory().at(f),b=c?e==null?void 0:e.getItemData(c.name):void 0;if(c&&b)return{item:b,count:c.count}}),h=()=>{var b,u;const f=i();if(!(f!=null&&f.item)||!e||!t||!n||!r)return;const c=f.count;(u=(b=f.item).use)!=null&&u.call(b,e,t,n,r)&&c<=1&&s(void 0)},l=()=>{const f=i(),c=f?f.item:null;c!=null&&c.equipSlot&&n!=null&&n.onEquip(c)&&(t==null||t.removeInventory(c.name,1),s(void 0))},g=f=>{const c=i();c!=null&&c.item&&(t==null||t.removeInventory(c.item.name,f),f>=(c.count??1)&&s(void 0))},d=f=>{f&&(t==null||t.removeInventory(f.name,f.count))},_=U(()=>{var f,c;return!(!i()||((c=(f=i())==null?void 0:f.item)==null?void 0:c.category)==="unique")}),y=f=>{const c=i();c&&(f=f===1/0?(t==null?void 0:t.inventory().reduce((b,u)=>(u==null?void 0:u.name)===c.item.name?b+(u.count??0):b,0))??0:f,c!=null&&c.item&&(t==null||t.addStash(c.item.name,f)))},m=U(()=>e==null?void 0:e.nav().includes("story_home_1"));return(()=>{var f=oo(),c=f.firstChild;return c.$$click=()=>s(void 0),$(c,S(re,{get each(){return(t==null?void 0:t.inventory())??[]},children:(b,u)=>S(Sn,{item:b,onSelect:()=>a(u()),onDrop:()=>d(b)})})),$(f,S(z,{get when(){return i()},get children(){var b=ro(),u=b.firstChild,w=u.firstChild,v=w.firstChild,x=v.nextSibling,E=x.firstChild,M=E.nextSibling,p=M.nextSibling,T=p.nextSibling;T.nextSibling;var k=w.nextSibling,P=k.firstChild;return v.$$click=()=>s(void 0),$(x,()=>{var I;return(I=i())==null?void 0:I.item.label},E),$(x,()=>{var I;return(I=i())==null?void 0:I.count},M),$(x,()=>{var I;return((I=i())==null?void 0:I.item.maxStack)??1},T),$(u,S(z,{get when(){return i().item.stats},get children(){var I=Qr();return $(I,()=>Object.entries(i().item.stats??{}).filter(([O,B])=>!!B).map(([O,B])=>`[${O}: ${B}]`).join("")),I}}),k),$(P,S(z,{get when(){var I;return(I=i())==null?void 0:I.item.use},get children(){var I=Cr(),O=I.firstChild;return I.$$click=h,$(I,()=>{var B;return((B=i())==null?void 0:B.item.useVerb)??"Use"},O),I}}),null),$(P,S(z,{get when(){var I;return((I=i())==null?void 0:I.item).equipSlot},get children(){var I=eo();return I.$$click=l,I}}),null),$(k,S(z,{get when(){return m()},get children(){var I=to(),O=I.firstChild,B=O.nextSibling;return $(B,S(ne,{onClick:()=>y(1),children:"One"}),null),$(B,S(ne,{onClick:()=>{var H;return y(((H=i())==null?void 0:H.count)??1)},children:"Stack"}),null),$(B,S(ne,{onClick:()=>y(1/0),children:"All"}),null),I}}),null),$(k,S(z,{get when(){return _()},get children(){var I=no(),O=I.firstChild,B=O.nextSibling;return $(B,S(ne,{onClick:()=>g(1),children:"One"}),null),$(B,S(ne,{onClick:()=>{var H;return g(((H=i())==null?void 0:H.count)??1)},children:"Stack"}),null),$(B,S(ne,{onClick:()=>g(1/0),children:"All"}),null),I}}),null),b}}),null),f})()},Sn=e=>{const t=N(C),n=a=>{a.stopPropagation(),e.onSelect()},r=U(()=>e.item?t==null?void 0:t.getItemData(e.item.name):null),o=U(()=>{const a=r();return a?a.category??a.equipSlot??"unknown":null}),s=U(()=>{const a=r();return a?a.category??(a.equipSlot?"equip":"unknown"):null});return S(z,{get when(){return r()},get fallback(){return io()},get children(){var a=ao(),i=a.firstChild,h=i.firstChild,l=h.nextSibling,g=l.firstChild,d=g.firstChild,_=d.nextSibling;_.nextSibling;var y=g.nextSibling,m=y.nextSibling;return m.nextSibling,a.$$click=n,$(h,S(z,{get when(){return e.onDrop},get children(){var f=so();return f.$$click=c=>{c.stopPropagation(),e.onDrop()},f}}),null),$(h,()=>r().label,null),$(g,o,_),$(l,()=>{var f;return(f=e.item)==null?void 0:f.count},m),Z(f=>{var c=s()==="book",b=s()==="resource",u=s()==="food",w=s()==="equip";return c!==f.e&&g.classList.toggle("text-yellow-500",f.e=c),b!==f.t&&g.classList.toggle("text-green-500",f.t=b),u!==f.a&&g.classList.toggle("text-red-500",f.a=u),w!==f.o&&g.classList.toggle("text-blue-500",f.o=w),f},{e:void 0,t:void 0,a:void 0,o:void 0}),a}})};pe(["click"]);var co=L('<div class="w-full border rounded relative text-black bg-gray-500"><div class="ease-linear w-0 h-full rounded"></div><div class="absolute left-1/2 top-1/2 -translate-1/2 whitespace-nowrap">');const It=e=>{const t=N(C),[n,r]=q(e.ticks),o=()=>{let s=n();s<=0&&(e.onFinish(),s=e.ticks+1),r(s-1)};return Oe(()=>t==null?void 0:t.startActivity(e.name,o)),tt(()=>t==null?void 0:t.endActivity(e.name)),S(Pe,{get max(){return e.ticks},get value(){return e.ticks-n()},get type(){return e.type},get showPc(){return e.showPc},get showNumber(){return e.showNumber},get label(){return e.label}})},Pe=e=>{const t=U(()=>Math.min(e.value/e.max*100,100));return(()=>{var n=co(),r=n.firstChild,o=r.nextSibling;return $(o,S(Ue,{get children(){return[S(Y,{get when(){return e.showPc},get children(){return[ge(()=>e.label)," (",ge(()=>t().toFixed(0)),"%)"]}}),S(Y,{get when(){return e.showNumber},get children(){return[ge(()=>e.label)," ",ge(()=>e.value)]}})]}})),Z(s=>{var a=!e.isSmall,i=t()+"%",h=!e.type,l=e.type==="green",g=e.type==="yellow",d=e.type==="blue",_=e.type==="red";return a!==s.e&&n.classList.toggle("h-full",s.e=a),i!==s.t&&Vn(r,"width",s.t=i),h!==s.a&&r.classList.toggle("bg-white",s.a=h),l!==s.o&&r.classList.toggle("bg-green-500",s.o=l),g!==s.i&&r.classList.toggle("bg-yellow-500",s.i=g),d!==s.n&&r.classList.toggle("bg-blue-500",s.n=d),_!==s.s&&r.classList.toggle("bg-red-500",s.s=_),s},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0}),n})()};var uo=L('<div class="flex flex-col justify-between items-center cursor-pointer"><div class="text-xl font-bold"></div><div class="h-4 w-32">'),fo=L('<div class="flex flex-row justify-between items-center font-bold mb-2"><div>Level</div><div>Stats'),ho=L('<div class="flex flex-col h-full"><div class="h-7/8 p-2"></div><div class="h-1/8 flex flex-row justify-between gap-2 p-2"><button>Skills</button><button>Mastery</button><button>Recipes'),bo=L('<div class="flex flex-row justify-between items-center cursor-pointer"><div></div><div class="h-4 w-32">'),go=L('<div class="flex flex-row justify-between items-center border-b border-gray-700"><div></div><div class=text-xs>'),mo=L('<div class="flex flex-row justify-between items-center"><div>');const po=()=>{const[e,t]=q("mastery"),n=N(ue),[r,o]=q(),s=U(()=>Object.entries((n==null?void 0:n.player.mastery)??{}).map(([l,g])=>{const d=Ie[l];return{label:(d==null?void 0:d.label)??"",progress:$t(g,be)*100,level:ce(g,be),name:l}})??[]),a=U(()=>{const l=r();if(!l)return;const g=(n==null?void 0:n.player.mastery[l])??0,d=Ie[l];return{label:(d==null?void 0:d.label)??"",progress:$t(g,be)*100,level:ce(g,be),name:l}}),i=l=>{o(void 0),t(l)},h=U(()=>{var _,y;const l=r();if(l===void 0)return;const g=ce((n==null?void 0:n.player.mastery[l])??0,be),d=(_=Ie[l])==null?void 0:_.bonus.findLastIndex(m=>m.level<=g);return(y=Ie[l])==null?void 0:y.bonus.slice(0,(d??0)+2).map((m,f,c)=>({level:m.level,stats:(m.dropModifiers??[]).map(b=>{var u;return`[${(u=ae[b.name])==null?void 0:u.label}: +${b.chance}]`})+Object.entries(m.stats??{}).filter(([b,u])=>!!u).map(([b,u])=>`[${b}: ${u}]`).join(""),isLast:f===c.length-1}))});return(()=>{var l=ho(),g=l.firstChild,d=g.nextSibling,_=d.firstChild,y=_.nextSibling,m=y.nextSibling;return $(g,S(Ue,{get children(){return[S(Y,{get when(){return e()==="skills"},children:"TODO"}),S(Y,{get when(){return ge(()=>e()==="mastery")()&&!r()},get children(){return S(re,{get each(){return s()},children:f=>(()=>{var c=bo(),b=c.firstChild,u=b.nextSibling;return c.$$click=()=>o(f.name),$(b,()=>f.label),$(u,S(Pe,{get label(){return`${f.level}`},type:"yellow",max:100,get value(){return f.progress},showPc:!0})),c})()})}}),S(Y,{get when(){return ge(()=>e()==="mastery")()&&r()},get children(){return[(()=>{var f=uo(),c=f.firstChild,b=c.nextSibling;return $(c,()=>{var u;return(u=a())==null?void 0:u.label}),$(b,S(Pe,{get label(){return`${a().level}`},type:"yellow",max:100,get value(){return a().progress},showPc:!0})),f})(),fo(),S(re,{get each(){return h()},children:f=>(()=>{var c=go(),b=c.firstChild,u=b.nextSibling;return $(b,()=>f.level),$(u,(()=>{var w=ge(()=>!!f.isLast);return()=>w()?"???":f.stats})()),c})()})]}}),S(Y,{get when(){return e()==="recipes"},get children(){return S(re,{get each(){return n==null?void 0:n.recipes()},children:f=>(()=>{var c=mo(),b=c.firstChild;return $(b,()=>f.label),c})()})}})]}})),_.$$click=()=>i("skills"),y.$$click=()=>i("mastery"),m.$$click=()=>i("recipes"),Z(f=>{var c=e()==="skills",b=e()==="mastery",u=e()==="recipes";return c!==f.e&&_.classList.toggle("selected",f.e=c),b!==f.t&&y.classList.toggle("selected",f.t=b),u!==f.a&&m.classList.toggle("selected",f.a=u),f},{e:void 0,t:void 0,a:void 0}),l})()};pe(["click"]);var _o=L('<span class="text-red-800 font-bold">'),vo=L('<span class="text-green-800 font-bold">'),Wt=L('<span class="text-red-800 font-bold m-1">'),yo=L('<span class="font-bold m-1">'),wo=L("<span class=font-bold>"),So=L("<div class=text-red-800>"),$o=L("<div class=h-8><div class=h-2>"),ko=L("<div class=h-2>"),Ao=L('<div class="h-8 mt-5">'),xo=L('<div class="flex flex-col gap-1 p-1 h-full"><div class=bg-black>Attacking (<!>)');const Io=()=>{const e=N(C),t=N(ke),n=N(ue),r=N(_e),[o,s]=q(),[a,i]=q(25),[h,l]=q(0),[g,d]=q(0),[_,y]=q(),[m,f]=q();$e(v=>{var x,E;return(x=t==null?void 0:t.story())!=null&&x.name&&(e!=null&&e.pause())&&!v?(s((E=t==null?void 0:t.story())==null?void 0:E.name),e==null||e.startActivity(`${o()}_catchup`,c),!v):!(e!=null&&e.pause())&&v?(e==null||e.endActivity(`${o()}_catchup`),!v):v},!1);const c=()=>{a()<=0&&m()?b():i(a()-1)};Oe(()=>{var v,x;s((v=t==null?void 0:t.story())==null?void 0:v.name),i((n==null?void 0:n.attackRate())??25),f(t==null?void 0:t.getEncounter()),y((x=m())==null?void 0:x.health)});const b=()=>{var O,B,H;const v=!(e!=null&&e.pause()),[x,E]=[n,t==null?void 0:t.story()],M=m(),p=_();if(!x||!E)return;if(i((n==null?void 0:n.attackRate())??25),!M&&E.limit&&g()>=E.limit){(O=E.onComplete)==null||O.call(E,e,r,n,t);return}if(!M){f(t==null?void 0:t.getEncounter()),y((B=m())==null?void 0:B.health);return}if(!p)return;const[T,k]=(n==null?void 0:n.attackDamage())??[0,1],P=T+Math.round(Math.random()*(k-T)),I=p-Math.min(P,p);if(v&&(e==null||e.onLog(["You hit the ",(()=>{var j=_o();return $(j,M.label),j})()," for ",(()=>{var j=vo();return $(j,P),j})()," damage"],"basic")),n==null||n.onAddMastery(n==null?void 0:n.weaponMastery(),P),I<=0){v&&(e==null||e.onLog(["You killed the",(()=>{var K=Wt();return $(K,M.label),K})()],"good")),M.isUnique&&(e==null||e.setState("blockedEncounters",[...e.state.blockedEncounters,M.name])),d(g()+1),f(void 0),M.experience&&(n==null||n.onAddStat("experience",M.experience));const j=t==null?void 0:t.getGold(M.gold);j&&(n==null||n.onAddStat("gold",j));const ee=(H=t==null?void 0:t.getDrops(M))==null?void 0:H.filter(K=>{var R;return!((R=e==null?void 0:e.state.prohibitedItems)!=null&&R.includes(K))}),G=ee==null?void 0:ee.filter(K=>!!(r!=null&&r.addInventory(K)));if((G!=null&&G.length||j)&&v){let K="";G!=null&&G.length?(K=G.map(R=>{var F;return(F=e==null?void 0:e.getItemData(R))==null?void 0:F.label}).join(", "),j&&(K=`${K} & ${j}g`)):j&&(K=`${j}g`),e==null||e.onLog(["It dropped:",(()=>{var R=yo();return $(R,K),R})()],"drop")}if(!(G!=null&&G.length)&&(ee!=null&&ee.length)){e==null||e.onLog("You retreat with a full bag","meta"),e==null||e.onNavigate("_back");return}if(E.noRepeat)return;l(E.cooldown??0),e==null||e.startActivity(`${o()}_wait`,w)}y(Math.max(I,0))},u=()=>{var k;const v=!(e!=null&&e.pause()),[x,E]=[n==null?void 0:n.player,t==null?void 0:t.story()];if(!x||!E)return;const{attMin:M,attMax:p}=((k=m())==null?void 0:k.stats)??{};if(M===void 0||p===void 0)return;const T=M+Math.round(Math.random()*(p-M));if(v&&(e==null||e.onLog([(()=>{var P=Wt();return $(P,m().label),P})()," hits you for ",(()=>{var P=wo();return $(P,T),P})()," damage!"],"bad")),x.stats.health<=T){e==null||e.onNavigate("_start");return}n==null||n.onAddStat("health",-T)},w=()=>{if(h()<=0)return e==null||e.endActivity(`${o()}_wait`),b();l(h()-1)};return tt(()=>{e==null||e.endActivity(`${o()}_wait`)}),S(z,{get when(){return!(e!=null&&e.pause())},get children(){var v=xo(),x=v.firstChild,E=x.firstChild,M=E.nextSibling;return M.nextSibling,$(x,g,M),$(x,S(z,{get when(){var p;return(p=t==null?void 0:t.story())==null?void 0:p.limit},get children(){return[" / ",ge(()=>{var p;return(p=t==null?void 0:t.story())==null?void 0:p.limit})]}}),M),$(v,S(z,{get when(){var p;return ge(()=>{var T;return!!(!m()&&((T=t==null?void 0:t.story())!=null&&T.limit))})()&&g()>=(((p=t==null?void 0:t.story())==null?void 0:p.limit)??0)},children:"There is nothing left here to destroy"}),null),$(v,S(z,{get when(){return m()},fallback:"Waiting.. Searching.. Wondering..",get children(){return[(()=>{var p=So();return $(p,()=>{var T;return(T=m())==null?void 0:T.label}),p})(),(()=>{var p=$o(),T=p.firstChild;return $(p,S(Pe,{type:"red",get max(){return(n==null?void 0:n.player.stats.maxHealth)??10},get value(){return(n==null?void 0:n.player.stats.health)??0},label:"You",showNumber:!0}),T),$(T,S(It,{get name(){return`${o()}_att`},get ticks(){return a()},onFinish:b,type:"yellow",isSmall:!0})),p})(),(()=>{var p=Ao();return $(p,S(Pe,{type:"red",get max(){return m().health},get value(){return _()},get label(){var T;return(T=m())==null?void 0:T.label},showNumber:!0}),null),$(p,S(z,{get when(){var T,k;return(k=(T=m())==null?void 0:T.stats)==null?void 0:k.attSpeed},get children(){var T=ko();return $(T,S(It,{get name(){return`${o()}_enc`},get ticks(){return m().stats.attSpeed},onFinish:u,type:"yellow",isSmall:!0})),T}}),null),p})()]}}),null),v}})};var To=L('<span class="text-red-800 font-bold m-1">'),Lo=L('<span class="font-bold m-1">'),Eo=L("<div class=text-red-800>"),Mo=L("<div class=h-8>"),Ro=L('<div class="flex flex-col gap-1 p-1 h-full"><div class=bg-black>');const Do=()=>{const e=N(C),t=N(_e),n=N(ue),r=N(ke),[o,s]=q(),[a,i]=q(!1),[h,l]=q(0),[g,d]=q(0),_=U(()=>{var b,u,w;const c=(b=r==null?void 0:r.story())==null?void 0:b.masteryType;if(c){const v=tr(c,(n==null?void 0:n.player.mastery[c])??0);return Math.max(1,(((u=r==null?void 0:r.story())==null?void 0:u.duration)??100)-(v.durationModifier??0))}return((w=r==null?void 0:r.story())==null?void 0:w.duration)??100});$e(()=>{var c;(c=r==null?void 0:r.story())!=null&&c.utilityType&&(n!=null&&n.equipment().find(b=>{var u;return b.utilityType===((u=r==null?void 0:r.story())==null?void 0:u.utilityType)})||e==null||e.onNavigate("_back"))}),$e(c=>{var b,u;return _()?(b=r==null?void 0:r.story())!=null&&b.name&&(e!=null&&e.pause())&&!c?(s((u=r==null?void 0:r.story())==null?void 0:u.name),d(g()??_()),e==null||e.startActivity(`${o()}_catchup`,y),!c):!(e!=null&&e.pause())&&c?(e==null||e.endActivity(`${o()}_catchup`),!c):c:c},!1);const y=()=>{g()<=0&&a()?m():d(g()-1)};Oe(()=>{var c;s((c=r==null?void 0:r.story())==null?void 0:c.name),i(!0)});const m=()=>{var w,v;const c=r==null?void 0:r.story();if(!n||!r||!c)return;if(!a()){d(_()),i(!0);return}i(!1),e==null||e.onLog(["You finished",(()=>{var x=To();return $(x,c.description),x})()],"good"),c.masteryType&&(n==null||n.onAddMastery(c.masteryType,c.experience??0));const b=(w=r.getItems())==null?void 0:w.filter(x=>{var E;return!((E=e==null?void 0:e.state.prohibitedItems)!=null&&E.includes(x))}),u=b==null?void 0:b.filter(x=>!!(t!=null&&t.addInventory(x)));if(u!=null&&u.length){const x=u.map(E=>{var M;return((M=e==null?void 0:e.getItemData(E))==null?void 0:M.label)??"Unknown"});e==null||e.onLog(["You gained:",(()=>{var E=Lo();return $(E,x==null?void 0:x.join(", ")),E})()],"drop")}if(c.noRepeat)return((v=c.onComplete)==null?void 0:v.call(c,e,t,n,r))??(e==null?void 0:e.onNavigate("_back"));if(!(u!=null&&u.length)&&(b!=null&&b.length)){e==null||e.onLog("You retreat with a full bag","meta"),e==null||e.onNavigate("_back");return}l(c.cooldown??0),e==null||e.startActivity(`${o()}_wait`,f)},f=()=>{if(h()<=0)return e==null||e.endActivity(`${o()}_wait`),m();l(h()-1)};return tt(()=>{e==null||e.endActivity(`${o()}_wait`),e==null||e.endActivity(`${o()}_catchup`)}),S(z,{get when(){return!(e!=null&&e.pause())},get children(){var c=Ro(),b=c.firstChild;return $(b,()=>{var u;return(u=r==null?void 0:r.story())==null?void 0:u.label}),$(c,S(z,{get when(){return a()},fallback:"Waiting.. Searching.. Wondering..",get children(){return[(()=>{var u=Eo();return $(u,()=>{var w;return(w=r==null?void 0:r.story())==null?void 0:w.description}),u})(),(()=>{var u=Mo();return $(u,S(It,{get name(){return`${o()}_task`},get ticks(){return _()},onFinish:m,label:"Task",showPc:!0})),u})()]}}),null),c}})};var Po=L('<div class="text-lg font-bold mt-5">Weapon'),Oo=L('<div class="text-lg font-bold mt-5">Armour'),Bo=L('<div class="flex flex-col h-full"><div class="h-7/8 p-2"></div><div class="h-1/8 flex flex-row justify-between gap-2 p-2"><button>Equip</button><button>Attr.</button><button>Stats'),Uo=L('<div class="flex flex-row justify-between border-gray-700"><div></div><div>'),No=L("<button class=h-8>+"),qo=L('<div class="flex flex-row justify-between border-gray-700 p-2 items-center"><div></div><div class="flex flex-row gap-2 items-center">'),Fo=L('<div class="flex flex-row justify-between items-center border-gray-700"><div></div><div class="text-xs text-gray-500">');const Ho=()=>{const[e,t]=q("stats"),n=N(ue),r=N(_e),o=N(C),s=U(()=>{const g=n==null?void 0:n.attackDamage(),d=1e3/je,_=1/(((n==null?void 0:n.attackRate())??xe)/d);return[{label:"Health",value:(n==null?void 0:n.player.stats.health)??0},{label:"Max health",value:(n==null?void 0:n.player.stats.maxHealth)??0},{label:"",value:""},{label:"Att. min",value:(g==null?void 0:g.at(0))??0},{label:"Att. max",value:(g==null?void 0:g.at(1))??0},{label:"Att. rate",value:`${(_==null?void 0:_.toFixed(2))??0} p/s`},{label:"",value:""},{label:"Phys. res",value:(n==null?void 0:n.player.stats.physRes)??0},{label:"Mag. res",value:(n==null?void 0:n.player.stats.magRes)??0}]}),a=U(()=>[{label:"Strength",value:(n==null?void 0:n.player.stats.strength)??0,name:"strength"},{label:"Agility",value:(n==null?void 0:n.player.stats.agility)??0,name:"agility"},{label:"Dexterity",value:(n==null?void 0:n.player.stats.dexterity)??0,name:"dexterity"},{label:"Intelligence",value:(n==null?void 0:n.player.stats.intelligence)??0,name:"intelligence"},{label:"Charisma",value:(n==null?void 0:n.player.stats.charisma)??0,name:"charisma"},{label:"Constitution",value:(n==null?void 0:n.player.stats.constitution)??0,name:"constitution"}]),i=g=>{r!=null&&r.addInventory(g.name,1)&&(n==null||n.onUnequip(g))},h=U(()=>{const g=["weapon","offhand"],d=["head","shoulder","chest","hand","leg","foot"];return[{label:Po(),isDisabled:!1,isEmpty:!0},...g.map(_=>{const y=_&&(n==null?void 0:n.equipment().find(m=>m.equipSlot===_));return{label:(y==null?void 0:y.label)??_,isDisabled:!y,subtext:Object.entries((y==null?void 0:y.stats)??{}).map(([m,f])=>`[${m}: ${f}]`).join(""),onClick:y?()=>i(y):void 0}}),{label:Oo(),isDisabled:!1,isEmpty:!0},...d.map(_=>{const y=_&&(n==null?void 0:n.equipment().find(m=>m.equipSlot===_));return{label:(y==null?void 0:y.label)??_,isDisabled:!y,subtext:Object.entries((y==null?void 0:y.stats)??{}).map(([m,f])=>`[${m}: ${f}]`).join(""),onClick:y?()=>i(y):void 0}})]}),l=g=>{const d=(o==null?void 0:o.state.points)??0;d>0&&ve(()=>{o==null||o.setState("points",d-1),n==null||n.onAddStat(g,1)})};return(()=>{var g=Bo(),d=g.firstChild,_=d.nextSibling,y=_.firstChild,m=y.nextSibling,f=m.nextSibling;return $(d,S(Ue,{get children(){return[S(Y,{get when(){return e()==="stats"},get children(){return S(re,{get each(){return s()},children:c=>(()=>{var b=Uo(),u=b.firstChild,w=u.nextSibling;return $(u,()=>c.label),$(w,()=>c.value),Z(()=>b.classList.toggle("border-b",!!c.label)),b})()})}}),S(Y,{get when(){return e()==="attributes"},get children(){return S(re,{get each(){return a()},children:c=>(()=>{var b=qo(),u=b.firstChild,w=u.nextSibling;return $(u,()=>c.label),$(w,()=>c.value,null),$(w,S(z,{get when(){return!!(o!=null&&o.state.points)},get children(){var v=No();return v.$$click=()=>l(c.name),v}}),null),Z(()=>b.classList.toggle("border-b",!!c.label)),b})()})}}),S(Y,{get when(){return e()==="equip"},get children(){return S(re,{get each(){return h()},children:c=>(()=>{var b=Fo(),u=b.firstChild,w=u.nextSibling;return rt(b,"click",c.onClick),$(u,()=>c.label),$(w,()=>c.subtext),Z(v=>{var x=!c.isEmpty,E=!!c.isDisabled;return x!==v.e&&b.classList.toggle("border-b",v.e=x),E!==v.t&&u.classList.toggle("text-gray-700",v.t=E),v},{e:void 0,t:void 0}),b})()})}})]}})),y.$$click=()=>t("equip"),m.$$click=()=>t("attributes"),f.$$click=()=>t("stats"),Z(c=>{var b=e()==="equip",u=e()==="attributes",w=e()==="stats";return b!==c.e&&y.classList.toggle("selected",c.e=b),u!==c.t&&m.classList.toggle("selected",c.t=u),w!==c.a&&f.classList.toggle("selected",c.a=w),c},{e:void 0,t:void 0,a:void 0}),g})()};pe(["click"]);var jo=L('<div class="px-2 py-1 bg-red-900 border border-red-500 rounded w-full flex flex-row justify-between items-center mb-2"><span class="font-bold text-xl text-black">Drop</span><div class="flex flex-row gap-4">'),Vo=L('<div class="absolute bottom-0 left-0 w-full border-t content-center p-2 bg-slate-500"><div class="flex flex-col gap-2"><div class="flex flex-row justify-center relative mb-3"><span class="absolute left-0 top-0 font-bold cursor-pointer border-2 rounded-xl px-2 hover:bg-white hover:text-black">X</span><div class=font-bold> (<!>)</div></div><div class="flex flex-col gap-1 justify-between"><div class="px-2 py-1 bg-blue-900 border border-blue-500 rounded w-full flex flex-row justify-between items-center mb-2"><span class="font-bold text-xl text-black">Transfer</span><div class="flex flex-row gap-4">'),zo=L('<div class="h-full relative pb-2"><div class="flex flex-col gap-2 h-7/8 overflow-auto p-2"></div><div class="w-full border content-center cursor-pointer h-12 text-lg font-bold mt-auto">Leave stash');const Wo=()=>{const e=N(_e),t=N(C),[n,r]=q(),o=l=>{l<0||!(e!=null&&e.stash()[l])||r(l)},s=U(()=>{const l=n()??-1;if(l<0)return;const g=e==null?void 0:e.stash().at(l),d=g?t==null?void 0:t.getItemData(g.name):void 0;if(g&&d)return{item:d,count:g.count}}),a=l=>{const g=s();g&&(e==null||e.removeInventory(g.item.name,l),l>=(g.count??1)&&r(void 0))},i=l=>{const g=s();g&&(l=l===1/0?(e==null?void 0:e.stash().reduce((d,_)=>(_==null?void 0:_.name)===g.item.name?d+_.count:d,0))??0:l,e==null||e.removeStash(g.item.name,l))},h=U(()=>{var l;return!(!s()||((l=s())==null?void 0:l.item.category)==="unique")});return(()=>{var l=zo(),g=l.firstChild,d=g.nextSibling;return g.$$click=()=>r(void 0),$(g,S(re,{get each(){return e==null?void 0:e.stash()},children:(_,y)=>S(Sn,{item:_,onSelect:()=>o(y())})})),$(l,S(z,{get when(){return s()},get children(){var _=Vo(),y=_.firstChild,m=y.firstChild,f=m.firstChild,c=f.nextSibling,b=c.firstChild,u=b.nextSibling;u.nextSibling;var w=m.nextSibling,v=w.firstChild,x=v.firstChild,E=x.nextSibling;return f.$$click=()=>r(void 0),$(c,()=>{var M;return(M=s())==null?void 0:M.item.label},b),$(c,()=>{var M;return(M=s())==null?void 0:M.count},u),$(E,S(ne,{onClick:()=>i(1),children:"One"}),null),$(E,S(ne,{onClick:()=>{var M;return i(((M=s())==null?void 0:M.count)??1)},children:"Stack"}),null),$(E,S(ne,{onClick:()=>i(1/0),children:"All"}),null),$(w,S(z,{get when(){return h()},get children(){var M=jo(),p=M.firstChild,T=p.nextSibling;return $(T,S(ne,{onClick:()=>a(1),children:"One"}),null),$(T,S(ne,{onClick:()=>{var k;return a(((k=s())==null?void 0:k.count)??1)},children:"Stack"}),null),$(T,S(ne,{onClick:()=>a(1/0),children:"All"}),null),M}}),null),_}}),d),d.$$click=()=>t==null?void 0:t.onNavigate("_back"),l})()};pe(["click"]);var Xo=L('<div class="flex flex-col p-2 gap-2 w-full"><div class="border p-2 font-bold cursor-pointer">RESET');const Go=()=>{const e=N(C);return(()=>{var t=Xo(),n=t.firstChild;return rt(n,"click",e==null?void 0:e.onClearState),t})()};pe(["click"]);var Xt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ko(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var ft,Gt;function Yo(){return Gt||(Gt=1,ft={Other:0,CR:1,LF:2,Control:4,Extend:8,ZWJ:16,Regional_Indicator:32,Prepend:64,SpacingMark:128,L:256,V:512,T:1024,LV:2048,LVT:4096,Extended_Pictographic:8192,InCB_Linker:16384,InCB_Consonant:32768,InCB_Extend:65536}),ft}const Zo="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",Jo={data:Zo},Qo="AAACAAAAAACAOAAAAbYBSf7t2S1IBEEYBuDVDZ7FYrQMNsFiu3hgEYOI0SCXRIUrB8JhEZtgs5gEg1GMFk02m82oGI02m+9xezCOczv/uwv3fvAwc/PzfXOzcdqzWdaBDdiGPdiHdjE+DS3RNDuCfsn8idQ/g3OH3BdwKf0e96/gumTfYcncLdzBPTzAo+RZ+f0Cr/AG7/AJX4738x1wtz9FO5PX/50n6UXMNdfg/0lERERERERERERERETpdedHBvDRql4nq0cXtW9af98qdRby0Vvp8K4W0V+C5Xw0t4J2bfjeBp3cnEu1brnnCTYNa7eKdz91XP7WO9Lb4GqRb7cY6xbtAdqeVOsY/QGcevw/tb6OT85YhvfKYEx9CMuxKsKnrs+eJtVInVvHJ0eVYVvTZk2siFVLOCjb61PTZX3MdVWEyP7fjzpmMxdzTyq2Ebue6x61nXRGnzndWpf1an7dXmGYE4Y1ptqqKsK1nu26Ju0ty+maV2Rpvk+qnDZjKUIobUiesdAQE/jmCTmHmsskpFZsVYbtmXRcaoSGUPomunW2derQhDPFjtT1Q/eb8vnm990fq35oHVt11bU9m89c7DNI8Qs=",Co={data:Qo},es="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",ts={data:es};var ht,Kt;function ns(){if(Kt)return ht;Kt=1;var e=0,t=-3;function n(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}function r(p,T){this.source=p,this.sourceIndex=0,this.tag=0,this.bitcount=0,this.dest=T,this.destLen=0,this.ltree=new n,this.dtree=new n}var o=new n,s=new n,a=new Uint8Array(30),i=new Uint16Array(30),h=new Uint8Array(30),l=new Uint16Array(30),g=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),d=new n,_=new Uint8Array(320);function y(p,T,k,P){var I,O;for(I=0;I<k;++I)p[I]=0;for(I=0;I<30-k;++I)p[I+k]=I/k|0;for(O=P,I=0;I<30;++I)T[I]=O,O+=1<<p[I]}function m(p,T){var k;for(k=0;k<7;++k)p.table[k]=0;for(p.table[7]=24,p.table[8]=152,p.table[9]=112,k=0;k<24;++k)p.trans[k]=256+k;for(k=0;k<144;++k)p.trans[24+k]=k;for(k=0;k<8;++k)p.trans[168+k]=280+k;for(k=0;k<112;++k)p.trans[176+k]=144+k;for(k=0;k<5;++k)T.table[k]=0;for(T.table[5]=32,k=0;k<32;++k)T.trans[k]=k}var f=new Uint16Array(16);function c(p,T,k,P){var I,O;for(I=0;I<16;++I)p.table[I]=0;for(I=0;I<P;++I)p.table[T[k+I]]++;for(p.table[0]=0,O=0,I=0;I<16;++I)f[I]=O,O+=p.table[I];for(I=0;I<P;++I)T[k+I]&&(p.trans[f[T[k+I]]++]=I)}function b(p){p.bitcount--||(p.tag=p.source[p.sourceIndex++],p.bitcount=7);var T=p.tag&1;return p.tag>>>=1,T}function u(p,T,k){if(!T)return k;for(;p.bitcount<24;)p.tag|=p.source[p.sourceIndex++]<<p.bitcount,p.bitcount+=8;var P=p.tag&65535>>>16-T;return p.tag>>>=T,p.bitcount-=T,P+k}function w(p,T){for(;p.bitcount<24;)p.tag|=p.source[p.sourceIndex++]<<p.bitcount,p.bitcount+=8;var k=0,P=0,I=0,O=p.tag;do P=2*P+(O&1),O>>>=1,++I,k+=T.table[I],P-=T.table[I];while(P>=0);return p.tag=O,p.bitcount-=I,T.trans[k+P]}function v(p,T,k){var P,I,O,B,H,j;for(P=u(p,5,257),I=u(p,5,1),O=u(p,4,4),B=0;B<19;++B)_[B]=0;for(B=0;B<O;++B){var ee=u(p,3,0);_[g[B]]=ee}for(c(d,_,0,19),H=0;H<P+I;){var G=w(p,d);switch(G){case 16:var K=_[H-1];for(j=u(p,2,3);j;--j)_[H++]=K;break;case 17:for(j=u(p,3,3);j;--j)_[H++]=0;break;case 18:for(j=u(p,7,11);j;--j)_[H++]=0;break;default:_[H++]=G;break}}c(T,_,0,P),c(k,_,P,I)}function x(p,T,k){for(;;){var P=w(p,T);if(P===256)return e;if(P<256)p.dest[p.destLen++]=P;else{var I,O,B,H;for(P-=257,I=u(p,a[P],i[P]),O=w(p,k),B=p.destLen-u(p,h[O],l[O]),H=B;H<B+I;++H)p.dest[p.destLen++]=p.dest[H]}}}function E(p){for(var T,k,P;p.bitcount>8;)p.sourceIndex--,p.bitcount-=8;if(T=p.source[p.sourceIndex+1],T=256*T+p.source[p.sourceIndex],k=p.source[p.sourceIndex+3],k=256*k+p.source[p.sourceIndex+2],T!==(~k&65535))return t;for(p.sourceIndex+=4,P=T;P;--P)p.dest[p.destLen++]=p.source[p.sourceIndex++];return p.bitcount=0,e}function M(p,T){var k=new r(p,T),P,I,O;do{switch(P=b(k),I=u(k,2,0),I){case 0:O=E(k);break;case 1:O=x(k,o,s);break;case 2:v(k,k.ltree,k.dtree),O=x(k,k.ltree,k.dtree);break;default:O=t}if(O!==e)throw new Error("Data error")}while(!P);return k.destLen<k.dest.length?typeof k.dest.slice=="function"?k.dest.slice(0,k.destLen):k.dest.subarray(0,k.destLen):k.dest}return m(o,s),y(a,i,4,3),y(h,l,2,1),a[28]=0,i[28]=258,ht=M,ht}var bt,Yt;function rs(){if(Yt)return bt;Yt=1;const e=new Uint8Array(new Uint32Array([305419896]).buffer)[0]===18,t=(o,s,a)=>{let i=o[s];o[s]=o[a],o[a]=i},n=o=>{const s=o.length;for(let a=0;a<s;a+=4)t(o,a,a+3),t(o,a+1,a+2)};return bt={swap32LE:o=>{e&&n(o)}},bt}var gt,Zt;function os(){if(Zt)return gt;Zt=1;const e=ns(),{swap32LE:t}=rs(),n=11,r=5,o=n-r,s=65536>>n,i=(1<<o)-1,h=2,g=(1<<r)-1,d=65536>>r,_=1024>>r,c=d+_+32,b=1<<h;class u{constructor(v){const x=typeof v.readUInt32BE=="function"&&typeof v.slice=="function";if(x||v instanceof Uint8Array){let E;if(x)this.highStart=v.readUInt32LE(0),this.errorValue=v.readUInt32LE(4),E=v.readUInt32LE(8),v=v.slice(12);else{const M=new DataView(v.buffer);this.highStart=M.getUint32(0,!0),this.errorValue=M.getUint32(4,!0),E=M.getUint32(8,!0),v=v.subarray(12)}v=e(v,new Uint8Array(E)),v=e(v,new Uint8Array(E)),t(v),this.data=new Uint32Array(v.buffer)}else({data:this.data,highStart:this.highStart,errorValue:this.errorValue}=v)}get(v){let x;return v<0||v>1114111?this.errorValue:v<55296||v>56319&&v<=65535?(x=(this.data[v>>r]<<h)+(v&g),this.data[x]):v<=65535?(x=(this.data[d+(v-55296>>r)]<<h)+(v&g),this.data[x]):v<this.highStart?(x=this.data[c-s+(v>>n)],x=this.data[x+(v>>r&i)],x=(x<<h)+(v&g),this.data[x]):this.data[this.data.length-b]}}return gt=u,gt}var Ve={exports:{}},ss=Ve.exports,Jt;function as(){return Jt||(Jt=1,(function(e,t){(function(n,r){e.exports=r()})(typeof self<"u"?self:typeof window<"u"?window:typeof Xt<"u"?Xt:ss,function(){var n="3.7.8",r=n,o=typeof Buffer=="function",s=typeof TextDecoder=="function"?new TextDecoder:void 0,a=typeof TextEncoder=="function"?new TextEncoder:void 0,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",h=Array.prototype.slice.call(i),l=(function(A){var D={};return A.forEach(function(J,te){return D[J]=te}),D})(h),g=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,d=String.fromCharCode.bind(String),_=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):function(A){return new Uint8Array(Array.prototype.slice.call(A,0))},y=function(A){return A.replace(/=/g,"").replace(/[+\/]/g,function(D){return D=="+"?"-":"_"})},m=function(A){return A.replace(/[^A-Za-z0-9\+\/]/g,"")},f=function(A){for(var D,J,te,de,fe="",ot=A.length%3,Ne=0;Ne<A.length;){if((J=A.charCodeAt(Ne++))>255||(te=A.charCodeAt(Ne++))>255||(de=A.charCodeAt(Ne++))>255)throw new TypeError("invalid character found");D=J<<16|te<<8|de,fe+=h[D>>18&63]+h[D>>12&63]+h[D>>6&63]+h[D&63]}return ot?fe.slice(0,ot-3)+"===".substring(ot):fe},c=typeof btoa=="function"?function(A){return btoa(A)}:o?function(A){return Buffer.from(A,"binary").toString("base64")}:f,b=o?function(A){return Buffer.from(A).toString("base64")}:function(A){for(var D=4096,J=[],te=0,de=A.length;te<de;te+=D)J.push(d.apply(null,A.subarray(te,te+D)));return c(J.join(""))},u=function(A,D){return D===void 0&&(D=!1),D?y(b(A)):b(A)},w=function(A){if(A.length<2){var D=A.charCodeAt(0);return D<128?A:D<2048?d(192|D>>>6)+d(128|D&63):d(224|D>>>12&15)+d(128|D>>>6&63)+d(128|D&63)}else{var D=65536+(A.charCodeAt(0)-55296)*1024+(A.charCodeAt(1)-56320);return d(240|D>>>18&7)+d(128|D>>>12&63)+d(128|D>>>6&63)+d(128|D&63)}},v=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,x=function(A){return A.replace(v,w)},E=o?function(A){return Buffer.from(A,"utf8").toString("base64")}:a?function(A){return b(a.encode(A))}:function(A){return c(x(A))},M=function(A,D){return D===void 0&&(D=!1),D?y(E(A)):E(A)},p=function(A){return M(A,!0)},T=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,k=function(A){switch(A.length){case 4:var D=(7&A.charCodeAt(0))<<18|(63&A.charCodeAt(1))<<12|(63&A.charCodeAt(2))<<6|63&A.charCodeAt(3),J=D-65536;return d((J>>>10)+55296)+d((J&1023)+56320);case 3:return d((15&A.charCodeAt(0))<<12|(63&A.charCodeAt(1))<<6|63&A.charCodeAt(2));default:return d((31&A.charCodeAt(0))<<6|63&A.charCodeAt(1))}},P=function(A){return A.replace(T,k)},I=function(A){if(A=A.replace(/\s+/g,""),!g.test(A))throw new TypeError("malformed base64.");A+="==".slice(2-(A.length&3));for(var D,J,te,de=[],fe=0;fe<A.length;)D=l[A.charAt(fe++)]<<18|l[A.charAt(fe++)]<<12|(J=l[A.charAt(fe++)])<<6|(te=l[A.charAt(fe++)]),J===64?de.push(d(D>>16&255)):te===64?de.push(d(D>>16&255,D>>8&255)):de.push(d(D>>16&255,D>>8&255,D&255));return de.join("")},O=typeof atob=="function"?function(A){return atob(m(A))}:o?function(A){return Buffer.from(A,"base64").toString("binary")}:I,B=o?function(A){return _(Buffer.from(A,"base64"))}:function(A){return _(O(A).split("").map(function(D){return D.charCodeAt(0)}))},H=function(A){return B(ee(A))},j=o?function(A){return Buffer.from(A,"base64").toString("utf8")}:s?function(A){return s.decode(B(A))}:function(A){return P(O(A))},ee=function(A){return m(A.replace(/[-_]/g,function(D){return D=="-"?"+":"/"}))},G=function(A){return j(ee(A))},K=function(A){if(typeof A!="string")return!1;var D=A.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(D)||!/[^\s0-9a-zA-Z\-_]/.test(D)},R=function(A){return{value:A,enumerable:!1,writable:!0,configurable:!0}},F=function(){var A=function(D,J){return Object.defineProperty(String.prototype,D,R(J))};A("fromBase64",function(){return G(this)}),A("toBase64",function(D){return M(this,D)}),A("toBase64URI",function(){return M(this,!0)}),A("toBase64URL",function(){return M(this,!0)}),A("toUint8Array",function(){return H(this)})},V=function(){var A=function(D,J){return Object.defineProperty(Uint8Array.prototype,D,R(J))};A("toBase64",function(D){return u(this,D)}),A("toBase64URI",function(){return u(this,!0)}),A("toBase64URL",function(){return u(this,!0)})},le=function(){F(),V()},oe={version:n,VERSION:r,atob:O,atobPolyfill:I,btoa:c,btoaPolyfill:f,fromBase64:G,toBase64:M,encode:M,encodeURI:p,encodeURL:p,utob:x,btou:P,decode:G,isValid:K,fromUint8Array:u,toUint8Array:H,extendString:F,extendUint8Array:V,extendBuiltins:le};return oe.Base64={},Object.keys(oe).forEach(function(A){return oe.Base64[A]=oe[A]}),oe})})(Ve)),Ve.exports}var mt,Qt;function is(){if(Qt)return mt;Qt=1;const e=Yo(),t=Jo.data,n=Co.data,r=ts.data,o=os(),s=as().Base64,a=new o(s.toUint8Array(t)),i=new o(s.toUint8Array(n)),h=new o(s.toUint8Array(r));function l(d,_){return(d&_)!==0}function g(d,_,y){const m=_.length;for(let f=y;f+1<m;f++){const c=_[f+0],b=_[f+1];switch(d.gb9c){case 0:l(c,e.InCB_Consonant)&&(d.gb9c=1);break;case 1:l(c,e.InCB_Extend)?d.gb9c=1:l(c,e.InCB_Linker)?d.gb9c=2:d.gb9c=l(c,e.InCB_Consonant)?1:0;break;case 2:l(c,e.InCB_Extend|e.InCB_Linker)?d.gb9c=2:d.gb9c=l(c,e.InCB_Consonant)?1:0;break}switch(d.gb11){case 0:l(c,e.Extended_Pictographic)&&(d.gb11=1);break;case 1:l(c,e.Extend)?d.gb11=1:l(c,e.ZWJ)?d.gb11=2:d.gb11=l(c,e.Extended_Pictographic)?1:0;break;case 2:d.gb11=l(c,e.Extended_Pictographic)?1:0;break}switch(d.gb12){case 0:l(c,e.Regional_Indicator)?d.gb12=1:d.gb12=-1;break;case 1:l(c,e.Regional_Indicator)?d.gb12=0:d.gb12=-1;break}switch(d.gb13){case 0:l(c,e.Regional_Indicator)||(d.gb13=1);break;case 1:l(c,e.Regional_Indicator)?d.gb13=2:d.gb13=1;break;case 2:d.gb13=1;break}if(!(l(c,e.CR)&&l(b,e.LF))){if(l(c,e.Control|e.CR|e.LF)||l(b,e.Control|e.CR|e.LF))return f+1-y;if(!(l(c,e.L)&&l(b,e.L|e.V|e.LV|e.LVT))&&!(l(c,e.LV|e.V)&&l(b,e.V|e.T))&&!(l(c,e.LVT|e.T)&&l(b,e.T))&&!l(b,e.Extend|e.ZWJ)&&!l(b,e.SpacingMark)&&!l(c,e.Prepend)&&!(l(b,e.InCB_Consonant)&&d.gb9c===2)&&!(l(b,e.Extended_Pictographic)&&d.gb11===2)&&!(l(b,e.Regional_Indicator)&&d.gb12===1)&&!(l(b,e.Regional_Indicator)&&d.gb13===2))return f+1-y}}return m-y}return mt=function(_){const y=[],m=[0],f=[];for(let b=0;b<_.length;){const u=_.codePointAt(b);f.push(a.get(u)|i.get(u)|h.get(u)),b+=u>65535?2:1,m.push(b)}const c={gb9c:0,gb11:0,gb12:0,gb13:0};for(let b=0;b<f.length;){const u=g(c,f,b),w=m[b],v=m[b+u];y.push(_.slice(w,v)),b+=u}return y},mt}var ls=is();const cs=Ko(ls),us=e=>e.normalize("NFKD").split(""),Ct=/^\s+$/,en=/^[`~!@#$%^&*()\-=_+{}[\]\|\\;':",./<>?]+$/,Tt={insertOrder:"insertOrder",bestMatch:"bestMatch"},ds={keySelector:e=>e,threshold:.6,ignoreCase:!0,ignoreSymbols:!0,normalizeWhitespace:!0,returnMatchData:!1,useDamerau:!0,useSellers:!0,useSeparatedUnicode:!1,sortBy:Tt.bestMatch},fs=()=>{},hs=e=>e instanceof Array?e:[e];function $n(e,t){const n=t.ignoreCase?e.toLocaleLowerCase():e,r=[],o=[];let s=!0,a=0;const i=t.useSeparatedUnicode?us(n):cs(n);for(const h of i)Ct.lastIndex=0,en.lastIndex=0,t.normalizeWhitespace&&Ct.test(h)?s||(r.push(" "),o.push(a),s=!0):t.ignoreSymbols&&en.test(h)||(t.useSeparatedUnicode?r.push(h):r.push(h.normalize()),o.push(a),s=!1),a+=h.length;for(o.push(e.length);r[r.length-1]===" ";)r.pop(),o.pop();return{original:e,normal:r,map:o}}function bs(e,t){return{index:t[e.start],length:t[e.end+1]-t[e.start]}}function kn(e,t){if(t===0)return{index:0,length:0};let n=t;for(let r=e.length-2;r>0&&n>1;r--){const o=e[r];n=o[n]<o[n-1]?n:n-1}return{start:n-1,end:t-1}}function gs(){return{start:0,end:0}}const ms=()=>!0,ps=(e,t)=>e<t;function _s(e,t){const n=new Array(e);for(let r=0;r<e;r++)n[r]=new Array(t),n[r][0]=r;for(let r=0;r<t;r++)n[0][r]=r;return n}function vs(e,t){const n=new Array(e);n[0]=new Array(t).fill(0);for(let r=1;r<e;r++)n[r]=new Array(t),n[r][0]=r;return n}function An(e,t,n,r,o){const s=n[r],a=n[r+1],i=e[r]===t[o]?0:1;let h,l=a[o]+1;(h=s[o+1]+1)<l&&(l=h),(h=s[o]+i)<l&&(l=h),a[o+1]=l}function xn(e,t,n,r){for(let o=0;o<e.length;o++)An(e,t,n,o,r)}function ys(e,t,n,r){if(r===0){xn(e,t,n,r);return}e.length>0&&An(e,t,n,0,r);for(let o=1;o<e.length;o++){const s=n[o-1],a=n[o],i=n[o+1],h=e[o]===t[r]?0:1;let l,g=i[r]+1;(l=a[r+1]+1)<g&&(g=l),(l=a[r]+h)<g&&(g=l),e[o]===t[r-1]&&e[o-1]===t[r]&&(l=s[r-1]+h)<g&&(g=l),i[r+1]=g}}function ws(e,t,n){let r=e;for(let o=0;o<t.length;o++){const s=t[o];r.children[s]==null&&(r.children[s]={children:{},candidates:[],depth:0}),r.depth=Math.max(r.depth,t.length-o),r=r.children[s]}r.candidates.push(n)}function tn(e,t,n,r){for(const o of n){const s=hs(r.keySelector(o)).map((a,i)=>({index:t,keyIndex:i,item:o,normalized:$n(a,r)}));t++;for(const a of s)ws(e,a.normalized.normal,a)}}function Ss(e,t){const n=t.score-e.score;if(n!==0)return n;const r=e.match.start-t.match.start;if(r!==0)return r;const o=e.keyIndex-t.keyIndex;if(o!==0)return o;const s=e.lengthDiff-t.lengthDiff;return s!==0?s:In(e,t)}function In(e,t){return e.index-t.index}function $s(e){switch(e){case Tt.bestMatch:return Ss;case Tt.insertOrder:return In;default:throw new Error(`unknown sortBy method ${e}`)}}function Tn(e,t,n,r,o,s,a){const i={item:n.item,normalized:n.normalized,score:r,match:o,index:n.index,keyIndex:n.keyIndex,lengthDiff:s};t[n.index]==null?(t[n.index]=e.length,e.push(i)):a(i,e[t[n.index]])<0&&(e[t[n.index]]=i)}const ks=Math.max,As=e=>e;function xs(e,t,n,r,o){const s=t+o,a=Math.min(n.length,t+e.depth+1),i=Math.ceil((s+a)/2);return 1-(i-a)/i>=r}function Is(e,t,n,r,o,s){return 1-Math.min(o,s-(e.depth+1))/n.length>=r}function Ts(e,t,n,r,o,s,a){const i=[];for(const l in e.children){const g=e.children[l];i.push([g,1,l,0,t.length])}const h=new Array(e.depth);for(;i.length!==0;){const[l,g,d,_,y]=i.pop();h[g-1]=d,n.score(t,h,r,g-1);const m=g,f=r[r.length-1][m];let c=_,b=y;if(n.shouldUpdateScore(f,y)&&(c=m,b=f),l.candidates.length>0){const u=n.getLength(t.length,g),w=1-b/u;if(w>=a.threshold){const v=kn(r,c),x=Math.abs(g-t.length);for(const E of l.candidates)Tn(o,s,E,w,v,x,n.compareItems)}}for(const u in l.children){const w=l.children[u];n.shouldContinue(w,g,t,a.threshold,b,f)&&i.push([w,g+1,u,c,b])}}}function Ls(e,t,n){const r=n.useSellers?vs:_s,o={score:n.useDamerau?ys:xn,getLength:n.useSellers?As:ks,shouldUpdateScore:n.useSellers?ps:ms,shouldContinue:n.useSellers?Is:xs,walkBack:n.useSellers?kn:gs,compareItems:$s(n.sortBy)},s={},a=[],i=r(e.length+1,t.depth+1);if(n.threshold<=0||e.length===0)for(const l of t.candidates)Tn(a,s,l,0,{index:0,length:0},e.length,o.compareItems);Ts(t,e,o,i,a,s,n);const h=a.sort(o.compareItems);if(n.returnMatchData){const l=n.useSellers?bs:fs;return h.map(g=>({item:g.item,original:g.normalized.original,key:g.normalized.normal.join(""),score:g.score,match:l(g.match,g.normalized.map)}))}return h.map(l=>l.item)}class Es{constructor(t,n){this.options=Object.assign({},ds,n),this.trie={children:{},candidates:[],depth:0},tn(this.trie,0,t,this.options),this.count=t.length}add(...t){tn(this.trie,this.count,t,this.options),this.count+=t.length}search(t,n){return n=Object.assign({},this.options,n),Ls($n(t,this.options).normal,this.trie,n)}}var Ms=L('<div class="flex flex-col gap-2 p-2"><div class="flex flex-row gap-2"><div class="border rounded cursor-pointer px-2">CLEAR INV</div><div class="border rounded cursor-pointer px-2">CLEAR MARKERS</div><div class="flex flex-row border p-1"><select><option value=strength>Strength</option><option value=agility>Agility</option><option value=charisma>Charisma</option><option value=dexterity>Dexterity</option><option value=intelligence>Intelligence</option><option value=constitution>Constitution</option></select><div class="border rounded cursor-pointer px-2">+1</div><div class="border rounded cursor-pointer px-2">+10</div></div><div class="border rounded cursor-pointer px-2">HEAL</div></div><input type=text placeholder="item search"class="border border-black">'),Rs=L("<div class=cursor-pointer>BACK"),Ds=L('<div class="flex flex-row gap-2 mt-5"><div class=font-bold></div> - <div class="border rounded cursor-pointer px-2">1</div><div class="border rounded cursor-pointer px-2">10</div><div class="border rounded cursor-pointer px-2">100'),Ps=L('<div class="w-128 h-128 absolute bg-white top-0 left-0 p-2 text-black">'),Os=L('<div class="hover:bg-blue-200 cursor-pointer">');const Bs=new Es(Object.keys(ae)),Us=()=>{const e=N(_e),t=N(C),n=N(ue),[r,o]=q(),[s,a]=q(),[i,h]=q("strength"),l=m=>{i()&&(n==null||n.onAddStat(i(),m))},g=(m=1)=>{const f=s();f&&(e==null||e.addInventory(f,m))},d=m=>{const f=Bs.search(m);o(f)},_=()=>{e==null||e.inventory().filter(Boolean).forEach(m=>e.removeInventory(m.name,m.count))},y=()=>{t==null||t.setState("markers",[])};return(()=>{var m=Ps();return $(m,S(z,{get when(){return!s()},get children(){var f=Ms(),c=f.firstChild,b=c.firstChild,u=b.nextSibling,w=u.nextSibling,v=w.firstChild,x=v.nextSibling,E=x.nextSibling,M=w.nextSibling,p=c.nextSibling;return b.$$click=()=>_(),u.$$click=()=>y(),v.addEventListener("change",T=>h(T.target.value)),x.$$click=()=>l(1),E.$$click=()=>l(10),M.$$click=()=>n==null?void 0:n.onAddStat("health",10),p.addEventListener("keypress",T=>d(T.target.value)),$(f,S(re,{get each(){return r()??[]},children:T=>(()=>{var k=Os();return k.$$click=()=>a(T),$(k,T),k})()}),null),Z(()=>v.value=i()),f}}),null),$(m,S(z,{get when(){return s()},get children(){return[(()=>{var f=Rs();return f.$$click=()=>a(void 0),f})(),(()=>{var f=Ds(),c=f.firstChild,b=c.nextSibling,u=b.nextSibling,w=u.nextSibling,v=w.nextSibling;return $(c,s),u.$$click=()=>g(1),w.$$click=()=>g(10),v.$$click=()=>g(100),f})()]}}),null),m})()};pe(["click"]);var Ns=L('<div class="w-dvw h-dvh lg:w-[360px] lg:h-[800px] flex flex-col justify-between relative"><div class="h-3/10 bg-gray-400"><div class=h-1/10></div><div class=h-9/10></div></div><div></div><div class=bg-gray-800>'),qs=L("<div>Unknown view"),Fs=L('<div class="h-1/10 w-full flex flex-row justify-between font-bold">'),Hs=L('<div class="flex flex-col gap-2 p-1 h-full"><div class="bg-black text-left pl-1"></div><div class="text-black whitespace-pre-wrap text-left overflow-y-auto text-sm">'),js=L('<div class="h-full bg-white flex flex-row"><div class="text-black bottom-0 left-0 border border-gray-100 p-1 flex flex-col gap-1 bg-white"><div class="rounded h-4 w-4 cursor-pointer"title="Show/hide bad"></div><div class="rounded h-4 w-4 cursor-pointer"title="Show/hide good"></div><div class="rounded h-4 w-4 cursor-pointer"title="Show/hide meta"></div><div class="rounded h-4 w-4 cursor-pointer"title="Show/hide drop"></div><div class="rounded h-4 w-4 cursor-pointer"title="Show/hide basic"></div></div><div class="text-black h-full overflow-y-auto flex flex-col w-full">'),Vs=L('<div class="flex flex-row items-center px-1 transition-colors duration-500 border-t border-gray-200"><div class="text-xs text-blue-400 mr-1">[<!>]</div><div class="text-wrap text-xs text-left">'),zs=L('<div class="flex flex-row bg-black px-1 justify-between"><div class=text-red-500>HP <!>/</div><div class=text-yellow-500>Gold </div><div class=text-white>Age </div><div class=text-green-500>Lvl <!> (<!>%)'),Ws=L('<div class="content-center w-1/4 border border-l-0 cursor-pointer last:border-r-0">');const Xs=()=>S(jr,{get children(){return[S(Gs,{}),S(z,{when:qn,get children(){return S(Us,{})}})]}}),Gs=()=>{const[e,t]=q("story"),n=N(ke),r=U(()=>{var s;return e()==="story"&&((s=n==null?void 0:n.story())==null?void 0:s.name)==="story_stash_1"?"stash":e()}),o=U(()=>{var s;return r()==="story"&&((s=n==null?void 0:n.story())==null?void 0:s.type)==="encounter"});return(()=>{var s=Ns(),a=s.firstChild,i=a.firstChild,h=i.nextSibling,l=a.nextSibling,g=l.nextSibling;return $(i,S(Js,{})),$(h,S(Ys,{})),$(l,S(Zs,{get view(){return r()}})),$(g,S(Ue,{get fallback(){return qs()},get children(){return[S(Y,{get when(){return r()==="story"},get children(){return S(Zr,{})}}),S(Y,{get when(){return r()==="stash"},get children(){return S(Wo,{})}}),S(Y,{get when(){return r()==="invent"},get children(){return S(lo,{})}}),S(Y,{get when(){return r()==="skills"},get children(){return S(po,{})}}),S(Y,{get when(){return r()==="stats"},get children(){return S(Ho,{})}}),S(Y,{get when(){return r()==="menu"},get children(){return S(Go,{})}})]}})),$(s,S(Ks,{onChange:t,get view(){return e()}}),null),Z(d=>{var _=!o(),y=!!o(),m=!!o(),f=!o();return _!==d.e&&l.classList.toggle("h-1/10",d.e=_),y!==d.t&&l.classList.toggle("h-4/10",d.t=y),m!==d.a&&g.classList.toggle("h-2/10",d.a=m),f!==d.o&&g.classList.toggle("h-5/10",d.o=f),d},{e:void 0,t:void 0,a:void 0,o:void 0}),s})()},Ks=e=>(()=>{var t=Fs();return $(t,S(Ee,{label:"Story",onClick:()=>e.onChange("story"),get view(){return e.view},type:"story"}),null),$(t,S(Ee,{label:"Invent",onClick:()=>e.onChange("invent"),get view(){return e.view},type:"invent"}),null),$(t,S(Ee,{label:"Skills",onClick:()=>e.onChange("skills"),get view(){return e.view},type:"skills"}),null),$(t,S(Ee,{label:"Stats",onClick:()=>e.onChange("stats"),get view(){return e.view},type:"stats"}),null),$(t,S(Ee,{label:"Menu",onClick:()=>e.onChange("menu"),get view(){return e.view},type:"menu"}),null),t})(),Ys=()=>{const e=N(ke);return S(Ue,{get children(){return[S(Y,{get when(){var t;return((t=e==null?void 0:e.story())==null?void 0:t.type)==="dialogue"},get children(){var t=Hs(),n=t.firstChild,r=n.nextSibling;return $(n,()=>{var o;return((o=e==null?void 0:e.story())==null?void 0:o.label)??"Story"}),$(r,()=>{var o;return(o=e==null?void 0:e.story())==null?void 0:o.description}),t}}),S(Y,{get when(){var t;return((t=e==null?void 0:e.story())==null?void 0:t.type)==="encounter"},get children(){return S(Io,{})}}),S(Y,{get when(){var t;return((t=e==null?void 0:e.story())==null?void 0:t.type)==="task"},get children(){return S(Do,{})}})]}})},Zs=e=>{const[t,n]=q(),r=N(C);$e(i=>{const h=t();return h&&i!==e.view&&e.view!=="story"&&setTimeout(()=>h.scrollTo(0,h.scrollHeight??0)),i},e.view);const[o,s]=Qe({good:!0,bad:!0,meta:!0,drop:!0,basic:!0}),a=U(()=>{const i=t();if(!i)return;const h=i.scrollTop+i.clientHeight>i.scrollHeight-10;return setTimeout(()=>h&&i.scrollTo(0,i.scrollHeight??0)),r==null?void 0:r.log().filter(l=>o[l.type])});return(()=>{var i=js(),h=i.firstChild,l=h.firstChild,g=l.nextSibling,d=g.nextSibling,_=d.nextSibling,y=_.nextSibling,m=h.nextSibling;return l.$$click=()=>s("bad",!o.bad),g.$$click=()=>s("good",!o.good),d.$$click=()=>s("meta",!o.meta),_.$$click=()=>s("drop",!o.drop),y.$$click=()=>s("basic",!o.basic),zn(n,m),$(m,S(re,{get each(){return a()},children:f=>(()=>{var c=Vs(),b=c.firstChild,u=b.firstChild,w=u.nextSibling;w.nextSibling;var v=b.nextSibling;return $(b,()=>f.time,w),$(v,()=>f.msg),Z(x=>fn(c,{"last:bg-red-500 last:text-white bg-red-200":f.type==="bad","last:bg-green-500 last:text-white bg-green-200":f.type==="good","last:bg-yellow-500 bg-yellow-200":f.type==="meta","last:bg-blue-500 last:text-white bg-blue-200":f.type==="drop"},x)),c})()})),Z(f=>{var c=!o.bad,b=!!o.bad,u=!o.good,w=!!o.good,v=!o.meta,x=!!o.meta,E=!o.drop,M=!!o.drop,p=!o.basic,T=!!o.basic;return c!==f.e&&l.classList.toggle("bg-red-100",f.e=c),b!==f.t&&l.classList.toggle("bg-red-500",f.t=b),u!==f.a&&g.classList.toggle("bg-green-100",f.a=u),w!==f.o&&g.classList.toggle("bg-green-500",f.o=w),v!==f.i&&d.classList.toggle("bg-yellow-100",f.i=v),x!==f.n&&d.classList.toggle("bg-yellow-500",f.n=x),E!==f.s&&_.classList.toggle("bg-blue-100",f.s=E),M!==f.h&&_.classList.toggle("bg-blue-500",f.h=M),p!==f.r&&y.classList.toggle("bg-gray-100",f.r=p),T!==f.d&&y.classList.toggle("bg-gray-500",f.d=T),f},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0}),i})()},Js=()=>{const e=N(ue),t=N(C);return(()=>{var n=zs(),r=n.firstChild,o=r.firstChild,s=o.nextSibling;s.nextSibling;var a=r.nextSibling;a.firstChild;var i=a.nextSibling;i.firstChild;var h=i.nextSibling,l=h.firstChild,g=l.nextSibling,d=g.nextSibling,_=d.nextSibling;return _.nextSibling,$(r,()=>e==null?void 0:e.player.stats.health,s),$(r,()=>e==null?void 0:e.player.stats.maxHealth,null),$(a,()=>e==null?void 0:e.player.stats.gold,null),$(i,()=>t==null?void 0:t.year(),null),$(h,()=>ce((e==null?void 0:e.player.stats.experience)??0),g),$(h,()=>($t((e==null?void 0:e.player.stats.experience)??0)*100).toFixed(0),_),n})()},Ee=e=>(()=>{var t=Ws();return rt(t,"click",e.onClick),$(t,()=>e.label),Z(n=>fn(t,{"border-t-0 bg-gray-800":e.view===e.type},n)),t})();pe(["click"]);const Qs=document.getElementById("root");Hn(()=>S(Xs,{}),Qs);
